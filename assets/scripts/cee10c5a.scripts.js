"use strict";angular.module("zupPainelApp",["ui.router","restangular","ngCookies","ngAnimate","ngSanitize","ui.bootstrap","ui.autocomplete","ui.select2","ui.select","ui.mask","infinite-scroll","angularFileUpload","colorpicker.module","frapontillo.bootstrap-switch","ngStorage","ngRaven","monospaced.elastic","angularPromiseButtons","AuthServiceModule","UserServiceModule","FullResponseRestangularServiceModule","ErrorServiceModule","NavItemComponentModule","DetectScrollTopComponentModule","ZupTranscludeComponentModule","config","IndexModule","UserModule","ReportsModule","ItemsModule","ConfigModule","UsersModule","GroupsModule","HelpModule","FlowsModule","CasesModule","BusinessReportsModule"]),angular.module("ngLocale",[],["$provide",function(a){var b={ZERO:"zero",ONE:"one",TWO:"two",FEW:"few",MANY:"many",OTHER:"other"};a.value("$locale",{DATETIME_FORMATS:{AMPMS:["AM","PM"],DAY:["domingo","segunda-feira","terça-feira","quarta-feira","quinta-feira","sexta-feira","sábado"],MONTH:["janeiro","fevereiro","março","abril","maio","junho","julho","agosto","setembro","outubro","novembro","dezembro"],SHORTDAY:["dom","seg","ter","qua","qui","sex","sáb"],SHORTMONTH:["jan","fev","mar","abr","mai","jun","jul","ago","set","out","nov","dez"],fullDate:"EEEE, d 'de' MMMM 'de' y",longDate:"d 'de' MMMM 'de' y",medium:"dd/MM/yyyy HH:mm:ss",mediumDate:"dd/MM/yyyy",mediumTime:"HH:mm:ss","short":"dd/MM/yy HH:mm",shortDate:"dd/MM/yy",shortTime:"HH:mm"},NUMBER_FORMATS:{CURRENCY_SYM:"R$",DECIMAL_SEP:",",GROUP_SEP:".",PATTERNS:[{gSize:3,lgSize:3,macFrac:0,maxFrac:3,minFrac:0,minInt:1,negPre:"-",negSuf:"",posPre:"",posSuf:""},{gSize:3,lgSize:3,macFrac:0,maxFrac:2,minFrac:2,minInt:1,negPre:"(¤",negSuf:")",posPre:"¤",posSuf:""}]},id:"pt-br",pluralCat:function(a){return 1==a?b.ONE:b.OTHER}})}]),angular.module("zupPainelApp").config(["$urlRouterProvider","RestangularProvider","ENV","uiSelectConfig","$provide",function(a,b,c,d,e){a.otherwise("/"),b.setBaseUrl(c.apiEndpoint),b.setFullResponse(!0),d.theme="bootstrap",$.fn.bootstrapSwitch.defaults.onText="Sim",$.fn.bootstrapSwitch.defaults.offText="Não",e.decorator("ngModelDirective",["$delegate",function(a){var b=a[0],c=b.controller;return b.controller=["$scope","$element","$attrs","$injector",function(a,b,d,e){var f=e.get("$interpolate");d.$set("name",f(d.name||"")(a)),e.invoke(c,this,{$scope:a,$element:b,$attrs:d})}],a}]),e.decorator("formDirective",["$delegate",function(a){var b=a[0],c=b.controller;return b.controller=["$scope","$element","$attrs","$injector",function(a,b,d,e){var f=e.get("$interpolate");d.$set("name",f(d.name||d.ngForm||"")(a)),e.invoke(c,this,{$scope:a,$element:b,$attrs:d})}],a}])}]).factory("singleItemUploaderFilter",function(){return{name:"fixQueueLimit",fn:function(a,b){return 1===this.queue.length&&this.clearQueue(),!0}}}).factory("onlyImagesUploaderFilter",function(){return function(a){return{name:"onlyImages",fn:function(b,c){var d=a?b.type:"/"+b.value.slice(b.value.lastIndexOf(".")+1);return d="|"+d.toLowerCase().slice(d.lastIndexOf("/")+1)+"|",-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(d)}}}}).run(["Restangular","Auth","$rootScope","$timeout","Error","$http","FullResponseRestangular","ENV","$window",function(a,b,c,d,e,f,g,h,i){function j(a){var b=/^\)\]\}',?\n/;if("string"==typeof a){a=a.replace(b,"");try{a=JSON.parse(a)}catch(c){return a}}return a}a.setDefaultHeaders({"X-App-Token":b.getToken()}),g.setDefaultHeaders({"X-App-Token":b.getToken()}),c.flowsEnabled="true"===h.flowsEnabled||"TRUE"===h.flowsEnabled,"development"==h.name&&(c.errorReporting=!0,c.mapDebugEnabled=!0),a.addResponseInterceptor(function(a,b,c){if("undefined"!=typeof a[c])return a[c];for(var d in a)if("object"==typeof a[d])return a[d];for(var e in a)return a[e];return a}),f.defaults.transformResponse=[j];var k=function(a,b,c){return 401!==a.status||"undefined"!=typeof a.config.treatingUnauthorizedErrors&&a.config.treatingUnauthorizedErrors!==!1?("undefined"==typeof a.config.treatingErrors||a.config.treatingErrors===!1)&&e.show(a):e.show("expired_session"),!0};a.setErrorInterceptor(k),g.setErrorInterceptor(k),c.$on("$stateChangeStart",function(a,b,d,e,f){0!==e.name.length&&(c.resolvingRoute=!0,c.uiHasScroll=!1,c.uiDebugMap=!1)}),c.$on("$stateChangeSuccess",function(a,b,e,f,g){c.stateClass="state-"+b.name.replace(".","-").replace("_","-"),0===f.name.length&&(c.hideInitialLoading=!0),d(function(){c.resolvingRoute=!1,c.resolvingRequest=!1},150)}),c.$on("$stateChangeError",function(a,b,d,f,g,h){c.stateClass="",403===h.status?i.location="/":404===h.status?i.location="/":e.show(401===h.status?"expired_session":h)}),c.$on("$stateNotFound",function(a,b,c,d){console.log("$stateNotFound "+b.to+"  - fired when a state cannot be found by its name."),console.log(b,c,d)}),c.glyphicons={"exclamation-sign":"glyphicon-exclamation-sign",ok:"glyphicon-ok"},c.showMessage=function(a,b,e,f){c.systemMessage={icon:a,text:b,messageClass:e},c.showSystemMessage=!0,d(function(){c.showSystemMessage=!1},3500),f===!0&&(c.scrollTop=!0)},c.addModalMessage=function(a,b,e){c.modalMessage={icon:a,text:b,messageClass:e},d(function(){c.showModalMessage=!0},100),d(function(){c.showModalMessage=!1,d(function(){c.modalMessage={icon:null,text:null,messageClass:null}},1e3)},3500)},c.logoImg=h.logoImgUrl.length>0?h.logoImgUrl:"assets/images/logos/logo-zup.png"}]),angular.module("AuthServiceModule",[]).factory("Auth",["$q","Restangular","FullResponseRestangular","$cookies","$rootScope",function(a,b,c,d,e){var f=null;return{check:function(){var c=a.defer(),d=this.getToken();if(null!==d&&null===f){var e=b.one("me").get({return_fields:"id,email,permissions,groups.id,groups.name"}),g=this;e.then(function(a){g.saveUser(a.data),c.resolve(f)},function(){c.reject(),g.clearToken()})}else null!==d&&null!==f?c.resolve(f):(c.reject(),this.clearToken());return c.promise},getToken:function(){var a=d.token;return"undefined"==typeof a?null:a},saveToken:function(a){d.token=a},clearToken:function(){delete d.token},clearUser:function(){f=null,e.user=null},saveUser:function(a){f=a},isLogged:function(){return null!==f&&null!==this.getToken()},login:function(d,e){var f=["permissions","id","email","name","groups.id","groups_names","token"];c.setDefaultHeaders({"X-App-Token":this.getToken()});var g=a.defer(),h=c.one("authenticate").withHttpConfig({treatingErrors:!0,treatingUnauthorizedErrors:!0}).post(null,{email:d,password:e},{return_fields:f.join()}),i=this;return h.then(function(a){i.saveUser(a.data.user),i.saveToken(a.data.token),b.setDefaultHeaders({"X-App-Token":a.data.token}),c.setDefaultHeaders({"X-App-Token":a.data.token}),g.resolve()},function(){g.reject()}),g.promise},logout:function(){this.clearToken(),this.clearUser()}}}]),angular.module("UserServiceModule",[]).service("User",["$q","Auth","$rootScope","$state",function(a,b,c,d){return function(e){e||(e={permissions:[]});var f=a.defer();return b.check().then(function(a){f.resolve(a),c.me=a,c.hasPermission=function(b,c){for(var d in a.permissions)if(d===b){if(_.isBoolean(a.permissions[d]))return a.permissions[d]===!0;if(_.isObject(a.permissions[d])){if(_.isUndefined(c))return a.permissions[d]&&0!==a.permissions[d].length;if(_.isArray(c))for(var e=_.map(c,function(a){return _.isObject(a)&&_.isUndefined(a.id)?a.id:a}),f=0;f<e.length;f++)for(var g=e[f],h=a.permissions[d].length-1;h>=0;h--)if(g==a.permissions[d][h])return!0;for(var f=a.permissions[d].length-1;f>=0;f--)if(c==a.permissions[d][f])return!0}}return!1},c.hasAnyPermission=function(a){for(var b=a.length-1;b>=0;b--)if(c.hasPermission(a[b]))return!0;return!1},c.hasPermission("panel_access")||d.go("user.unauthorized")},function(){f.resolve(null),-1!==e.permissions.indexOf("isLogged")&&d.go("user.login")}),f.promise}}]),angular.module("AdvancedFiltersServiceModule",["AdvancedFiltersQueryModalControllerModule","AdvancedFiltersCategoryModalControllerModule","AdvancedFiltersStatusModalControllerModule","AdvancedFiltersAuthorModalControllerModule","AdvancedFiltersReporterModalControllerModule","PeriodSelectorModule","AdvancedFiltersAreaModalControllerModule","AdvancedFiltersFieldsModalControllerModule","AdvancedFiltersShareModalControllerModule","ReportsCategoriesServiceModule","InventoriesCategoriesServiceModule"]).factory("AdvancedFilters",["$modal","PeriodSelectorService","Restangular","$q","$location","$rootScope","ReportsCategoriesService","InventoriesCategoriesService",function(a,b,c,d,e,f,g,h){var i=function(a){var b;return b="items"===a?h.loadedBasicInfo?_.values(h.categories):h.fetchAllBasicInfo():g.loadedBasicInfo?_.values(g.categories):g.fetchAllBasicInfo()};return{query:function(b){a.open({templateUrl:"modals/advanced-filters/query/advanced-filters-query.template.html",windowClass:"filterQueryModal",resolve:{activeAdvancedFilters:function(){return b}},controller:"AdvancedFiltersQueryModalController"})},category:function(b,c){f.resolvingRequest=!0,a.open({templateUrl:"modals/advanced-filters/category/advanced-filters-category.template.html",windowClass:"filterCategoriesModal",resolve:{categoriesResponse:function(){return i(c)},activeAdvancedFilters:function(){return b}},controller:"AdvancedFiltersCategoryModalController"})},status:function(b,c){f.resolvingRequest=!0,a.open({templateUrl:"modals/advanced-filters/status/advanced-filters-status.template.html",windowClass:"filterStatusesModal",resolve:{categoriesResponse:function(){return i(c)},activeAdvancedFilters:function(){return b}},controller:"AdvancedFiltersStatusModalController"})},author:function(b){a.open({templateUrl:"modals/advanced-filters/author/advanced-filters-author.template.html",windowClass:"filterAuthorModal",resolve:{activeAdvancedFilters:function(){return b}},controller:"AdvancedFiltersAuthorModalController"})},reporter:function(b){a.open({templateUrl:"modals/advanced-filters/reporter/advanced-filters-reporter.template.html",windowClass:"filterAuthorModal",resolve:{activeAdvancedFilters:function(){return b}},controller:"AdvancedFiltersReporterModalController"})},period:function(a){b.open(!0).then(function(b){if(b.beginDate){var c={title:"A partir da data",type:"beginDate",desc:moment(b.beginDate).format("DD/MM/YYYY"),value:moment(b.beginDate).startOf("day").format()};a.push(c)}if(b.endDate){var d={title:"Até a data",type:"endDate",desc:moment(b.endDate).format("DD/MM/YYYY"),value:moment(b.endDate).endOf("day").format()};a.push(d)}})},area:function(b){return a.open({templateUrl:"modals/advanced-filters/area/advanced-filters-area.template.html",windowClass:"filterAreaModal",resolve:{activeAdvancedFilters:function(){return b}},controller:"AdvancedFiltersAreaModalController"})},fields:function(b){f.resolvingRequest=!0,a.open({templateUrl:"modals/advanced-filters/fields/advanced-filters-fields.template.html",windowClass:"fieldsCategoriesModal",resolve:{categoriesResponse:["Restangular",function(a){return i("items")}],activeAdvancedFilters:function(){return b}},controller:"AdvancedFiltersFieldsModalController"})},share:function(){a.open({templateUrl:"modals/advanced-filters/share/advanced-filters-share.template.html",windowClass:"shareModal",resolve:{url:function(){var a=d.defer(),b=gapi.client.urlshortener.url.insert({resource:{longUrl:e.absUrl()}});return b.execute(function(b){a.resolve(b.id)}),a.promise}},controller:"AdvancedFiltersShareModalController"})}}}]),angular.module("FullResponseRestangularServiceModule",[]).factory("FullResponseRestangular",["Restangular",function(a){return a.withConfig(function(a){a.setFullResponse(!0)})}]),angular.module("ErrorServiceModule",["ErrorModalControllerModule"]).factory("Error",["$modal","Raven",function(a,b){var c=!1;return{show:function(d){if(c)return b.captureMessage(JSON.stringify(d)),!1;var e=a.open({templateUrl:"modals/error/error.template.html",windowClass:"error-modal",resolve:{response:function(){return d}},controller:"ErrorModalController"});e.result.then(function(){c=!1},function(){c=!1}),c=!0}}}]),angular.module("ReportsCategoriesServiceModule",[]).factory("ReportsCategoriesService",["$rootScope","FullResponseRestangular","$q",function(a,b,c){var d={};d.categories={},d.categoriesStatuses={},d.loadedBasicInfo=!1;var e=function(b){_.each(b.data.categories,function(a){_.each(a.subcategories,function(a){d.categories[a.id]=a}),d.categories[a.id]=a,_.each(a.statuses,function(a){d.categoriesStatuses[a.id]=a})}),a.$emit("reportsCategoriesFetched",d.categories)};return d.purgeCache=function(){return d.categories={},d.categoriesStatuses={},d.loadedBasicInfo=!1,d.fetchAllBasicInfo()},d.fetchAllBasicInfo=function(){var a=b.all("reports").all("categories"),c={};c.display_type="full",c.subcategories_flat=!0,c.return_fields=["id","title","statuses.id","statuses.color","statuses.title","marker.retina.web","pin","parent_id","color","icon"].join();var f=a.customGET(null,c);return f.then(function(a){d.loadedBasicInfo=!0,e(a)}),f},d.fetchTitlesAndIds=function(){var a=b.all("reports").all("categories"),d=c.defer(),e={};e.display_type="full",e.subcategories_flat=!1,e.return_fields=["id","title","subcategories.id","subcategories.title"].join();var f=a.customGET(null,e);return f.then(function(a){d.resolve(a.data.categories)},function(a){d.reject(a)}),d.promise},d}]),angular.module("ReportsItemsServiceModule",["ReportsCategoriesServiceModule"]).factory("ReportsItemsService",["$q","$rootScope","FullResponseRestangular","ReportsCategoriesService",function(a,b,c,d){var e={},f=0;e.reports={},e.total=0,e.clusters=[],e.resetCache=function(){e.reports={},e.clusters=[],e.total=0,f=0},e.resetItemsAndClusters=function(){f=0,e.reports={},e.clusters=[]},e.fetchAll=function(g){g=g||{};var i=c.one("search").all("reports").all("items");g.display_type="full",g.return_fields=["id","protocol","address","category_id","status_id","created_at","overdue","assigned_group.name","assigned_group.title","assigned_user.name","assigned_user.id","user.name","user.id","reporter.name","reporter.id"].join();var j=d.fetchAllBasicInfo(),k=i.customGET(null,g),l=a.defer();return b.$broadcast("reportsItemsFetching"),k.then(function(a){_.each(a.data.reports,function(a){"undefined"==typeof e.reports[a.id]&&(a.order=f++),e.reports[a.id]=a}),e.total=parseInt(a.headers().total,10),_.size(d.categories)<1?j.then(function(){h(),b.$broadcast("reportsItemsFetched",e.reports),l.resolve(e.reports)}):(h(),b.$broadcast("reportsItemsFetched",e.reports),l.resolve(e.reports))}),l.promise},e.fetchClustered=function(g){var j=c.one("search").all("reports").all("items");g.display_type="full",g.return_fields=["id","protocol","address","category_id","categories_ids","status_id","created_at","overdue","position","user.name","user.id"].join();var k=d.fetchAllBasicInfo(),l=j.customGET(null,g),m=a.defer();return b.$broadcast("reportsItemsFetching"),l.then(function(a){e.total=parseInt(a.headers().total,10),_.each(a.data.reports,function(a){"undefined"==typeof e.reports[a.id]&&(a.order=f++),e.reports[a.id]=a}),e.clusters=a.data.clusters,_.size(d.categories)<1?k.then(function(){i(),h(),b.$broadcast("reportsItemsFetched",e.reports),m.resolve(e)}):(i(),h(),b.$broadcast("reportsItemsFetched",e.reports),m.resolve(e))}),m.promise},e.remove=function(b){var d=c.one("reports").one("items",b).remove(),f=a.defer();return d.then(function(){delete e.reports[b],f.resolve()}),f.promise};var g=function(a){return _.each(a,function(a){a.category=d.categories[a.category_id],"undefined"==typeof a.category&&console.log("Report with unknown category",a),a.status=d.categoriesStatuses[a.status_id]})},h=function(){g(e.reports)},i=function(){g(e.clusters)};return e}]),angular.module("InventoriesCategoriesServiceModule",[]).factory("InventoriesCategoriesService",["$rootScope","Restangular","FullResponseRestangular",function(a,b,c){var d={};d.categories={},d.categoriesStatuses={},d.loadedBasicInfo=!1;var e=function(b){_.each(b.data.categories,function(a){d.categories[a.id]=a,_.each(a.statuses,function(a){d.categoriesStatuses[a.id]=a})}),a.$emit("inventoriesCategoriesFetched",d.categories)};return d.purgeCache=function(){return d.categories={},d.categoriesStatuses={},d.loadedBasicInfo=!1,d.fetchAllBasicInfo()},d.fetchAllBasicInfo=function(){var a=c.all("inventory").all("categories"),b={};b.display_type="full",b.return_fields=["id","title","statuses.id","statuses.color","statuses.title","marker.retina.web","pin","plot_format","color"].join();var f=a.customGET(null,b);return f.then(function(a){d.loadedBasicInfo=!0,e(a)}),f},d.getCategory=function(a){var c=b.one("inventory").one("categories",a).get({display_type:"full"});return c},d}]),angular.module("InventoriesItemsServiceModule",["InventoriesCategoriesServiceModule"]).factory("InventoriesItemsService",["$q","$rootScope","FullResponseRestangular","InventoriesCategoriesService",function(a,b,c,d){var e={},f=0;e.items={},e.total=0,e.clusters=[],e.resetCache=function(){e.items={},e.clusters=[],e.total=0,f=0},e.resetItemsAndClusters=function(){f=0,e.items={},e.clusters=[]},e.fetchAll=function(g){g=g||{};var i=c.one("search").all("inventory").all("items");g.display_type="full",g.return_fields=["id","title","address","created_at","updated_at","inventory_status_id","inventory_category_id","user.name","user.id"].join();var j=d.fetchAllBasicInfo(),k=i.customGET(null,g),l=a.defer();return b.$broadcast("inventoriesItemsFetching"),k.then(function(a){_.each(a.data.items,function(a){"undefined"==typeof e.items[a.id]&&(a.order=f++),e.items[a.id]=a}),e.total=parseInt(a.headers().total,10),_.size(d.categories)<1?j.then(function(){h(),b.$broadcast("inventoriesItemsFetched",e.items),l.resolve(e.items)}):(h(),b.$broadcast("inventoriesItemsFetched",e.items),l.resolve(e.items))}),l.promise},e.fetchClustered=function(g){var j=c.one("search").all("inventory").all("items");g.return_fields=["id","title","address","created_at","updated_at","inventory_status_id","position","inventory_category_id","user.name","user.id"].join();var k=d.fetchAllBasicInfo(),l=j.customGET(null,g),m=a.defer();return b.$broadcast("inventoriesItemsFetching"),l.then(function(a){e.total=parseInt(a.headers().total,10),_.each(a.data.items,function(a){"undefined"==typeof e.items[a.id]&&(a.order=f++),e.items[a.id]=a}),e.clusters=a.data.clusters,_.size(d.categories)<1?k.then(function(){i(),h(),b.$broadcast("inventoriesItemsFetched",e.items),m.resolve(e)}):(i(),h(),b.$broadcast("inventoriesItemsFetched",e.items),m.resolve(e))}),m.promise},e.remove=function(b,d){var f=c.one("inventory").one("categories",d).one("items",b).remove(),g=a.defer();return f.then(function(){delete e.items[b],g.resolve()}),g.promise};var g=function(a){return _.each(a,function(a){a.category=d.categories[a.inventory_category_id]||d.categories[a.category_id],"undefined"==typeof a.category&&console.log("Report with unknown category",a),a.status=d.categoriesStatuses[a.inventory_status_id]})},h=function(){g(e.items)},i=function(){g(e.clusters)};return e}]),angular.module("BusinessReportsServiceModule",[]).factory("BusinessReportsService",["$q","FullResponseRestangular",function(a,b){var c=["id","title","summary","begin_date","end_date","charts.id","charts.title","charts.chart_type","charts.data","charts.description","charts.begin_date","charts.end_date","charts.processed","charts.metric","charts.categories.id","charts.categories.title"].join();self.fetchAll=function(c){c=c||{};var d=b.all("business_reports");c.display_type="full",c.return_fields=["id","title","summary","begin_date","end_date"].join();var e=d.customGET(null,c),g=a.defer();return e.then(function(a){var b=a.data;g.resolve(b.map(f))},function(a){g.reject(a)}),g.promise},self.remove=function(c){var d=b.one("business_reports",c).remove(),e=a.defer();return d.then(function(a){e.resolve(a)},function(a){e.reject(a)}),e.promise},self.find=function(d){var e={},g=b.one("business_reports",d);e.display_type="full",e.return_fields=c;var h=g.customGET(null,e),i=a.defer();return h.then(function(a){var c=f(b.stripRestangular(a.data));c._original=angular.copy(c),i.resolve(c)},function(a){i.reject(a)}),i.promise},self.saveCharts=function(a){var c,d,f,g,h=[];return c=_.reject(a.charts,function(b){return self.isValid(a)?void 0:!0}),d=_.reject(c,function(a){return a.id?!0:void 0}),_.each(d,function(c){h.push(b.one("business_reports",a.id).one("charts").customPOST(e(c)))}),f=_.select(c,function(a){return a.id?!0:void 0}),_.each(f,function(c){h.push(b.one("business_reports",a.id).one("charts",c.id).customPUT(e(c)))}),a._original&&a._original.charts.length>0&&(g=_.select(a._original.charts,function(b){return!_.findWhere(a.charts,{id:b.id})}),_.each(g,function(c){h.push(b.one("business_reports",a.id).one("charts",c.id).remove())})),h},self.save=function(d){var e={},h=a.defer();e.return_fields=c;var i,j=g(d);return d.id?(j.id=d.id,i=b.one("business_reports",d.id).customPUT(j),a.all([i].concat(self.saveCharts(d))).then(function(a){var b=f(a[0].data);h.resolve(b)},function(a){h.reject(a)})):(i=b.one("business_reports").customPOST(j),i.then(function(b){var c=b.data;d.id=c.id,a.all(self.saveCharts(d)).then(function(){h.resolve(d)},function(a){h.reject(a)})})),h.promise},self.isValid=function(a){return!!(a.title&&a.title.length>0&&a.charts.length>0&&_.all(a.charts,function(a){return!!(a.title&&a.categories.length>0&&a.period.begin_date&&a.period.end_date)}))};var d=function(a){return{id:a.id,metric:a.metric,type:a.chart_type.replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()})+"Chart",title:a.title,processed:a.processed,description:a.description,period:{begin_date:new Date(a.begin_date),end_date:new Date(a.end_date)},categories:a.categories,data:{cols:_.map(a.data.subtitles,function(a,b){return{type:a,label:b}}),rows:_.map(a.data.content,function(a){return{c:_.map(a,function(a){return{v:a}})}})}}},e=function(a){return{id:a.id,metric:a.metric,chart_type:a.type.toLowerCase().replace(/chart$/,""),title:a.title,description:a.description,begin_date:a.period.begin_date,end_date:a.period.end_date,categories_ids:_.map(a.categories,function(a){return a.id})}},f=function(a){return a.begin_date&&a.end_date&&(a.begin_date=new Date(a.begin_date),a.end_date=new Date(a.end_date)),a.charts?a.charts=_.map(a.charts,d):a.charts=[],a},g=function(a){return{title:a.title,begin_date:a.begin_date,end_date:a.end_date,summary:a.summary}};return self}]),angular.module("GoogleMapServiceModule",[]).factory("GoogleMapService",["ENV","$compile","$rootScope",function(a,b,c){var d={styles:[{},{featureType:"poi.business",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.government",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.medical",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.place_of_worship",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.school",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.sports_complex",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"labels",stylers:[{visibility:"off"},{saturation:-100},{lightness:42}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{saturation:-100},{lightness:47}]},{featureType:"landscape",stylers:[{lightness:82},{saturation:-100}]},{featureType:"water",stylers:[{hue:"#00b2ff"},{saturation:-21},{lightness:-4}]},{featureType:"poi",stylers:[{lightness:19},{weight:.1},{saturation:-22}]},{elementType:"geometry.fill",stylers:[{visibility:"on"},{lightness:18}]},{elementType:"labels.text",stylers:[{saturation:-100},{lightness:28}]},{featureType:"poi.attraction",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{saturation:12},{lightness:25}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels.text",stylers:[{lightness:30}]},{featureType:"landscape.man_made",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{saturation:-100},{lightness:56}]},{featureType:"road.local",elementType:"geometry.fill",stylers:[{lightness:62}]},{featureType:"landscape.man_made",elementType:"geometry",stylers:[{visibility:"off"}]}],map:{zoom:null,mapTypeControl:!1,panControl:!0,panControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT},zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT},scaleControl:!0,scaleControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT},streetViewControl:!0,streetViewControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT}}},e=function(a,b,c,e,f){d.map.zoom=e;var g=new google.maps.LatLng(b,c),h=new google.maps.StyledMapType(d.styles,{name:"zup"});this.itemsAreReports=a,this.map=new google.maps.Map(f,d.map),this.map.mapTypes.set("zup",h),this.map.setMapTypeId("zup"),this.map.setCenter(g),this.currentMarkers={},this.infoWindow=new google.maps.InfoWindow,this.activeFilterAreas=[]};e.prototype.getDistance=function(){var a=this.map.getBounds(),b=a.getCenter(),c=a.getNorthEast();return google.maps.geometry.spherical.computeDistanceBetween(b,c)},e.prototype.clearMarkers=function(){_.each(this.currentMarkers,function(a){a.setMap(null)}),this.currentMarkers={}},e.prototype.createMarker=function(a,b,c,d,e,f){var g,h="";_.isNull(b)?(f&&(h="general-cluster"),g='<div class="marker '+h+'">'):(h=b.isPin?"pin":"",g='<div class="marker '+h+'" style="background-image: url('+b.url+')">'),d&&(g+='<span style="background-color: '+c+';">'+d+"</span>"),g+="</div>";var i=new RichMarker({position:a,map:this.map,draggable:!1,shadow:!1,content:g,extraData:e,isReport:this.itemsAreReports,infoWindow:this.infoWindow});return _.isUndefined(e)?_.isNull(b)&&google.maps.event.addListener(i,"click",this.zoomToMarker):google.maps.event.addListener(i,"click",this.displayInfoWindow),i},e.prototype.zoomToMarker=function(){this.map.setZoom(this.map.getZoom()+1),this.map.setCenter(this.position)},e.prototype.displayInfoWindow=function(){var a;a=this.isReport?'<div class="pinTooltip"><h1>{{ item.category.title }}</h1><p>Enviado em {{ item.created_at | date: \'dd/MM/yy HH:mm\'}}</p><a href="#/reports/{{ item.id }}">Ver detalhes</a></div>':'<div class="pinTooltip"><h1>{{ item.title }}</h1><p>Criado em {{ item.created_at | date: \'dd/MM/yy HH:mm\'}}</p><a href="#/items/{{ item.id }}">Ver detalhes</a></div>';var d=c.$new(!0);d.category=this.extraData.category,d.item=this.extraData.item;var e=b(a)(d);d.$apply(),this.infoWindow.setContent(e[0]),this.infoWindow.open(this.map,this)},e.prototype.createClusterMarker=function(a){var b=new google.maps.LatLng(a.position[0],a.position[1]);return a.categories_ids?this.createMarker(b,null,"#259ECB",a.count,void 0,!0):this.createMarker(b,null,a.category.color,a.count)},e.prototype.createItemMarker=function(a){var b={};this.itemsAreReports||"pin"!==a.category.plot_format?(b.url=a.category.marker.retina.web,b.isPin=!1):(b.url=a.category.pin.retina.web,b.isPin=!0);var c=new google.maps.LatLng(a.position.latitude,a.position.longitude),d=this.createMarker(c,b,!1,!1,{category:a.category,item:a});return d},e.prototype.processMarkers=function(a,b){var c={},d=this;_.each(a,function(a){if((_.isUndefined(a.category)||!a.category)&&_.isUndefined(a.categories_ids))return!1;var b=_.isUndefined(a.category)?a.categories_ids[0]:a.category_id,e=a.position[0].toString()+a.position[1]+a.count+b;d.currentMarkers[e]?(c[e]=d.currentMarkers[e],delete d.currentMarkers[e]):(c[e]=d.createClusterMarker(a),c[e].setMap(d.map),c[e].setVisible(!0))}),_.each(b,function(a){d.currentMarkers[a.id]?(c[a.id]=d.currentMarkers[a.id],delete d.currentMarkers[a.id]):(c[a.id]=d.createItemMarker(a),c[a.id].setMap(d.map),c[a.id].setVisible(!0))}),_.each(this.currentMarkers,function(a){a.setMap(null)}),this.currentMarkers=c},e.prototype.isMarkerInsideBounds=function(a){return this.map.getBounds().contains(a.getPosition())},e.prototype.hideOutOfBoundsMarkers=function(){var a=this;_.each(this.currentMarkers,function(b){b.setVisible(a.isMarkerInsideBounds(b)?!0:!1)})},e.prototype.getMap=function(){return this.map},e.prototype.getZoom=function(){return this.map.getZoom()},e.prototype.getCenter=function(){return this.map.getCenter()},e.prototype.createCircle=function(a,b,c){var d={fillColor:"#6FCCEF",map:this.map,center:a,radius:b,originalDistance:b,strokeWeight:0,zIndex:1};c&&(d.fillColor="#37A6CF",d.strokeWeight=1,d.strokeColor="#37A6CF",d.zIndex=1);var e=new google.maps.Circle(d);return e},e.prototype.clearCircles=function(){for(var a=this.activeFilterAreas.length-1;a>=0;a--)this.activeFilterAreas[a].inner.setMap(null),this.activeFilterAreas[a].outer.setMap(null);this.activeFilterAreas[a]=[]};var f=function(a,b){var c=Math.pow(2,21-b.getZoom());return a+1128.49722*c*.0027};return e.prototype.processAreaFilters=function(a){this.clearCircles();for(var b=a.length-1;b>=0;b--){var c=a[b],d=new google.maps.LatLng(c.latitude,c.longitude),e=this.createCircle(d,c.distance,!0),g=this.createCircle(d,f(c.distance,this));this.activeFilterAreas.push({inner:e,outer:g})}},e.prototype.changeFilterOuterCircles=function(){for(var a=this.activeFilterAreas.length-1;a>=0;a--){var b=f(this.activeFilterAreas[a].outer.originalDistance,this);console.log("original -> ",this.activeFilterAreas[a].outer.originalDistance," new radius -> ",b,"zoom -> ",this.getZoom()),this.activeFilterAreas[a].outer.set("radius",b)}},e}]),angular.module("UserModule",["UserLoginModule","UserLogoutModule","UserUnauthorizedModule"]).config(["$stateProvider",function(a){a.state("user",{"abstract":!0,url:"/user",template:""})}]),angular.module("UserLoginModule",["UserLoginControllerModule"]).config(["$stateProvider",function(a){a.state("user.login",{url:"/login",views:{"@":{templateUrl:"routes/user/login/user-login.template.html",controller:"UserLoginController",controllerAs:"ctrl"}}})}]),angular.module("UserLoginControllerModule",["UserPasswordRecoverModalControllerModule"]).controller("UserLoginController",["$scope","$rootScope","$state","Auth","$modal",function(a,b,c,d,e){var f=a.logoImg;a.blueLogoImg=f.substring(0,f.lastIndexOf("."))+"-blue"+f.substring(f.lastIndexOf(".")),a.login=function(){return a.loginError=!1,a.processingRequest=!0,d.login(a.email,a.password).then(function(){c.go("reports.list")},function(b){a.loginError=!0,a.processingRequest=!1}),!1},a.recoverPassword=function(){e.open({templateUrl:"modals/user/password-recovery/user-password-recovery.template.html",windowClass:"removeModal",controller:"UserPasswordRecoveryModalController"})}}]),angular.module("UserLogoutModule",["UserLogoutControllerModule"]).config(["$stateProvider",function(a){a.state("user.logout",{url:"/logout",views:{"@":{template:"",controller:"UserLogoutController",controllerAs:"ctrl"}}})}]),angular.module("UserLogoutControllerModule",[]).controller("UserLogoutController",["$state","Auth",function(a,b){b.logout(),a.go("user.login")}]),angular.module("UserUnauthorizedModule",["UserUnauthorizedControllerModule"]).config(["$stateProvider",function(a){a.state("user.unauthorized",{url:"/unauthorized",views:{"@":{templateUrl:"routes/user/unauthorized/user-unauthorized.template.html",controller:"UserUnauthorizedController",controllerAs:"ctrl"}}})}]),angular.module("UserUnauthorizedControllerModule",[]).controller("UserUnauthorizedController",["$rootScope","Auth","$scope","$state",function(a,b,c,d){!_.isUndefined(a.hasPermission)&&a.hasPermission("panel_access")&&d.go("/"),b.clearToken(),b.clearUser();var e=c.logoImg;c.blueLogoImg=e.substring(0,e.lastIndexOf("."))+"-blue"+e.substring(e.lastIndexOf("."))}]),angular.module("IndexModule",["IndexControllerModule"]).config(["$stateProvider",function(a){a.state("home",{url:"/",template:"",resolve:{User:["User",function(a){return a()}]},controller:"IndexController"})}]),angular.module("IndexControllerModule",[]).controller("IndexController",["User","$state","$rootScope","$scope","$log",function(a,b,c,d,e){e.info("IndexController created."),b.go(a?c.hasAnyPermission(["inventories_full_access","inventories_categories_edit","inventories_items_create","inventories_items_edit","inventories_items_delete","inventories_items_read_only"])?"items.list":"reports.list":"user.login"),
d.$on("$destroy",function(){e.info("IndexController destroyed.")})}]),angular.module("ReportsModule",["ReportsIndexModule","ReportsShowModule","ReportsAddModule","ReportsCategoriesIndexModule","ReportsCategoriesEditModule"]).config(["$stateProvider",function(a){a.state("reports",{"abstract":!0,url:"/reports",templateUrl:"routes/reports/reports.template.html",resolve:{User:["User",function(a){return a({permissions:["isLogged"]})}]}})}]),angular.module("ReportsIndexModule",["ReportsIndexControllerModule","ReportsIndexMapModule","StyleResultsTableComponentModule"]).config(["$stateProvider",function(a){a.state("reports.list",{url:"",views:{"":{templateUrl:"routes/reports/index/reports-index.template.html",controller:"ReportsIndexController",controllerAs:"ctrl",resolve:{isMap:function(){return!1}}}}})}]),angular.module("ReportsIndexControllerModule",["ReportsDestroyModalControllerModule","OnFocusComponentModule","OnBlurComponentModule","AdvancedFiltersServiceModule","ReportsItemsServiceModule","angular-toArrayFilter"]).controller("ReportsIndexController",["$rootScope","$scope","Restangular","$modal","$q","isMap","AdvancedFilters","$location","$window","$cookies","ReportsItemsService","$state","$log",function(a,b,c,d,e,f,g,h,i,j,k,l,m){m.info("ReportsIndexController created."),b.loading=!0,a.uiHasScroll=!0;var n=1,o=15;b.loadingPagination=!1,b.filtersHash=null,b.categories={},b.categoriesStatuses={},b.total=0,b.reports=[];var p=function(){b.selectedCategories=[],b.selectedStatuses=[],b.selectedUsers=[],b.selectedReporters=[],b.beginDate=null,b.endDate=null,b.searchText=null,b.overdueOnly=null,b.assignedToMyGroup=null,b.assignedToMe=null,b.position=null,b.selectedAreas=[],b.zoom=null,b.clusterize=null};p(),b.sort={column:"created_at",descending:!0},b.changeSorting=function(a){var c=b.sort;c.column===a?c.descending=!c.descending:(c.column=a,c.descending=!1),k.resetCache(),b.reload()},b.selectedCls=function(a){return a===b.sort.column&&"sort-"+b.sort.descending},b.availableFilters=[{name:"Protocolo ou endereço contém...",action:"query"},{name:"Com as categorias...",action:"category"},{name:"Com os estados...",action:"status"},{name:"Criado pelos munícipes...",action:"author"},{name:"Relatados por...",action:"reporter"},{name:"Por período...",action:"date"},{name:"Por perímetro...",action:"area"},{name:"Apenas relatos atrasados...",action:"overdueOnly"},{name:"Associados ao meu grupo...",action:"assignedToMyGroup"},{name:"Associados à mim...",action:"assignedToMe"}],b.activeAdvancedFilters=[],"undefined"!=typeof j.reportsFiltersHash&&(b.activeAdvancedFilters=JSON.parse(i.atob(j.reportsFiltersHash))),"undefined"!=typeof h.search().filters&&(b.filtersHash=h.search().filters,b.activeAdvancedFilters=JSON.parse(i.atob(b.filtersHash)));var q=function(a,b){-1===a.indexOf(b)&&a.push(b)};b.$watch("activeAdvancedFilters",function(){p(),0!==b.activeAdvancedFilters.length?(b.filtersHash=i.btoa(JSON.stringify(b.activeAdvancedFilters)),h.search("filters",b.filtersHash),j.reportsFiltersHash=b.filtersHash):(b.filtersHash=null,h.search("filters",null),delete j.reportsFiltersHash);for(var a=b.activeAdvancedFilters.length-1;a>=0;a--){var c=b.activeAdvancedFilters[a];"query"===c.type&&(b.searchText=c.value),"categories"===c.type&&q(b.selectedCategories,c.value),"statuses"===c.type&&q(b.selectedStatuses,c.value),"authors"===c.type&&q(b.selectedUsers,c.value),"reporters"===c.type&&q(b.selectedReporters,c.value),"beginDate"===c.type&&(b.beginDate=c.value),"endDate"===c.type&&(b.endDate=c.value),"area"===c.type&&q(b.selectedAreas,c.value),"overdueOnly"===c.type&&(b.overdueOnly=!0),"assignedToMyGroup"===c.type&&(b.assignedToMyGroup=!0),"assignedToMe"===c.type&&(b.assignedToMe=!0)}s()},!0),b.generateReportsFetchingOptions=function(){var a={};if(b.position||(a.page=n,a.per_page=o),null!==b.searchText&&(a.query=b.searchText),0!==b.selectedCategories.length&&(a.reports_categories_ids=b.selectedCategories.join()),0!==b.selectedStatuses.length&&(a.statuses_ids=b.selectedStatuses.join()),0!==b.selectedUsers.length&&(a.users_ids=b.selectedUsers.join()),0!==b.selectedReporters.length&&(a.reporters_ids=b.selectedReporters.join()),null!==b.beginDate&&(a.begin_date=b.beginDate),null!==b.endDate&&(a.end_date=b.endDate),""!==b.sort.column&&(a.sort=b.sort.column,a.order=b.sort.descending?"desc":"asc"),0===b.selectedAreas.length&&null!==b.position)a["position[latitude]"]=b.position.latitude,a["position[longitude]"]=b.position.longitude,a["position[distance]"]=b.position.distance;else if(0!==b.selectedAreas.length)for(var c=b.selectedAreas.length-1;c>=0;c--){var d="position["+c+"][latitude]",e="position["+c+"][longitude]",f="position["+c+"][distance]";a[d]=b.selectedAreas[c].latitude,a[e]=b.selectedAreas[c].longitude,a[f]=b.selectedAreas[c].distance}return null!==b.zoom&&(a.zoom=b.zoom),null!==b.clusterize&&(a.clusterize=!0),null!==b.overdueOnly&&(a.overdue=b.overdueOnly),null!==b.assignedToMyGroup&&(a.assigned_to_my_group=b.assignedToMyGroup),null!==b.assignedToMe&&(a.assigned_to_me=b.assignedToMe),a};var r=b.getData=function(a,c){if(b.loadingPagination===!1){b.loadingPagination=!0,"undefined"!=typeof c&&(b.position=c.position,b.zoom=c.zoom,b.clusterize=c.clusterize);var d=b.generateReportsFetchingOptions(),e=k.fetchAll(d);return e.then(function(a){n++,b.reports=a;var c=Math.ceil(b.total/o);n===c+1?b.loadingPagination=null:b.loadingPagination=!1,b.loading=!1}),e}};b.$on("reportsItemsFetching",function(){f&&(b.loading=!0)}),b.$on("reportsItemsFetched",function(){b.total=k.total,b.loading=!1});var s=b.reload=function(a){f?b.$broadcast("mapRefreshRequested",!0):(k.resetCache(),n=1,b.loadingPagination=!1,a===!0&&(b.reloading=!0),b.loadingContent=!0,r().then(function(c){b.loadingContent=!1,b.reports=c,a===!0&&(b.reloading=!1)}))};b.$on("reports:itemRemoved",function(a){b.reload(!0)}),b.reloadMap=function(){a.$emit("mapRefreshRequested")},b.removeFilter=function(a){b.activeAdvancedFilters.splice(b.activeAdvancedFilters.indexOf(a),1)},b.resetFilters=function(){b.activeAdvancedFilters=[],f&&b.$broadcast("mapRefreshRequested",!0)},b.loadFilter=function(a){if("query"===a&&g.query(b.activeAdvancedFilters),"category"===a&&g.category(b.activeAdvancedFilters,"reports"),"status"===a&&g.status(b.activeAdvancedFilters,"reports"),"author"===a&&g.author(b.activeAdvancedFilters),"reporter"===a&&g.reporter(b.activeAdvancedFilters),"date"===a&&g.period(b.activeAdvancedFilters),"area"===a&&g.area(b.activeAdvancedFilters),"overdueOnly"===a){var c={title:"Atraso",type:"overdueOnly",desc:"Apenas relatos atrasados"};b.activeAdvancedFilters.push(c)}if("assignedToMyGroup"===a){var c={title:"Relatos associados",type:"assignedToMyGroup",desc:"Ao meu grupo"};b.activeAdvancedFilters.push(c)}if("assignedToMe"===a){var c={title:"Relatos associados",type:"assignedToMe",desc:"À mim"};b.activeAdvancedFilters.push(c)}},b.search=function(a){b.searchText=a,s()},b.share=function(){g.share()},b.changeToMap=function(){h.url(null!==b.filtersHash?"/reports/map?filters="+b.filtersHash:"/reports/map")},b.changeToList=function(){h.url(null!==b.filtersHash?"/reports?filters="+b.filtersHash:"/reports")},b.deleteReport=function(a){d.open({templateUrl:"modals/reports/destroy/reports-destroy.template.html",windowClass:"removeModal",resolve:{removeReportFromList:function(){return function(a){b.total--,b.reports.splice(b.reports.indexOf(a),1)}},report:function(){return a}},controller:"ReportsDestroyModalController"})},b.editReportStatus=function(a,b){d.open({templateUrl:"modals/reports/edit-status/reports-edit-status.template.html",windowClass:"editStatusModal",resolve:{report:function(){return a},category:function(){return b}},controller:"ReportsEditStatusModalController"})},b.openReport=function(b,c){a.loading||"a"==c.target.parentNode.tagName.toLowerCase()||"a"==c.target.tagName.toLowerCase()||l.go("reports.show",{id:b})},a.pageHasMap=f,b.$on("$destroy",function(){a.pageHasMap=!1,m.info("ReportsIndexController destroyed.")})}]),angular.module("ReportsIndexMapModule",["StyleMapComponentModule","MapComponentModule"]).config(["$stateProvider",function(a){a.state("reports.list.map",{url:"/map",views:{"@reports":{templateUrl:"routes/reports/index/map/reports-index-map.template.html",controller:"ReportsIndexController",controllerAs:"ctrl",resolve:{isMap:function(){return!0}}}}})}]),angular.module("ReportsShowModule",["ReportsShowControllerModule","ReportsShowPrintModule"]).config(["$stateProvider",function(a){a.state("reports.show",{url:"/{id:[0-9]{1,9}}",resolve:{reportResponse:["Restangular","$stateParams",function(a,b){var c=["id","protocol","address","number","district","country","country","postal_code","state","city","created_at","description","comment_required_when_updating_status","feedback","images","inventory_item","inventory_item_category_id","overdue","position","reference","status","user.name","user.email","user.id","user.phone","assigned_user.id","assigned_user.name","assigned_group.id","assigned_group.name","category.id","category.marker","category.icon","category.solver_groups.id","category.solver_groups.name","category.comment_required_when_updating_status","category.comment_required_when_forwarding","category.solver_groups_ids","category.statuses","category.title","category.default_solver_group.name","category.default_solver_group.id"];return a.one("reports").one("items",b.id).get({return_fields:c.join()})}]},views:{"":{templateUrl:"routes/reports/show/reports-show.template.html",controller:"ReportsShowController",controllerAs:"ctrl"}}})}]),angular.module("ReportsShowControllerModule",["MapShowReportComponentModule","ReportsEditStatusModalControllerModule","ReportsEditDescriptionModalControllerModule","ReportsEditCategoryModalControllerModule","ReportsSelectAddressModalControllerModule","ReportsForwardModalControllerModule","ReportsSelectUserModalControllerModule","ReportsEditReferenceModalControllerModule","ReportsPrintModalControllerModule","ReportSearchMapComponentModule","MapNewReportComponentModule","NextFieldOnEnterComponentModule","duScroll"]).value("duScrollOffset",200).controller("ReportsShowController",["$scope","Restangular","$q","$modal","$window","reportResponse","$rootScope","$log",function(a,b,c,d,e,f,g,h){h.info("ReportsShowController created."),a.$on("$destroy",function(){h.info("ReportsShowController destroyed.")}),a.report=f.data,a.report.status_id=a.report.status.id,a.categoryData=a.report.category,a.images=[],a.lat=a.report.position.latitude,a.lng=a.report.position.longitude,b.one("reports",a.report.id).all("comments").getList({return_fields:"id,created_at,message,visibility,author.id,author.name"}).then(function(b){a.comments=b.data}),b.one("reports",a.report.id).one("feedback").get({return_fields:"id,kind,content,images"}).then(function(b){a.feedback=b.data});for(var i=a.report.images.length-1;i>=0;i--)a.images.push({versions:a.report.images[i]});a.newUserResponse={message:null,privateComment:!0,typing:!1},a.newSystemComment={message:null,typing:!1},a.filterByUserMessages=function(a){return 0===a.visibility||1===a.visibility};var j=function(c,d){return b.one("reports",a.report.id).customPOST({message:c,visibility:d,return_fields:"id,created_at,message,visibility,author.id,author.name"},"comments")};a.submitUserResponse=function(){a.processingComment=!0;var b=0;a.newUserResponse.privateComment&&(b=1);var c=j(a.newUserResponse.message,b);c.then(function(b){a.newUserResponse.message=null,a.processingComment=!1,a.comments.push(b.data),a.refreshHistory()})},a.submitSystemComment=function(){a.processingSystemComment=!0;var b=j(a.newSystemComment.message,2);b.then(function(b){a.processingSystemComment=!1,a.newSystemComment.message=null,a.comments.push(b.data),a.refreshHistory()})},a.editCategory=function(){g.resolvingRequest=!0,d.open({templateUrl:"modals/reports/edit-category/reports-edit-category.template.html",windowClass:"report-edit-category-modal",resolve:{report:function(){return a.report},category:function(){return a.report.category},categories:function(){return b.all("reports").all("categories").getList({display_type:"full",return_fields:"id,title,subcategories.id,subcategories.title"})}},controller:"ReportsEditCategoryModalController"})},a.editReportStatus=function(c,e){g.resolvingRequest=!0,d.open({templateUrl:"modals/reports/edit-status/reports-edit-status.template.html",windowClass:"editStatusModal",resolve:{report:function(){return c},category:function(){return e},statusesResponse:function(){return b.one("reports").one("categories",a.report.category.id).all("statuses").getList()}},controller:"ReportsEditStatusModalController"})};var k=["address","number","city","postal_code","reference","state","country","district"],l=a.lat,m=a.lng;a.editAddress=function(){a.editingAddress=!0,l=a.lat,m=a.lng,a.address={},_.each(k,function(b){a.address[b]=a.report[b]}),a.address.number=parseInt(a.address.number,10)},a.cancelAddressEdit=function(){a.editingAddress=!1,a.lat=l,a.lng=m},a.saveAddress=function(c){if(c.$submitted=!0,c.$valid){a.savingAddress=!0;var d={latitude:a.lat,longitude:a.lng,return_fields:"position.latitude,position.longitude,address,number,reference,district,postal_code,state,city"};_.each(k,function(a){d[a]=c[a].$viewValue});var e=b.one("reports",a.report.category.id).one("items",a.report.id).customPUT(d);e.then(function(b){var c=b.data;a.showMessage("ok","O endereço do relato foi alterado com sucesso.","success",!0),a.loading=a.savingAddress=a.editingAddress=!1,a.report.position=c.position,a.lat=a.report.position.latitude,a.lng=a.report.position.longitude,_.each(k,function(b){a.report[b]=c[b]})})}},a.editDescription=function(){d.open({templateUrl:"modals/reports/edit-description/reports-edit-description.template.html",windowClass:"editReportModal",resolve:{report:function(){return a.report},refreshHistory:function(){return a.refreshHistory}},controller:"ReportsEditDescriptionModalController"})},a.editReference=function(){d.open({templateUrl:"modals/reports/edit-reference/reports-edit-reference.template.html",windowClass:"editReportModal",resolve:{report:function(){return a.report}},controller:"ReportsEditReferenceModalController"})},a.forwardReport=function(){g.resolvingRequest=!0,d.open({templateUrl:"modals/reports/forward/reports-forward.template.html",windowClass:"reports-forward-modal",resolve:{report:function(){return a.report},category:function(){return a.report.category},groupsResponse:function(){return b.all("groups").getList({return_fields:"id,name"})}},controller:"ReportsForwardModalController"})},a.assignReport=function(){d.open({templateUrl:"modals/reports/select-user/reports-select-user.template.html",windowClass:"modal-reports-select-user",resolve:{setUser:["Restangular","$state","$rootScope",function(b,c,d){return function(e){d.resolvingRequest=!0;var f=b.one("reports",a.report.category.id).one("items",a.report.id).one("assign").customPUT({user_id:e.id,return_fields:""});f.then(function(){d.resolvingRequest=!1,a.showMessage("ok","O usuário responsável foi alterado com sucesso.","success",!0),c.go(c.current,{},{reload:!0})})}}],filterByGroup:function(){return a.report.assigned_group.id}},controller:"ReportsSelectUserModalController"})},a.print=function(){d.open({templateUrl:"modals/reports/print/reports-print.template.html",windowClass:"filterCategoriesModal",resolve:{openModal:function(){return function(b){e.open("#/reports/"+a.report.id+"/print?sections="+b.join(),"ZUP Imprimir relato","height=800,width=850")}}},controller:"ReportsPrintModalController"})},a.refreshHistory=function(){var c={return_fields:"changes,created_at,kind,user.id,user.name"},d=a.selectedFilters();0!==d.length&&(c.kind=d.join()),a.historyFilterBeginDate&&(c["created_at[begin]"]=a.historyFilterBeginDate),a.historyFilterEndDate&&(c["created_at[end]"]=a.historyFilterEndDate),a.loadingHistoryLogs=!0;var e=b.one("reports").one("items",a.report.id).one("history").getList(null,c);e.then(function(b){a.historyLogs=b.data;for(var c=!1,d=0;d<a.historyLogs.length;d++){var e=a.historyLogs[d],f=e.kind;if("overdue"!==f){if(c&&("status"===f||"creation"===f)){a.overdue_status=e.changes["new"].title;break}}else c=!0}a.loadingHistoryLogs=!1})},a.historyOptions={type:void 0},a.availableHistoryFilters=[{type:"category",name:"Categoria",selected:!1},{type:"status",name:"Estados",selected:!1},{type:"address",name:"Endereço",selected:!1},{type:"description",name:"Descrição",selected:!1},{type:"category",name:"Categoria",selected:!1}],a.availableHistoryDateFilters=[{name:"Hoje",beginDate:moment().startOf("day").format(),endDate:moment().endOf("day").format(),selected:!1},{name:"Ontem",beginDate:moment().subtract(1,"days").startOf("day").format(),endDate:moment().subtract(1,"days").endOf("day").format(),selected:!1},{name:"Este mês",beginDate:moment().startOf("month").format(),endDate:moment().subtract(1,"days").endOf("day").format(),selected:!1},{name:"Mês passado",beginDate:moment().subtract(1,"months").startOf("month").format(),endDate:moment().subtract(1,"months").subtract(1,"days").endOf("day").format(),selected:!1},{name:"Todos",beginDate:null,endDate:null,selected:!0}],a.selectedFilters=function(){var b=[];return _.each(a.availableHistoryFilters,function(a){a.selected&&b.push(a.type)}),b},a.toggleOption=function(b){b.selected=!b.selected,a.refreshHistory()};var n=a.report.address,o=a.report.number,p=!1;a.fieldOnEnter=function(b,c){return"address"==b.name||""==a.address.address||""==a.address.number?void(p=!1):void((a.address.address!=n||a.address.number!=parseInt(o,10))&&(p=!0,n=a.address.address,o=a.address.number,a.$broadcast("addressChanged")))},a.$on("reports:position-updated",function(b,c){a.lat=c.lat(),a.lng=c.lng(),p||a.$broadcast("addressChanged",!0)}),a.resetHistoryFilters=function(){_.each(a.availableHistoryFilters,function(a){a.selected=!0}),a.refreshHistory()},a.showCustomDateFields=function(){_.each(a.availableHistoryDateFilters,function(a){a.selected=!1}),a.showCustomDateHelper=!0},a.selectDateFilter=function(b){_.each(a.availableHistoryDateFilters,function(a){a.selected=!1}),b.selected=!b.selected,a.historyFilterBeginDate=b.beginDate,a.historyFilterEndDate=b.endDate,a.showCustomDateHelper=!1,a.refreshHistory()},a.historyLogs=[],a.refreshHistory()}]),angular.module("ReportsShowPrintModule",["ReportsShowPrintControllerModule"]).config(["$stateProvider",function(a){a.state("reports.show.print",{url:"/print?sections",resolve:{reportResponse:["Restangular","$stateParams",function(a,b){return a.one("reports").one("items",b.id).get()}],feedbackResponse:["Restangular","$stateParams",function(a,b){return a.one("reports",b.id).one("feedback").get()}],commentsResponse:["Restangular","$stateParams",function(a,b){return a.one("reports",b.id).all("comments").getList()}],reportHistoryResponse:["Restangular","$stateParams",function(a,b){return a.one("reports").one("items",b.id).one("history").getList()}]},views:{"@":{templateUrl:"routes/reports/show/print/reports-show-print.template.html",controller:"ReportsShowPrintController",controllerAs:"ctrl"}}})}]),angular.module("ReportsShowPrintControllerModule",["MapShowReportComponentModule"]).controller("ReportsShowPrintController",["$scope","$window","$timeout","$document","$stateParams","reportResponse","feedbackResponse","commentsResponse","reportHistoryResponse",function(a,b,c,d,e,f,g,h,i){a.report=f.data,a.report.status_id=a.report.status.id,a.feedback=g.data,a.comments=h.data;var j=e.sections.split(",");a.showSection=function(a){return-1!==j.indexOf(a)},a.filterByUserMessages=function(a){return 0===a.visibility||1===a.visibility},a.historyLogs=i.data;var k=a.logoImg;a.blueLogoImg=k.substring(0,k.lastIndexOf("."))+"-blue"+k.substring(k.lastIndexOf(".")),a.print=function(){var a=b.document,c=a.getElementById("printSection"),c=a.createElement("div");c.id="printSection",a.body.appendChild(c);var d=a.getElementById("printContent"),e=d.cloneNode(!0);c.appendChild(e),b.print()}}]),angular.module("ReportsAddModule",["ReportsAddControllerModule"]).config(["$stateProvider",function(a){a.state("reports.add",{url:"/add",views:{"":{templateUrl:"routes/reports/add/reports-add.template.html",controller:"ReportsAddController",controllerAs:"ctrl",resolve:{inventoriesCategoriesResponse:["Restangular","$stateParams",function(a,b){return a.all("inventory").all("categories").getList({display_type:"full",return_fields:["id","title","pin","marker"].join()})}],reportCategoriesResponse:["Restangular","$stateParams",function(a,b){return a.all("reports").all("categories").getList({display_type:"full",return_fields:["id","title","pin","marker","inventory_categories","subcategories.id","subcategories.title","subcategories.inventory_categories","subcategories.pin","subcategories.marker"].join()})}]}}}})}]),angular.module("ReportsAddControllerModule",["SelectListComponentModule","ReportsSelectUserModalControllerModule","ReportsCreateUserModalControllerModule","ReportSearchMapComponentModule","MapNewReportComponentModule","NgThumbComponentModule"]).controller("ReportsAddController",["ENV","$scope","$rootScope","Restangular","$q","$modal","$state","FileUploader","onlyImagesUploaderFilter","reportCategoriesResponse","inventoriesCategoriesResponse",function(a,b,c,d,e,f,g,h,i,j,k){var l=j.data;b.address={city:a.defaultCity,state:a.defaultState,country:a.defaultCountry},b.categories=l,b.createAnother=!1,b.inventoryCategories=k.data;var m=b.uploader=new h;b.selectedCategory=null,m.filters.push(i(m.isHTML5)),b.getInventoryCategory=function(a){for(var c=b.inventoryCategories.length-1;c>=0;c--)if(b.inventoryCategories[c].id===a)return b.inventoryCategories[c];return null},b.$watch("selectedCategory",function(a,c){if(a!==c)for(var d=b.categories.length-1;d>=0;d--){if(b.categories[d].id===parseInt(b.selectedCategory))return b.categoryData=b.categories[d];if(0!==b.categories[d].subcategories.length)for(var e=b.categories[d].subcategories.length-1;e>=0;e--)if(b.categories[d].subcategories[e].id===parseInt(b.selectedCategory))return b.categoryData=b.categories[d].subcategories[e]}}),b.selectUser=function(){f.open({templateUrl:"modals/reports/select-user/reports-select-user.template.html",windowClass:"modal-reports-select-user",resolve:{setUser:function(){return function(a){b.user=a}},filterByGroup:function(){return null}},controller:"ReportsSelectUserModalController"})},b.registerUser=function(){f.open({templateUrl:"modals/reports/create-user/reports-create-user.template.html",windowClass:"modal-reports-create-user",resolve:{setUser:function(){return function(a){b.user=a}}},controller:"ReportsCreateUserModalController"})};var n=function(a){var b=e.defer(),c=new FileReader;return c.addEventListener("load",function(a){var c=a.target;b.resolve(c.result.replace(/^data:image\/[^;]+;base64,/,""))}),c.readAsDataURL(a),b.promise};b.$on("reportMap:position_changed",function(a,c){b.lat=c.lat(),b.lng=c.lng()});var o=b.address.address,p=b.address.number,q=!1;b.fieldOnEnter=function(a,c){return"address"==a.name||""==b.address.address||""==b.address.number?void(q=!1):void((b.address.address!=o||b.address.number!=parseInt(p,10))&&(q=!0,o=b.address.address,p=b.address.number,b.$broadcast("addressChanged")))},b.$on("reports:position-updated",function(a,c){b.lat=c.lat(),b.lng=c.lng(),q||b.$broadcast("addressChanged",!0)}),b.send=function(){c.resolvingRequest=!0;for(var a=[],f=b.uploader.queue.length-1;f>=0;f--)a.push(n(b.uploader.queue[f]._file));e.all(a).then(function(a){var e={latitude:b.lat,longitude:b.lng,inventory_item_id:b.itemId,description:b.description,reference:b.address.reference,address:b.address.address,number:b.address.number,district:b.address.district,city:b.address.city,state:b.address.state,country:b.address.country,postal_code:b.address.postal_code,images:a,return_fields:"id"};b.user&&(e.user_id=b.user.id);var f=d.one("reports",b.selectedCategory).customPOST(e,"items");f.then(function(a){b.showMessage("ok","O relato foi criado com sucesso.","success",!0),b.createAnother?(b.lat=null,b.lng=null,b.itemId=null,b.description=null,b.formattedAddress=null,b.reference=null,b.user=null,b.address={},b.uploader.clearQueue(),c.resolvingRequest=!1):g.go("reports.show",{id:a.data.id})})})}}]),angular.module("ReportsCategoriesIndexModule",["ReportsCategoriesIndexControllerModule","ReportsCategoriesServiceModule"]).config(["$stateProvider",function(a){a.state("reports.categories",{url:"/categories",cache:!1,views:{"":{templateUrl:"routes/reports/categories/index/reports-categories-index.template.html",controller:"ReportsCategoriesIndexController",controllerAs:"ctrl"}}})}]),angular.module("ReportsCategoriesIndexControllerModule",["ReportsCategoriesDestroyModalControllerModule","ReportsCategoriesServiceModule"]).controller("ReportsCategoriesIndexController",["$scope","ReportsCategoriesService","$modal",function(a,b,c){a.loading=!0;var d=function(b){b=angular.copy(b),_.each(b,function(c){if(null!==c.parent_id){var d=b.indexOf(_.findWhere(b,{id:c.parent_id}));if(-1===d)return!1;var e=b.indexOf(c);_.isUndefined(b[d].subcategories)?b[d].subcategories=[c]:b[d].subcategories.push(c),b[e]=void 0}b=_.without(b,void 0),a.categories=b,a.loading=!1})};b.fetchAllBasicInfo().then(function(a){d(a.data.categories)}),a.iconSeed=Math.random().toString(36).substring(7),a.deleteCategory=function(b){c.open({templateUrl:"modals/reports/categories/destroy/reports-categories-destroy.template.html",windowClass:"removeModal",resolve:{destroyCategory:function(){return function(b){if(_.isNull(b.parent_id))a.categories.splice(a.categories.indexOf(b),1);else{var c=_.findWhere(a.categories,{id:b.parent_id}).subcategories;c.splice(c.indexOf(b),1)}}},category:function(){return b}},controller:"ReportsCategoriesDestroyModalController"})}}]),angular.module("ReportsCategoriesEditModule",["ReportsCategoriesEditControllerModule"]).config(["$stateProvider",function(a){a.state("reports.categories.edit",{url:"/{id:[0-9]{1,4}}/edit",views:{"@reports":{templateUrl:"routes/reports/categories/edit/reports-categories-edit.template.html",controller:"ReportsCategoriesEditController",controllerAs:"ctrl",resolve:{reportCategoriesResponse:["Restangular",function(a){return a.all("reports").all("categories").getList({display_type:"full",return_fields:"id,title"})}],groupsResponse:["Restangular",function(a){return a.all("groups").getList({return_fields:"id,name"})}]}}}}).state("reports.categories.add",{url:"/add",views:{"@reports":{templateUrl:"routes/reports/categories/edit/reports-categories-edit.template.html",controller:"ReportsCategoriesEditController",controllerAs:"ctrl",resolve:{reportCategoriesResponse:["Restangular",function(a){return a.all("reports").all("categories").getList({return_fields:"id,title"})}],groupsResponse:["Restangular",function(a){return a.all("groups").getList({return_fields:"id,name"})}]}}}})}]),angular.module("ReportsCategoriesEditControllerModule",["FormatErrorsHelperModule","NgThumbComponentModule","MultipleSelectListComponentModule","ReportsCategoriesManageStatusesModalControllerModule","ReportsCategoriesServiceModule"]).controller("ReportsCategoriesEditController",["$scope","$rootScope","$stateParams","Restangular","FileUploader","singleItemUploaderFilter","onlyImagesUploaderFilter","$q","$location","$modal","$document","reportCategoriesResponse","groupsResponse","Error","ReportsCategoriesService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=a.updating=!1,q=c.id;"undefined"!=typeof q&&(p=!0,a.updating=!0),a.mainColors=["#59B1DF","#7DDCE2","#64D2AF","#5CB466","#99C450","#EACD31","#F3AC2E","#F18058","#EF4D3E","#E984FC","#A37FE1","#7A7AF2"],a.alternativeColors=["#4383A6","#5CAFB5","#4D9F88","#3E7148","#73943D","#AC9827","#B78226","#C45C35","#A23463","#A938BE","#7340C1","#5051BB","#28344E","#465366","#677B86","#8195A0","#A0B2BCv","#B9CDD8"],a.loading=!0,a.defaultResolutionTimeSelection=60,a.defaultUserResponseTimeSelection=60;var r=86400,s=3600,t=60,u=function(a){return a%r==0?r:a%s==0?s:t};a.reportCategories=l.data,a.groups=m.data;var v,w=d.one("inventory").all("categories").getList({return_fields:"id,title"});if(p){v=a.category={};var x=d.one("reports").one("categories",q).get();h.all([w,x]).then(function(b){if(a.categories=b[0].data,v.title=b[1].data.title,v.color=b[1].data.color,v.confidential=b[1].data.confidential,v.parent_id=b[1].data.parent_id,v.allows_arbitrary_position=b[1].data.allows_arbitrary_position,v.statuses=b[1].data.statuses,v.private_resolution_time=b[1].data.private_resolution_time,v.resolution_time_enabled=b[1].data.resolution_time_enabled,v.comment_required_when_forwarding=b[1].data.comment_required_when_forwarding,v.comment_required_when_updating_status=b[1].data.comment_required_when_updating_status,v.solver_groups_ids=b[1].data.solver_groups_ids,v.default_solver_group_id=b[1].data.default_solver_group_id,null!==b[1].data.user_response_time&&(a.enabledUserResponseTime=!0,v.user_response_time=b[1].data.user_response_time,a.defaultUserResponseTimeSelection=u(v.user_response_time),a.preferedUserResponseTime=v.user_response_time/a.defaultUserResponseTimeSelection),null!==b[1].data.resolution_time&&(v.resolution_time=b[1].data.resolution_time,a.defaultResolutionTimeSelection=u(v.resolution_time),a.preferedResolutionTime=v.resolution_time/a.defaultResolutionTimeSelection),v.inventory_categories=[],"object"==typeof b[1].data.inventory_categories&&0!==b[1].data.inventory_categories.length)for(var c=b[1].data.inventory_categories.length-1;c>=0;c--)v.inventory_categories.push(b[1].data.inventory_categories[c].id);a.icon=b[1].data.original_icon,a.loading=!1})}else w.then(function(b){a.categories=b.data,a.loading=!1}),a.enabledUserResponseTime=!1,v=a.category={marker:"R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",inventory_categories:[],allows_arbitrary_position:!0,color:"#2AB4DC",solver_groups_ids:[],default_solver_group_id:null,statuses:[{title:"Em andamento",color:"#f8b01d",initial:!1,"final":!1,active:!0,created_at:"2014-03-05T01: 12: 34.181-03: 00",updated_at:"2014-03-05T01: 12: 34.181-03: 00","private":!1},{title:"Resolvidas",color:"#78c953",initial:!1,"final":!0,active:!0,created_at:"2014-03-05T01: 12: 34.195-03: 00",updated_at:"2014-03-05T01: 12: 34.195-03: 00","private":!1},{title:"Não resolvidas",color:"#999999",initial:!1,"final":!0,active:!0,created_at:"2014-03-05T01: 12: 34.200-03: 00",updated_at:"2014-03-05T01: 12: 34.200-03: 00","private":!1},{title:"Em aberto",color:"#ff0000",initial:!0,"final":!1,active:!0,created_at:"2014-03-17T22: 52: 50.365-03: 00",updated_at:"2014-03-17T22: 52: 50.365-03: 00","private":!1}]};var y=a.uploader=new e;y.filters.push(g(y.isHTML5)),y.filters.push(f),a.pickColor=function(b){a.category.color=b},a.pickIcon=function(b){a.selectedIcon=b,y.queue=[]},a.filterByIds=function(a){return _.isUndefined(v.solver_groups_ids)?!1:~v.solver_groups_ids.indexOf(a.id)?!0:!1},a.categoriesAutocomplete={options:{source:function(a,b){var c=d.one("search").one("inventory").all("categories").getList({title:a.term,return_fields:"id,title"});c.then(function(a){b($.map(a.data,function(a){return{label:a.title,value:a.title,id:a.id}}))})},select:function(b,c){a.addCategory(c.item.id)},messages:{noResults:"",results:function(){}}}},a.addCategory=function(a){~v.inventory_categories.indexOf(a)||v.inventory_categories.push(a)},a.removeCategory=function(a){v.inventory_categories.splice(v.inventory_categories.indexOf(a),1)},a.manageStatuses=function(){j.open({templateUrl:"modals/reports/categories/manage-statuses/reports-categories-manage-statuses.template.html",windowClass:"manageStatuses",resolve:{category:function(){return a.category},updating:function(){return p},categoryId:function(){return q}},controller:"ReportsCategoriesManageStatusesModalController"})},a.$watch("preferedResolutionTime",function(){v.resolution_time=a.preferedResolutionTime*a.defaultResolutionTimeSelection}),a.changeDefaultResolutionTimeSelection=function(b){a.preferedResolutionTime=Math.round(v.resolution_time/b),a.defaultResolutionTimeSelection=b},a.$watch("preferedUserResponseTime",function(){v.user_response_time=a.preferedUserResponseTime*a.defaultUserResponseTimeSelection;
}),a.changeDefaultUserResponseTimeSelection=function(b){a.preferedUserResponseTime=Math.round(v.user_response_time/b),a.defaultUserResponseTimeSelection=b},a.send=function(){function c(a){var b=h.defer(),c=new FileReader;return c.addEventListener("load",function(a){var c=a.target,d=c.result.replace(/^data:image\/[^;]+;base64,/,"");b.resolve(d)}),c.readAsDataURL(a),b.promise}a.inputErrors=null,b.resolvingRequest=!0;var e=[];if(0==y.queue.length&&a.selectedIcon){var f=function(){var b=h.defer(),c=k[0].createElement("CANVAS"),d=c.getContext("2d"),e=new Image;return e.crossOrigin="Anonymous",e.onload=function(){c.height=e.height,c.width=e.width,d.drawImage(e,0,0);var a=c.toDataURL("image/png");b.resolve(a.replace(/^data:image\/[^;]+;base64,/,"")),c=null},e.src="assets/images/icons/"+a.selectedIcon+".png",b.promise}();e.push(f)}else for(var g=y.queue.length-1;g>=0;g--)e.push(c(y.queue[g]._file));h.all(e).then(function(c){var e=c[0],f=angular.copy(v),g=f.statuses;f.statuses={};for(var h=g.length-1;h>=0;h--)g[h].initial=g[h].initial.toString(),g[h]["final"]=g[h]["final"].toString(),g[h].active=g[h].active.toString(),g[h]["private"]=g[h]["private"].toString(),f.statuses[h]=g[h];if(f.resolution_time=f.resolution_time,"undefined"!=typeof f.user_response_time&&"null"!==f.user_response_time&&1==a.enabledUserResponseTime?f.user_response_time=f.user_response_time:f.user_response_time=null,p){e&&(f.icon=e);var j=d.one("reports").one("categories",q).withHttpConfig({treatingErrors:!0}).customPUT(f);j.then(function(){o.purgeCache(),a.showMessage("ok","A categoria de relato foi atualizada com sucesso","success",!0),b.resolvingRequest=!1},function(c){a.showMessage("exclamation-sign","A categoria de relato não pode ser salva","error",!0),"object"!=typeof c.data.error?n.show(c):a.inputErrors=c.data.error,b.resolvingRequest=!1})}else{f.icon=e,f.marker=e;var k=d.one("reports").withHttpConfig({treatingErrors:!0}).post("categories",f);k.then(function(){o.purgeCache(),a.showMessage("ok","A categoria de relato foi criada com sucesso","success",!0),i.path("/reports/categories"),b.resolvingRequest=!1},function(c){a.showMessage("exclamation-sign","A categoria de relato não pode ser salva","error",!0),"object"!=typeof c.data.error?n.show(c):a.inputErrors=c.data.error,b.resolvingRequest=!1})}})}}]),angular.module("ItemsModule",["ItemsIndexModule","ItemsShowModule","ItemsEditModule","ItemsSelectCategoryModule","ItemsCategoriesIndexModule","ItemsCategoriesEditModule"]).config(["$stateProvider",function(a){a.state("items",{"abstract":!0,url:"/items",templateUrl:"routes/items/items.template.html",resolve:{User:["User",function(a){return a({permissions:["isLogged"]})}]}})}]),angular.module("ItemsIndexModule",["ItemsIndexControllerModule","ItemsIndexMapModule","StyleResultsTableComponentModule"]).config(["$stateProvider",function(a){a.state("items.list",{url:"",views:{"":{templateUrl:"routes/items/index/items-index.template.html",controller:"ItemsIndexController",controllerAs:"ctrl",resolve:{isMap:function(){return!1}}}}})}]),angular.module("ItemsIndexControllerModule",["AdvancedFiltersServiceModule","InventoriesItemsServiceModule","ItemsDestroyModalControllerModule","angular-toArrayFilter"]).controller("ItemsIndexController",["$state","$scope","$rootScope","$modal","$q","isMap","AdvancedFilters","$location","$window","$cookies","InventoriesItemsService","$log",function(a,b,c,d,e,f,g,h,i,j,k,l){l.info("ItemsIndexController created."),b.loading=!0,c.uiHasScroll=!0;var m=1,n=15;b.loadingPagination=!1,b.filtersHash=null,b.categories={},b.categoriesStatuses={},b.total=0;var o=function(){b.selectedCategories=[],b.selectedStatuses=[],b.selectedUsers=[],b.beginDate=null,b.endDate=null,b.searchText=null,b.fields=[],b.position=null,b.selectedAreas=[],b.zoom=null,b.clusterize=null};o(),b.sort={column:"created_at",descending:!0},b.changeSorting=function(a){var c=b.sort;c.column===a?c.descending=!c.descending:(c.column=a,c.descending=!1),k.resetCache(),b.reload()},b.selectedCls=function(a){return a===b.sort.column&&"sort-"+b.sort.descending},b.availableFilters=[{name:"Protocolo ou endereço contém...",action:"query"},{name:"Com as categorias...",action:"category"},{name:"Com os estados...",action:"status"},{name:"Por criador do item...",action:"author"},{name:"Por período...",action:"date"},{name:"Por perímetro...",action:"area"},{name:"Por campos...",action:"fields"}],b.activeAdvancedFilters=[],"undefined"!=typeof j.inventoryFiltersHash&&(b.activeAdvancedFilters=JSON.parse(i.atob(j.inventoryFiltersHash))),"undefined"!=typeof h.search().filters&&(b.filtersHash=h.search().filters,b.activeAdvancedFilters=JSON.parse(i.atob(b.filtersHash)));b.$watch("activeAdvancedFilters",function(){o(),0!==b.activeAdvancedFilters.length?(b.filtersHash=i.btoa(JSON.stringify(b.activeAdvancedFilters)),h.search("filters",b.filtersHash),j.inventoryFiltersHash=b.filtersHash):(b.filtersHash=null,h.search("filters",null),delete j.inventoryFiltersHash);for(var a=b.activeAdvancedFilters.length-1;a>=0;a--){var c=b.activeAdvancedFilters[a];"query"===c.type&&(b.searchText=c.value),"categories"===c.type&&b.selectedCategories.push(c.value),"statuses"===c.type&&b.selectedStatuses.push(c.value),"authors"===c.type&&b.selectedUsers.push(c.value),"fields"===c.type&&b.fields.push(c.value),"beginDate"===c.type&&(b.beginDate=c.value),"endDate"===c.type&&(b.endDate=c.value),"area"===c.type&&b.selectedAreas.push(c.value)}q()},!0),b.generateItemsFetchingOptions=function(){var a={};if(b.position||(a.page=m,a.per_page=n),null!==b.searchText&&(a.query=b.searchText),0!==b.selectedCategories.length&&(a.inventory_categories_ids=b.selectedCategories.join()),0!==b.selectedStatuses.length&&(a.inventory_statuses_ids=b.selectedStatuses.join()),0!==b.selectedUsers.length&&(a.users_ids=b.selectedUsers.join()),null!==b.beginDate&&(a["created_at[begin]"]=b.beginDate),null!==b.endDate&&(a["created_at[end]"]=b.endDate),""!==b.sort.column&&(a.sort=b.sort.column,a.order=b.sort.descending?"desc":"asc"),0!==b.fields.length){console.log(b.fields);for(var c=b.fields.length-1;c>=0;c--){var d="fields["+b.fields[c].id+"]["+b.fields[c].condition+"]";if(_.isArray(b.fields[c].value))for(var e=b.fields[c].value.length-1;e>=0;e--){var f=d+"["+e+"]";a[f]=b.fields[c].value[e]}else a[d]=b.fields[c].value}}if(0===b.selectedAreas.length&&null!==b.position)a["position[latitude]"]=b.position.latitude,a["position[longitude]"]=b.position.longitude,a["position[distance]"]=b.position.distance;else if(0!==b.selectedAreas.length)for(var g=b.selectedAreas.length-1;g>=0;g--){var h="position["+g+"][latitude]",i="position["+g+"][longitude]",j="position["+g+"][distance]";a[h]=b.selectedAreas[g].latitude,a[i]=b.selectedAreas[g].longitude,a[j]=b.selectedAreas[g].distance}return null!==b.zoom&&(a.zoom=b.zoom),null!==b.clusterize&&(a.clusterize=!0),a};var p=b.getData=function(a,c){if(b.loadingPagination===!1){b.loadingPagination=!0,"undefined"!=typeof c&&(b.position=c.position,b.zoom=c.zoom,b.clusterize=c.clusterize);var d=k.fetchAll(b.generateItemsFetchingOptions());return d.then(function(a){m++,b.items=a,b.total=k.total;var c=Math.ceil(b.total/n);m===c+1?b.loadingPagination=null:b.loadingPagination=!1,b.loading=!1}),d}};b.$on("inventoriesItemsFetching",function(){f&&(b.loading=!0)}),b.$on("inventoriesItemsFetched",function(){b.total=k.total,b.loading=!1});var q=b.reload=function(a){f?b.$broadcast("mapRefreshRequested",!0):(k.resetCache(),m=1,b.loadingPagination=!1,a===!0&&(b.reloading=!0),b.loadingContent=!0,b.items=[],p().then(function(c){b.loadingContent=!1,b.items=c,a===!0&&(b.reloading=!1)}))};b.reloadMap=function(){c.$emit("mapRefreshRequested")},b.removeFilter=function(a){b.activeAdvancedFilters.splice(b.activeAdvancedFilters.indexOf(a),1)},b.resetFilters=function(){b.activeAdvancedFilters=[],f&&b.$broadcast("updateMap",!0)},b.loadFilter=function(a){"query"===a&&g.query(b.activeAdvancedFilters),"category"===a&&g.category(b.activeAdvancedFilters,"items"),"status"===a&&g.status(b.activeAdvancedFilters,"items"),"author"===a&&g.author(b.activeAdvancedFilters),"fields"===a&&g.fields(b.activeAdvancedFilters,"items"),"date"===a&&g.period(b.activeAdvancedFilters),"area"===a&&g.area(b.activeAdvancedFilters)},b.search=function(a){b.searchText=a,q()},b.share=function(){g.share()},b.changeToMap=function(){h.url(null!==b.filtersHash?"/inventories/map?filters="+b.filtersHash:"/inventories/map")},b.changeToList=function(){h.url(null!==b.filtersHash?"/inventories?filters="+b.filtersHash:"/inventories")},b.deleteItem=function(a,b){d.open({templateUrl:"modals/items/destroy/items-destroy.template.html",windowClass:"removeModal",resolve:{item:function(){return a},category:function(){return b}},controller:"ItemsDestroyModalController"})},b["export"]=function(){d.open({templateUrl:"views/inventories/export.html",windowClass:"filterCategoriesModal",resolve:{categories:function(){return b.categories}},controller:["$scope","$modalInstance","categories",function(a,b,c){a.categories=c,a.updateCategory=function(b){var c=a.categories.indexOf(b);a.categories[c].selected===!0?a.categories[c].selected=!1:a.categories[c].selected=!0},a.close=function(){b.close()}}]})},b.openItem=function(b,d){c.loading||"a"==d.target.parentNode.tagName.toLowerCase()||"a"==d.target.tagName.toLowerCase()||a.go("items.show",{id:b.id})},c.pageHasMap=f,b.$on("$destroy",function(){c.pageHasMap=!1,l.info("ItemsIndexController destroyed.")})}]),angular.module("ItemsIndexMapModule",["StyleMapComponentModule","MapComponentModule"]).config(["$stateProvider",function(a){a.state("items.list.map",{url:"/map",views:{"@items":{templateUrl:"routes/items/index/map/items-index-map.template.html",controller:"ItemsIndexController",controllerAs:"ctrl",resolve:{isMap:function(){return!0}}}}})}]),angular.module("ItemsShowModule",["ItemsShowControllerModule"]).config(["$stateProvider",function(a){a.state("items.show",{url:"/{id:[0-9]{1,9}}",views:{"":{templateUrl:"routes/items/show/items-show.template.html",controller:"ItemsShowController",controllerAs:"ctrl",resolve:{itemResponse:["$q","Restangular","$stateParams",function(a,b,c){var d=a.defer(),e=["id","address","inventory_category_id","inventory_category_id","inventory_status_id","position","title","data.id","data.content","data.selected_options","data.field.id","category"],f=["id","title","marker","pin","statuses","plot_format","sections.id","sections.title","sections.disabled","sections.position","sections.fields.title","sections.fields.label","sections.fields.kind","sections.fields.id","sections.fields.position"],g=b.one("inventory").one("items",c.id).get({return_fields:e.join()});return g.then(function(a){var c=angular.copy(a.data),e=b.one("inventory").one("categories",c.inventory_category_id).get({return_fields:f.join(),display_type:"full"});e.then(function(a){c.category=angular.copy(a.data),d.resolve(c)})}),d.promise}]}}}})}]),angular.module("ItemsShowControllerModule",["MapShowItemComponentModule","MapViewStreetviewComponentModule","FieldHistoryModalControllerModule","GalleryComponentModule"]).controller("ItemsShowController",["$rootScope","$scope","Restangular","$q","$state","$modal","itemResponse","$log",function(a,b,c,d,e,f,g,h){h.info("ItemsShowController created."),b.$on("$destroy",function(){h.info("ItemsShowController destroyed.")}),b.item=g,b.category=b.item.category,b.show_status_bar=b.category.statuses.length>0,b.item_status=null,b.updateItemStatus=function(){if(null!=b.item.inventory_status_id){for(var a=b.category.statuses,c=0;c<a.length;c++)if(b.item.inventory_status_id===a[c].id){b.item_status=a[c];break}}else b.item_status={color:"#271129",title:"Não definido"}},b.updateItemStatus(),b.getDataByInventoryFieldId=function(a){for(var c=b.item.data.length-1;c>=0;c--)if("undefined"!=typeof b.item.data[c].field&&null!==b.item.data[c].field&&b.item.data[c].field.id===parseInt(a))return b.item.data[c].content;return null},b.getSelectedOptionsByFieldId=function(a){for(var c=b.item.data.length-1;c>=0;c--)if("undefined"!=typeof b.item.data[c].field&&null!==b.item.data[c].field&&b.item.data[c].field.id===parseInt(a))return b.item.data[c].selected_options;return null},b.editItemStatus=function(a,d){f.open({templateUrl:"modals/items/edit-status/items-edit-status.template.html",windowClass:"editStatusModal",resolve:{item:function(){return a},category:function(){return d},refreshItemHistory:function(){return b.refreshHistory},updateItemStatus:function(){return b.updateItemStatus}},controller:["$scope","$modalInstance","category","item","refreshItemHistory","updateItemStatus",function(a,b,d,e,f,g){a.category=d,a.item=angular.copy(e),a.changeStatus=function(b){a.item.inventory_status_id=b},a.save=function(){var d=c.all("inventory").one("categories",a.category.id).one("items",a.item.id).customPUT({inventory_status_id:a.item.inventory_status_id});d.then(function(){e.inventory_status_id=a.item.inventory_status_id,f(),g(),b.close()})},a.close=function(){b.close()}}]})},b.deleteItem=function(a,b){f.open({templateUrl:"modals/items/destroy/items-destroy.template.html",windowClass:"removeModal",resolve:{removeItemFromList:function(){return!1},item:function(){return a},category:function(){return b}},controller:"ItemsDestroyModalController"})},b.showFieldHistory=function(c){a.resolvingRequest=!0,f.open({templateUrl:"modals/items/field-history/items-field-history.template.html",windowClass:"field-history-modal",resolve:{field:function(){return c},itemId:function(){return b.item.id},itemHistoryResponse:["Restangular","$stateParams",function(a,d){return a.one("inventory").one("items",b.item.id).one("history").getList(null,{object_id:c.id})}]},controller:"FieldHistoryModalController"})},b.refreshHistory=function(){var a={return_fields:"id,action,created_at,kind,objects.id,objects.label,objects.name,user.name,user.id"},d=b.selectedFilters();0!==d.length&&(a.kind=d.join()),b.historyFilterBeginDate&&(a["created_at[begin]"]=b.historyFilterBeginDate),b.historyFilterEndDate&&(a["created_at[end]"]=b.historyFilterEndDate),b.loadingHistoryLogs=!0;var e=c.one("inventory").one("items",b.item.id).one("history").getList(null,a);e.then(function(a){b.historyLogs=a.data,b.loadingHistoryLogs=!1})},b.historyOptions={type:void 0},b.availableHistoryFilters=[{type:"report",name:"Relatos",selected:!1},{type:"fields",name:"Campos",selected:!1},{type:"images",name:"Imagens",selected:!1},{type:"flow",name:"Fluxo",selected:!1},{type:"formula",name:"Fórmulas",selected:!1},{type:"status",name:"Estados",selected:!1}],b.availableHistoryDateFilters=[{name:"Hoje",beginDate:moment().startOf("day").format(),endDate:moment().endOf("day").format(),selected:!1},{name:"Ontem",beginDate:moment().subtract(1,"days").startOf("day").format(),endDate:moment().subtract(1,"days").endOf("day").format(),selected:!1},{name:"Este mês",beginDate:moment().startOf("month").format(),endDate:moment().subtract(1,"days").endOf("day").format(),selected:!1},{name:"Mês passado",beginDate:moment().subtract(1,"months").startOf("month").format(),endDate:moment().subtract(1,"months").subtract(1,"days").endOf("day").format(),selected:!1},{name:"Todos",beginDate:null,endDate:null,selected:!0}],b.selectedFilters=function(){var a=[];return _.each(b.availableHistoryFilters,function(b){b.selected&&a.push(b.type)}),a},b.toggleOption=function(a){a.selected=!a.selected,b.refreshHistory()},b.resetHistoryFilters=function(){_.each(b.availableHistoryFilters,function(a){a.selected=!0}),b.refreshHistory()},b.showCustomDateFields=function(){_.each(b.availableHistoryDateFilters,function(a){a.selected=!1}),b.showCustomDateHelper=!0},b.selectDateFilter=function(a){_.each(b.availableHistoryDateFilters,function(a){a.selected=!1}),a.selected=!a.selected,b.historyFilterBeginDate=a.beginDate,b.historyFilterEndDate=a.endDate,b.showCustomDateHelper=!1,b.refreshHistory()},b.historyLogs=[],b.refreshHistory()}]),angular.module("ItemsEditModule",["ItemsEditControllerModule"]).config(["$stateProvider",function(a){a.state("items.show.edit",{url:"/category/{categoryId:[0-9]{1,9}}/edit",views:{"@":{templateUrl:"routes/items/edit/items-edit.template.html",controller:"ItemsEditController",controllerAs:"ctrl",resolve:{categoryResponse:["Restangular","$stateParams",function(a,b){var c=["id","marker","pin","plot_format","require_item_status","statuses","title","sections.id","sections.title","sections.disabled","sections.required","sections.location","sections.position","sections.fields.id","sections.fields.disabled","sections.fields.title","sections.fields.kind","sections.fields.label","sections.fields.available_values","sections.fields.field_options","sections.fields.position","sections.fields.maximum","sections.fields.minimum","sections.fields.required"];return a.one("inventory").one("categories",b.categoryId).get({display_type:"full",return_fields:c.join()})}],itemResponse:["Restangular","$stateParams",function(a,b){return a.one("inventory").one("items",b.id).get()}]}}}}).state("items.add",{url:"/category/{categoryId:[0-9]{1,9}}/add",views:{"@":{templateUrl:"routes/items/edit/items-edit.template.html",controller:"ItemsEditController",controllerAs:"ctrl",resolve:{categoryResponse:["Restangular","$stateParams",function(a,b){var c=["id","marker","pin","plot_format","require_item_status","statuses","title","sections.id","sections.title","sections.disabled","sections.required","sections.location","sections.position","sections.fields.id","sections.fields.disabled","sections.fields.title","sections.fields.kind","sections.fields.label","sections.fields.available_values","sections.fields.field_options","sections.fields.position","sections.fields.maximum","sections.fields.minimum","sections.fields.required"];return a.one("inventory").one("categories",b.categoryId).get({display_type:"full",return_fields:c.join()})}],itemResponse:function(){return!1}}}}})}]),angular.module("ItemsEditControllerModule",["ItemsRestoreModalControllerModule","ItemsSelectAddressModalControllerModule","NgThumbComponentModule","TranslateErrorsHelperModule"]).controller("ItemsEditController",["$scope","Restangular","$q","$state","$modal","$rootScope","FileUploader","onlyImagesUploaderFilter","$localStorage","itemResponse","categoryResponse","$timeout","User",function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n,o=a.updating=!1,p=k.data.id,q=a.itemData={},r=!1;if(a.uploaders={},a.isArray=_.isArray,j){var s=j.data.id;o=!0,a.updating=!0}a.storage=i,a.back=function(){j?d.transitionTo("items.show",{id:s},{reload:!0}):d.transitionTo("items.list",null,{reload:!0})},o?("undefined"==typeof a.storage.updating?(a.storage.updating={},a.storage.updating[p]={},a.storage.updating[p][s]=null):"undefined"==typeof a.storage.updating[p]?(a.storage.updating[p]={},a.storage.updating[p][s]=null):"undefined"==typeof a.storage.updating[p][s]&&(a.storage.updating[p][s]=null),null!==a.storage.updating[p][s]&&(n=angular.copy(a.storage.updating[p][s]),r=!0)):("undefined"==typeof a.storage.creating?(a.storage.creating={},a.storage.creating[p]=null):"undefined"==typeof a.storage.creating[p]&&(a.storage.creating[p]=null),null!==a.storage.creating[p]&&(n=angular.copy(a.storage.creating[p]),r=!0)),r===!0&&e.open({templateUrl:"modals/items/restore/items-restore.template.html",windowClass:"removeModal",resolve:{setItemData:function(){return function(){q=a.itemData=angular.copy(n)}},clearData:function(){return function(){o?a.storage.updating[p][s]=null:a.storage.creating[p]=null}}},controller:"ItemsRestoreModalController"}),a.hiddenFields=[];var t=a.locationFieldsIds=[];a.item={inventory_status_id:null},a.category=k.data;for(var u=a.category.sections.length-1;u>=0;u--)for(var v=a.category.sections[u].fields.length-1;v>=0;v--){var w=a.category.sections[u];if("undefined"!=typeof w){if(q[w.fields[v].id]=null,"checkbox"===w.fields[v].kind){var x={};if(null!==w.fields[v].field_options)for(var y=w.fields[v].field_options.length-1;y>=0;y--)x[w.fields[v].field_options[y].id]=!1;$.isEmptyObject(x)?q[w.fields[v].id]=null:q[w.fields[v].id]=x}if(w.location===!0&&("latitude"===w.fields[v].title&&(a.locationFieldsIds[0]=w.fields[v].id,a.hiddenFields.push(w.fields[v].id)),"longitude"===w.fields[v].title&&(a.locationFieldsIds[1]=w.fields[v].id,a.hiddenFields.push(w.fields[v].id)),"address"===w.fields[v].title&&(a.locationFieldsIds[2]=w.fields[v].id),"postal_code"===w.fields[v].title&&(a.locationFieldsIds[3]=w.fields[v].id),"district"===w.fields[v].title&&(a.locationFieldsIds[4]=w.fields[v].id),"city"===w.fields[v].title&&(a.locationFieldsIds[5]=w.fields[v].id),"state"===w.fields[v].title&&(a.locationFieldsIds[6]=w.fields[v].id)),"images"===w.fields[v].kind){var z=new g;z.filters.push(h(z.isHTML5)),a.uploaders[w.fields[v].id]=z,q[w.fields[v].id]={areImages:!0}}}}if(o||a.$watch("itemData",function(b,c){angular.equals(b,c)||(a.storage.creating[p]=angular.copy(b))},!0),o){a.item=j.data,a.item.locked===!0&&a.item.locker_id!==m.id&&(a.locked=!0);var A=function(b){for(var c=a.item.data.length-1;c>=0;c--)if("undefined"!=typeof a.item.data[c].field&&null!==a.item.data[c].field&&a.item.data[c].field.id==b)return a.item.data[c]};for(var B in q){var C=A(B);if("undefined"!=typeof C)if("checkbox"===C.field.kind&&null!==C.content)for(var u=C.content.length-1;u>=0;u--)q[B][C.content[u]]=!0;else"images"===C.field.kind&&null!==C.content?q[B].existingImages=C.content:q[B]=C.content}a.$watch("itemData",function(b,c){angular.equals(b,c)||(a.storage.updating[p][s]=angular.copy(b))},!0);var D=!0,E=function(){b.all("inventory").one("categories",p).one("items",s).all("update_access").patch();l(function(){D&&E()},45e3)};(!a.item.locked||a.item.locked===!0&&a.item.locker_id==m.id)&&E(),a.$on("$destroy",function(){D=!1})}a.openMapModal=function(){var b=e.open({templateUrl:"modals/items/select-address/items-select-address.template.html",windowClass:"mapModal",resolve:{category:function(){return a.category},updating:function(){return o},itemData:function(){return q},locationFieldsIds:function(){return t}},controller:"ItemsSelectAddressModalController"});b.opened.then(function(){setTimeout(function(){f.selectLatLngMap.start()},80)})},a.send=function(){function e(a){var b=c.defer(),d=new FileReader;return d.addEventListener("load",function(a){var c=a.target;b.resolve(c.result.replace(/^data:image\/[^;]+;base64,/,""))}),d.readAsDataURL(a),b.promise}if(a.form.$invalid)return a.showValidationError=!0,!1;a.processingForm=!0;var f=[],g={inventory_status_id:a.item.inventory_status_id,data:{}},h=function(a,b){for(var d=c.defer(),f=[],h=a.queue.length-1;h>=0;h--)f.push(e(a.queue[h]._file));return c.all(f).then(function(a){for(var c=[],e=a.length-1;e>=0;e--)c.push({content:a[e]});if(0!==c.length)if("undefined"==typeof g.data[b])g.data[b]=c;else for(var e=c.length-1;e>=0;e--)g.data[b].push(c[e]);d.resolve()}),d.promise};for(var i in q)if(null!==q[i])if("object"==typeof q[i])if(q[i].areImages===!0){if(f.push(h(a.uploaders[i],i)),"undefined"!=typeof q[i].existingImages)for(var j=q[i].existingImages.length-1;j>=0;j--)q[i].existingImages[j].destroy===!0&&("undefined"==typeof g.data[i]?g.data[i]=[{id:q[i].existingImages[j].id,destroy:!0}]:g.data[i].push({id:q[i].existingImages[j].id,destroy:!0}))}else{var k=[];for(var l in q[i])q[i][l]===!0&&k.push(parseInt(l));0!==k.length&&(g.data[i]=k)}else g.data[i]=q[i];c.all(f).then(function(){if(o){var c=b.one("inventory").one("categories",p).one("items",s).customPUT(g);c.then(function(){a.storage.updating[p][s]=null,a.showMessage("ok","O item foi atualizado com sucesso!","success",!0),a.processingForm=!1},function(b){a.showMessage("exclamation-sign","O item não pode ser criado. Por favor, revise os erros.","error",!0),a.inputErrors=b.data.error,a.processingForm=!1})}else{var e=b.one("inventory").one("categories",p).post("items",g);e.then(function(b){a.storage.creating[p]=null,a.showMessage("ok","O item foi criado com sucesso","success",!0),d.go("items.show",{id:b.data.id})},function(b){a.showMessage("exclamation-sign","O item não pode ser criado. Por favor, revise os erros.","error",!0),a.inputErrors=b.data.error,a.processingForm=!1})}})}}]),angular.module("ItemsSelectCategoryControllerModule",[]).controller("ItemsSelectCategoryController",["$scope","categoriesResponse",function(a,b){a.categories=b}]),angular.module("ItemsSelectCategoryModule",["ItemsSelectCategoryControllerModule"]).config(["$stateProvider",function(a){a.state("items.select-category",{url:"/select-category",views:{"@":{templateUrl:"routes/items/select-category/items-select-category.template.html",controller:"ItemsSelectCategoryController",controllerAs:"ctrl",resolve:{categoriesResponse:["InventoriesCategoriesService","$q",function(a,b){var c=function(){var c=b.defer();return a.fetchAllBasicInfo().then(function(a){c.resolve(a.data.categories)}),c.promise};return a.loadedBasicInfo?_.values(a.categories):c()}]}}}})}]),angular.module("ItemsCategoriesIndexModule",["ItemsCategoriesIndexControllerModule","InventoriesCategoriesServiceModule"]).config(["$stateProvider",function(a){a.state("items.categories",{url:"/categories",views:{"":{templateUrl:"routes/items/categories/index/items-categories-index.template.html",controller:"ItemsCategoriesIndexController",controllerAs:"ctrl",resolve:{categoriesResponse:["InventoriesCategoriesService","$q",function(a,b){var c=function(){var c=b.defer();return a.fetchAllBasicInfo().then(function(a){c.resolve(a.data.categories)}),c.promise};return a.loadedBasicInfo?_.values(a.categories):c()}]}}}})}]),angular.module("ItemsCategoriesIndexControllerModule",["ItemsCategoriesDestroyModalControllerModule"]).controller("ItemsCategoriesIndexController",["$scope","categoriesResponse","$modal",function(a,b,c){a.categories=b,a.deleteCategory=function(b){c.open({templateUrl:"modals/items/categories/destroy/items-categories-destroy.template.html",windowClass:"removeModal",backdrop:"static",resolve:{inventoriesCategoriesList:function(){return a.categories},category:function(){return b}},controller:"ItemsCategoriesDestroyModalController"})}}]),angular.module("ItemsCategoriesEditModule",["ItemsCategoriesEditControllerModule"]).config(["$stateProvider",function(a){a.state("items.categories.edit",{url:"/{id:[0-9]{1,4}}/edit",views:{"@":{templateUrl:"routes/items/categories/edit/items-categories-edit.template.html",controller:"ItemsCategoriesEditController",controllerAs:"ctrl",resolve:{categoryResponse:["Restangular","$stateParams",function(a,b){return a.one("inventory").one("categories",b.id).get({display_type:"full"})}],formulasResponse:["FullResponseRestangular","$stateParams","$q","$log","$rootScope",function(a,b,c,d,e){var f=c.defer();if(e.hasPermission("inventories_formulas_full_access")){var g=a.one("inventory").one("categories",b.id).all("formulas").customGET();g.then(function(a){f.resolve(a)},function(){f.resolve(!1)})}else d.info("Sem permissão de edição de fórmulas."),f.resolve(!0);return f.promise}],groupsResponse:["Restangular",function(a){return a.all("groups").getList()}]}}}}).state("items.categories.add",{url:"/add",views:{"@":{templateUrl:"routes/items/categories/edit/items-categories-edit.template.html",controller:"ItemsCategoriesEditController",controllerAs:"ctrl",resolve:{categoryResponse:function(){return!1},formulasResponse:function(){return!1},groupsResponse:["Restangular",function(a){return a.all("groups").getList()}]}}}})}]),angular.module("ItemsCategoriesEditControllerModule",["ItemsCategoriesEditOptionsModalControllerModule","ItemsCategoriesEditFieldValuesModalControllerModule","ItemsCategoriesNewStatusModalControllerModule","ItemsCategoriesEditStatusModalControllerModule","InventorySortableSectionsComponentModule","InventoryPopoverComponentModule","InventoryPopoverLinkComponentModule","InventoryDroppableInputsAreaComponentModule","InventoryEditLabelComponentModule","InputsSidebarComponentModule","InventoryDraggableInputComponentModule","InventoryEditSectionComponentModule","InventoryTriggerComponentModule","InventoryTriggerConditionComponentModule","InventoriesCategoriesServiceModule"]).controller("ItemsCategoriesEditController",["$scope","$stateParams","categoryResponse","groupsResponse","Restangular","$localStorage","$q","$modal","$timeout","$window","$state","FileUploader","formulasResponse","InventoriesCategoriesService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=a.updating=!1;if(c){o=!0,a.updating=!0,a.category=c.data;var p=a.category.id}a.groups=d.data,a.unsavedCategory=!1,a.showDisabledFields=f,a.currentTab="fields",a.availableInputs=[{kind:"text",name:"Campo de texto",multipleOptions:!1},{kind:"textarea",name:"Campo de parágrafo",multipleOptions:!1},{kind:"integer",name:"Campo numérico",multipleOptions:!1},{kind:"decimal",name:"Campo decimal",multipleOptions:!1},{kind:"checkbox",name:"Campo de múltipla escolha",multipleOptions:!0},{kind:"radio",name:"Campo de escolha única",multipleOptions:!0},{kind:"select",name:"Campo de lista",multipleOptions:!0},{kind:"meters",name:"Campo em metros",multipleOptions:!1},{kind:"centimeters",name:"Campo em centímetros",multipleOptions:!1},{kind:"kilometers",name:"Campo em quilômetros",multipleOptions:!1},{kind:"years",name:"Campo em anos",multipleOptions:!1},{kind:"months",name:"Campo em meses",multipleOptions:!1},{kind:"days",name:"Campo em dias",multipleOptions:!1},{kind:"hours",name:"Campo em horas",multipleOptions:!1},{kind:"seconds",name:"Campo em segundos",multipleOptions:!1},{kind:"angle",name:"Campo de ângulo",multipleOptions:!1},{kind:"date",name:"Campo de data",multipleOptions:!1},{kind:"time",name:"Campo de tempo",multipleOptions:!1},{kind:"cpf",name:"Campo de CPF",multipleOptions:!1},{kind:"cnpj",name:"Campo de CNPJ",multipleOptions:!1},{kind:"url",name:"Campo de URL",multipleOptions:!1},{kind:"email",name:"Campo de e-mail",multipleOptions:!1},{kind:"images",name:"Campo de imagens",multipleOptions:!1}],a.kindHasMultipleOptions=function(b){for(var c=a.availableInputs.length-1;c>=0;c--)if(a.availableInputs[c].kind===b)return a.availableInputs[c].multipleOptions===!0;return!1};var q=function(b){return _.findWhere(a.groups,{id:b})};if(o){a.category.plot_format="pin"===a.category.plot_format?!1:!0;for(var r=a.category.permissions.groups_can_edit.length-1;r>=0;r--)a.category.permissions.groups_can_edit[r]=q(a.category.permissions.groups_can_edit[r]);for(var r=a.category.permissions.groups_can_view.length-1;r>=0;r--)a.category.permissions.groups_can_view[r]=q(a.category.permissions.groups_can_view[r])}else{a.category={},a.category.title="Nova categoria sem título",a.category.color="#2AB4DC",a.category.icon="R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",a.category.marker="R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",a.category.pin="R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",a.category.plot_format=!1,a.category.statuses=[],a.category.permissions={groups_can_edit:[],groups_can_view:[]};for(var r=a.me.groups.length-1;r>=0;r--)a.category.permissions.groups_can_edit.push(a.me.groups[r]);a.category.sections=[{title:"Localização",required:!0,location:!0,permissions:{groups_can_view:[],groups_can_edit:[]},fields:[{title:"longitude",kind:"text",size:null,inventory_section_id:14,available_values:null,position:1,label:"Longitude",maximum:null,minimum:null,required:!0,location:!0,permissions:{groups_can_view:[],groups_can_edit:[]}},{title:"postal_code",kind:"text",size:null,inventory_section_id:14,available_values:null,position:3,label:"CEP",maximum:null,minimum:null,required:!1,location:!0,permissions:{groups_can_view:[],groups_can_edit:[]}},{title:"road_classification",kind:"text",size:null,inventory_section_id:14,available_values:null,position:8,label:"Classificação Viária",maximum:null,minimum:null,required:!1,location:!0,permissions:{groups_can_view:[],groups_can_edit:[]}},{title:"city",kind:"text",size:null,inventory_section_id:14,available_values:null,position:5,label:"Cidade",maximum:null,minimum:null,required:!1,location:!0,permissions:{groups_can_view:[],groups_can_edit:[]}},{title:"latitude",kind:"text",size:null,inventory_section_id:14,available_values:null,position:0,label:"Latitude",
maximum:null,minimum:null,required:!0,location:!0,permissions:{groups_can_view:[],groups_can_edit:[]}},{title:"address",kind:"text",size:null,inventory_section_id:14,available_values:null,position:2,label:"Endereço",maximum:null,minimum:null,required:!1,location:!0,permissions:{groups_can_view:[],groups_can_edit:[]}},{title:"district",kind:"text",size:null,inventory_section_id:14,available_values:null,position:4,label:"Bairro",maximum:null,minimum:null,required:!1,location:!0,permissions:{groups_can_view:[],groups_can_edit:[]}},{title:"state",kind:"text",size:null,inventory_section_id:14,available_values:null,position:6,label:"Estado",maximum:null,minimum:null,required:!1,location:!0,permissions:{groups_can_view:[],groups_can_edit:[]}},{title:"codlog",kind:"text",size:null,inventory_section_id:14,available_values:null,position:7,label:"Codlog",maximum:null,minimum:null,required:!1,location:!0,permissions:{groups_can_view:[],groups_can_edit:[]}}]}]}a.$watch("category",function(b,c){b!==c&&(a.unsavedCategory=!0)},!0),a.groupsCanEditAutocomplete={options:{onlySelect:!0,source:function(a,b){var c=e.all("groups").getList({name:a.term});c.then(function(a){b($.map(a.data,function(a){return{label:a.name,value:a.name,group:{id:a.id,name:a.name}}}))})},messages:{noResults:"",results:function(){}}}},a.groupsCanViewAutocomplete={options:{onlySelect:!0,source:function(a,b){var c=e.all("groups").getList({name:a.term});c.then(function(a){b($.map(a.data,function(a){return{label:a.name,value:a.name,group:{id:a.id,name:a.name}}}))})},messages:{noResults:"",results:function(){}}}},a.groupsCanEditAutocomplete.events={select:function(b,c){for(var d=!1,e=a.category.permissions.groups_can_edit.length-1;e>=0;e--)a.category.permissions.groups_can_edit[e].id===c.item.group.id&&(d=!0);d||a.category.permissions.groups_can_edit.push(c.item.group)},change:function(){a.groupCanEdit=""}},a.groupsCanViewAutocomplete.events={select:function(b,c){for(var d=!1,e=a.category.permissions.groups_can_view.length-1;e>=0;e--)a.category.permissions.groups_can_view[e].id===c.item.group.id&&(d=!0);d||a.category.permissions.groups_can_view.push(c.item.group)},change:function(){a.groupCanView=""}},a.removeGroupCanView=function(b){a.category.permissions.groups_can_view.splice(a.category.permissions.groups_can_view.indexOf(b),1)},a.removeGroupCanEdit=function(b){a.category.permissions.groups_can_edit.splice(a.category.permissions.groups_can_edit.indexOf(b),1)},a.editFieldOptions=function(a){h.open({templateUrl:"modals/items/categories/edit-field-values/items-categories-edit-field-values.template.html",windowClass:"editFieldOptions",controller:"ItemsCategoriesEditFieldValuesModalController",resolve:{field:function(){return a},setFieldOptions:function(){return function(b){a.field_options=b}}}})},j.onbeforeunload=function(){return a.unsavedCategory===!0?"Você tem certeza que deseja sair? Há alterações que não foram salvas.":null},a.goBack=function(){a.unsavedCategory===!0?window.confirm("Você tem certeza que deseja sair? Há alterações que não foram salvas.")&&(a.unsavedCategory=!1,a.loading=!0,k.transitionTo("items.categories",null,{reload:!0})):(a.loading=!0,k.transitionTo("items.categories",null,{reload:!0}))},a.newSection=function(){var b={title:"Nova seção sem título",required:!1,location:!1,fields:[]};a.category.sections.push(b),$("html, body").animate({scrollTop:$(document).height()},"slow")},a.newStatus=function(){h.open({templateUrl:"modals/items/categories/new-status/items-categories-new-status.template.html",windowClass:"editInventoryStatusesModal",resolve:{statuses:function(){return a.category.statuses},updating:function(){return o},categoryId:function(){return p}},controller:"ItemsCategoriesNewStatusModalController"})},a.editStatus=function(a){h.open({templateUrl:"modals/items/categories/edit-status/items-categories-edit-status.template.html",windowClass:"editInventoryStatusesModal",resolve:{status:function(){return a},updating:function(){return o},categoryId:function(){return p}},controller:"ItemsCategoriesEditStatusModalController"})},a.removeStatus=function(b){if("undefined"!=typeof b.id){var c=e.one("inventory").one("categories",p).one("statuses",b.id).remove();c.then(function(){a.category.statuses.splice(a.category.statuses.indexOf(b),1)})}else a.category.statuses.splice(a.category.statuses.indexOf(b),1)},a.$on("hidePopovers",function(b,c){a.$broadcast("hideOpenPopovers",c)}),a.uploaderQueue={items:[]},a.editCategoryOptions=function(){h.open({templateUrl:"modals/items/categories/edit-options/items-categories-edit-options.template.html",windowClass:"editCategory",resolve:{category:function(){return a.category},uploaderQueue:function(){return a.uploaderQueue},send:function(){return function(){return a.send()}}},controller:"ItemsCategoriesEditOptionsModalController"})},a.send=function(){function b(a){var b=g.defer(),d=new FileReader;return d.addEventListener("load",function(a){var d=a.target;c=d.result.replace(/^data:image\/[^;]+;base64,/,""),b.resolve()}),d.readAsDataURL(a),b.promise}a.processingForm=!0;for(var c,d=[],f=a.uploaderQueue.items.length-1;f>=0;f--)d.push(b(a.uploaderQueue.items[f]._file));return g.all(d).then(function(){for(var b={groups_can_edit:[],groups_can_view:[]},d=a.category.permissions.groups_can_edit.length-1;d>=0;d--)b.groups_can_edit.push(a.category.permissions.groups_can_edit[d].id);for(var d=a.category.permissions.groups_can_view.length-1;d>=0;d--)b.groups_can_view.push(a.category.permissions.groups_can_view[d].id);var f={title:a.category.title,require_item_status:a.category.require_item_status,statuses:a.category.statuses,color:a.category.color,plot_format:a.category.plot_format,permissions:b},h={sections:a.category.sections};if(_.each(h.sections,function(a){_.each(a.fields,function(b,c){if(_.isObject(b)&&(_.isUndefined(b.id)&&b.hasOwnProperty("toRemove")&&(b.toRemove?a.fields.splice(c,1):delete b.toRemove),_.isUndefined(b.id)&&_.isArray(b.field_options)&&!_.isEmpty(b.field_options))){var d=[];_.each(b.field_options,function(a){d.push(a.value)}),b.field_options=d}})}),a.category.plot_format===!1?f.plot_format="pin":f.plot_format="marker",o){delete f.statuses,c&&(f.icon=c);var j=e.one("inventory").one("categories",p).customPUT(f),l=e.one("inventory").one("categories",p).one("form").customPUT(h);return j.then(function(b){a.category.original_icon=b.data.original_icon}),l.then(function(b){a.category.sections=b.data.sections,i(function(){a.unsavedCategory=!1})}),g.all([j,l]).then(function(){a.showMessage("ok","A categoria de inventário foi atualizada com sucesso!","success",!0),a.unsavedCategory=!1,a.processingForm=!1,n.purgeCache()},function(){a.showMessage("exclamation-sign","O inventário não pode ser atualizado.","error",!0),a.processingForm=!1})}c?f.icon=c:f.icon=a.category.icon;var m=e.one("inventory").post("categories",f);return m.then(function(b){var c,d=b.data,f={};a.category.original_icon=b.data.original_icon;for(var g=d.sections.length-1;g>=0;g--)if(d.sections[g].location===!0){c=d.sections[g].id;for(var i=d.sections[g].fields.length-1;i>=0;i--)f[d.sections[g].fields[i].title]=d.sections[g].fields[i].id}for(var j=a.category.sections.length-1;j>=0;j--){var l=a.category.sections[j];if(l.location===!0){l.id=c;for(var m=l.fields.length-1;m>=0;m--)l.fields[m].id=f[l.fields[m].title]}}var o=e.one("inventory").one("categories",d.id).one("form").customPUT(h);return o.then(function(){a.showMessage("ok","A categoria de inventário foi criada com sucesso","success",!0),n.purgeCache(),k.go("items.categories.edit",{id:d.id})}),o}),m})},m?a.triggers=m.data:a.triggers=[],a.onlyActiveTriggers=function(a){return _.isUndefined(a._destroy)||1!=a._destroy?!0:!1},a.newTrigger=function(){var b={conditions:[{inventory_field_id:null,operator:"equal_to",content:null}],inventory_status_id:null,isNew:!0};a.triggers.push(b)}}]),angular.module("UsersModule",["UsersIndexModule","UsersShowModule","UsersEditModule"]).config(["$stateProvider",function(a){a.state("users",{"abstract":!0,url:"/users",templateUrl:"routes/users/users.template.html",resolve:{User:["User",function(a){return a({permissions:["isLogged"]})}]}})}]),angular.module("UsersIndexModule",["UsersIndexControllerModule"]).config(["$stateProvider",function(a){a.state("users.list",{url:"",resolve:{groupsResponse:["Restangular",function(a){return a.all("groups").getList({return_fields:"id,name"})}]},views:{"":{templateUrl:"routes/users/index/users-index.template.html",controller:"UsersIndexController",controllerAs:"ctrl"}}})}]),angular.module("UsersIndexControllerModule",["KeyboardPosterComponentModule","GenericInputComponentModule","UsersDisableModalControllerModule","GroupSelectorModule"]).controller("UsersIndexController",["$scope","$q","$stateParams","$modal","Restangular","GroupSelectorService",function(a,b,c,d,e,f){a.loading=!0,a.loadingPagination=!1;var g,h=1,i=30,j="";a.sort={column:"name",descending:!0},a.changeSorting=function(b){var c=a.sort;c.column===b?c.descending=!c.descending:(c.column=b,c.descending=!1),a.refresh()},a.selectedCls=function(b){return b===a.sort.column&&"sort-"+a.sort.descending};var k=function(){var b={page:h,per_page:i,disabled:!0,return_fields:"id,name,disabled,email,phone,groups.id,groups.name",sort:a.sort};return 0!==a.selectedGroups.length&&(b.groups=_.map(a.selectedGroups,function(a){return a.id}).join()),0!==j.length&&(b.name=j,b.email=j,b.document=j.replace(/\.|-/g,"")),e.one("search").all("users").getList(b)};a.selectedGroups=[],a.getGroupsExcerpt=function(){switch(a.selectedGroups.length){case 1:return"Grupo: "+a.selectedGroups[0].name;case 0:return"Filtrar por grupo";default:return"Grupo: "+a.selectedGroups.length+" grupos selecionados"}},a.filterUsersByGroup=function(){f.open(a.selectedGroups,!0).then(function(b){a.selectedGroups=b,m()})};var l=a.getData=function(b){if(a.loadingPagination===!1){a.loadingPagination=!0;var c=k();return c.then(function(c){if(b!==!0)a.users=c.data;else{"undefined"==typeof a.users&&(a.users=[]);for(var d=0;d<c.data.length;d++)a.users.push(c.data[d]);h++}g=parseInt(c.headers().total);var e=Math.ceil(g/i);h===e+1?a.loadingPagination=null:a.loadingPagination=!1,a.loading=!1}),c}},m=function(){h=1,a.loadingPagination=!1,a.loadingSearch=!0,a.users=[],l(!1).then(function(){a.loadingSearch=!1,h++})};a.search=function(a){j=a,m()},a.disableUser=function(a){d.open({templateUrl:"modals/users/disable/users-disable.template.html",windowClass:"removeModal",resolve:{user:function(){return a}},controller:"UsersDisableModalController"})},a.enableUser=function(b){b.loading=!0;var c=e.one("users",b.id).customPUT({},"enable");c.then(function(){b.disabled=!1,b.loading=!1,a.showMessage("ok","O Usuário "+b.name+" foi ativado com sucesso.","success",!1)})}}]),angular.module("UsersShowModule",["UsersShowControllerModule"]).config(["$stateProvider",function(a){a.state("users.show",{url:"/{id:[0-9]{1,4}}",views:{"":{templateUrl:"routes/users/show/users-show.template.html",controller:"UsersShowController",controllerAs:"ctrl",resolve:{userResponse:["Restangular","$stateParams",function(a,b){return a.one("users",b.id).get()}]}}}})}]),angular.module("UsersShowControllerModule",[]).controller("UsersShowController",["$scope","userResponse","$modal","$location",function(a,b,c,d){a.user=b.data,a.disableUser=function(a){c.open({templateUrl:"modals/users/disable/users-disable.template.html",windowClass:"removeModal",resolve:{user:function(){return a}},controller:"UsersDisableModalController"})}}]),angular.module("UsersEditModule",["UsersEditControllerModule"]).config(["$stateProvider",function(a){a.state("users.show.edit",{url:"/edit",views:{"@users":{templateUrl:"routes/users/edit/users-edit.template.html",controller:"UsersEditController",controllerAs:"ctrl",resolve:{groupsResponse:["Restangular",function(a){return a.all("groups").getList()}]}}}}).state("users.add",{url:"/add",views:{"":{templateUrl:"routes/users/edit/users-edit.template.html",controller:"UsersEditController",controllerAs:"ctrl",resolve:{groupsResponse:["Restangular",function(a){return a.all("groups").getList()}]}}}})}]),angular.module("UsersEditControllerModule",["ngCpfCnpj","EqualsComponentModule"]).controller("UsersEditController",["$scope","$rootScope","Restangular","$stateParams","$location","groupsResponse","Error",function(a,b,c,d,e,f,g){var h=a.updating=!1,i=d.id;if("undefined"!=typeof i&&(h=!0,a.updating=!0),a.loading=!0,h)c.one("users",i).get().then(function(b){a.user=b.data,a.loading=!1});else{var j=c.stripRestangular(f.data);a.loading=!1,a.user={groups:[]};for(var k=j.length-1;k>=0;k--)"Público"===j[k].name&&a.user.groups.push(j[k])}a.groupsAutocomplete={options:{onlySelect:!0,source:function(a,b){var d=c.all("search/groups").getList({name:a.term,return_fields:"id,name",like:!0});d.then(function(a){b($.map(a.data,function(a){return{label:a.name,value:a.name,group:{id:a.id,name:a.name}}}))})},messages:{noResults:"",results:function(){}}}},a.groupsAutocomplete.events={select:function(b,c){for(var d=!1,e=a.user.groups.length-1;e>=0;e--)a.user.groups[e].id===c.item.group.id&&(d=!0);d||a.user.groups.push(c.item.group)},change:function(){a.group=""}},a.removeGroup=function(b){a.user.groups.splice(a.user.groups.indexOf(b),1)},a.send=function(){a.inputErrors=null,a.processingForm=!0,b.resolvingRequest=!0;var d=angular.copy(a.user);if(h){var f=c.one("users",i).withHttpConfig({treatingErrors:!0}).customPUT(d);f.then(function(){a.showMessage("ok","O usuário foi atualizado com sucesso","success",!0),a.processingForm=!1,b.resolvingRequest=!1},function(c){a.showMessage("exclamation-sign","O usuário não pode ser salvo","error",!0),"object"!=typeof c.data.error?g.show(c):a.inputErrors=c.data.error,a.processingForm=!1,b.resolvingRequest=!1})}else{if(0!==d.groups.length){d.groups_ids=[];for(var j=d.groups.length-1;j>=0;j--)d.groups_ids.push(d.groups[j].id)}delete d.groups;var k={return_fields:"id"};a.should_generate_password&&(delete d.password,delete d.password_confirmation,k.generate_password=!0);var l=c.one("users").withHttpConfig({treatingErrors:!0}).post(null,d,k);l.then(function(){a.showMessage("ok","O usuário foi criado com sucesso","success",!0),e.path("/users"),a.processingForm=!1,b.resolvingRequest=!1},function(c){a.showMessage("exclamation-sign","O usuário não pode ser criado","error",!0),"object"!=typeof c.data.error?g.show(c):a.inputErrors=c.data.error,a.processingForm=!1,b.resolvingRequest=!1})}}}]),angular.module("GroupsModule",["GroupsIndexModule","GroupsShowModule","GroupsEditModule"]).config(["$stateProvider",function(a){a.state("groups",{"abstract":!0,url:"/groups",templateUrl:"routes/groups/groups.template.html",resolve:{User:["User",function(a){return a({permissions:["isLogged"]})}]}})}]),angular.module("GroupsIndexModule",["GroupsIndexControllerModule"]).config(["$stateProvider",function(a){a.state("groups.list",{url:"",views:{"":{templateUrl:"routes/groups/index/groups-index.template.html",controller:"GroupsIndexController",controllerAs:"ctrl"}}})}]),angular.module("GroupsIndexControllerModule",["GroupsEditModalControllerModule"]).controller("GroupsIndexController",["$scope","$modal","Restangular",function(a,b,c){a.loading=!0;var d=c.all("groups").getList({return_fields:"id,name"});d.then(function(b){a.groups=b.data,a.loading=!1}),a.addGroup=function(){b.open({templateUrl:"modals/groups/edit/groups-edit.template.html",windowClass:"editStatusModal",resolve:{group:function(){return null}},controller:"GroupsEditModalController"})},a.deleteGroup=function(d){b.open({templateUrl:"modals/groups/destroy/groups-destroy.template.html",windowClass:"removeModal",resolve:{groupsList:function(){return a.groups}},controller:["$scope","$modalInstance","groupsList",function(a,b,e){a.group=d,a.confirm=function(){var d=c.one("groups",a.group.id).remove();d.then(function(){b.close(),e.splice(e.indexOf(a.group),1)})},a.close=function(){b.close()}}]})}}]),angular.module("GroupsShowModule",["GroupsShowControllerModule"]).config(["$stateProvider",function(a){a.state("groups.show",{url:"/{id:[0-9]{1,4}}",views:{"":{templateUrl:"routes/groups/show/groups-show.template.html",controller:"GroupsShowController",controllerAs:"ctrl"}}})}]),angular.module("GroupsShowControllerModule",["GroupsEditModalControllerModule","GroupsAddUsersModalControllerModule","GroupsRemoveUserModalControllerModule"]).controller("GroupsShowController",["$scope","Restangular","$stateParams","$q","$modal",function(a,b,c,d,e){var f=c.id,g=1,h=15;a.loading=!0,a.loadingPagination=!1,a.total=0,a.sort={column:"",descending:!1},a.changeSorting=function(b){var c=a.sort;c.column===b?c.descending=!c.descending:(c.column=b,c.descending=!1)},a.selectedCls=function(b){return b===a.sort.column&&"sort-"+a.sort.descending},a.removeUserFromGroup=function(b){e.open({templateUrl:"modals/groups/remove-user/groups-remove-user.template.html",windowClass:"removeModal",resolve:{group:function(){return a.group},user:function(){return b},removeUserFromList:function(){return function(b){a.users.splice(a.users.indexOf(b),1)}}},controller:"GroupsRemoveUserModalController"})};var i=b.one("groups",f).get();i.then(function(b){a.group=b.data,a.loading=!1});var j=a.getData=function(c){if(a.loadingPagination===!1){a.loadingPagination=!0;var d=b.all("search").one("groups",f).one("users").getList(null,{page:g,per_page:h,name:a.searchText});return d.then(function(b){if(c!==!0)a.users=b.data;else{"undefined"==typeof a.users&&(a.users=[]);for(var d=0;d<b.data.length;d++)a.users.push(b.data[d]);g++}a.total=parseInt(b.headers().total);var e=Math.ceil(a.total/h);g===e+1&&c===!0?a.loadingPagination=null:a.loadingPagination=!1,a.loading=!1}),d}};j(!0),a.search=function(b){a.searchText=b,a.loadingPagination=!1,a.loadingSearch=!0,a.users=[],g=1;var c=j(!0);c.then(function(){a.loadingSearch=!1})},a.editGroup=function(){e.open({templateUrl:"modals/groups/edit/groups-edit.template.html",windowClass:"editStatusModal",resolve:{group:function(){return a.group}},controller:"GroupsEditModalController"})},a.addUsers=function(){e.open({templateUrl:"modals/groups/add-users/groups-add-users.template.html",windowClass:"modal-groups-select-user",resolve:{group:function(){return a.group}},controller:"GroupsAddUsersModalController"})}}]),angular.module("GroupsEditModule",["GroupsEditControllerModule"]).config(["$stateProvider",function(a){a.state("groups.show.edit",{url:"/edit",views:{"@groups":{templateUrl:"routes/groups/edit/groups-edit.template.html",controller:"GroupsEditController",controllerAs:"ctrl",resolve:{groupResponse:["Restangular","$stateParams",function(a,b){return a.one("groups",b.id).get()}],groupsPermissionsResponse:["FullResponseRestangular","$stateParams",function(a,b){return a.one("groups",b.id).all("permissions").customGET()}],objectsResponse:["FullResponseRestangular",function(a){return a.one("utils").all("available_objects").customGET()}]}}}})}]),angular.module("GroupsEditControllerModule",["DiacriticsInsensitiveFilterHelperModule"]).controller("GroupsEditController",["$scope","$rootScope","Restangular","$stateParams","$location","$timeout","groupResponse","groupsPermissionsResponse","objectsResponse",function(a,b,c,d,e,f,g,h,i){if(a.group=g.data,a.permissions=h.data,a.groups=i.data.groups,a.flows=i.data.flows,a.inventoriesCategories=i.data.inventory_categories,a.reportsCategories=i.data.reports_categories,a.businessReports=i.data.business_reports,a.newPermission={type:null,objects:[],slugs:[]},a.isString=function(a){return"string"==typeof a},a.availablePermissionTypes=[{type:"user",name:"Usuários",permissionsNames:[{slug:"users_full_access",name:"Gerenciar todos os usuários",needsObject:!1,tooltip:"Ao ativar essa opção, será permitido que este grupo possa ver, adicionar e remover todos os usuários dos grupos às quais tem permissão de visualizar."},{type:"group",slug:"users_edit",name:"Gerenciar usuários de um grupo específico",needsObject:!0,tooltip:"Ao ativar essa opção, será permitido que este grupo possa visualizar, adicionar e remover todos os usuários dos outros grupos que você selecionar para esta permissão."}]},{type:"group",name:"Grupos",permissionsNames:[{slug:"groups_full_access",name:"Gerenciar todos os grupos",needsObject:!1,tooltip:"Selecionada esta opção, o grupo obtém todas as permissões de edições sobre todos os grupos existentes, sobre novos grupos adicionados no futuro, e sobre todos os usuários pertencentes a todos os grupos. Também permite a visualização e edição de dados dos usuários, buscar, deletar e adicionar usuários."},{slug:"group_edit",name:"Editar e visualizar o grupo",needsObject:!0,tooltip:"Permite sobre os grupos selecionados: a visualização e edição de dados dos usuários, buscar, deletar e adicionar usuários. Permite a edição das permissões dos grupos selecionados."},{slug:"group_read_only",name:"Visualizar o grupo",needsObject:!0,tooltip:"Permite acessar a listagem de grupos selecionados, visualizar quais os usuários estão dentro do grupo. Nesta permissão o usuário não tem permissão de adicionar, deletar ou editar os grupos, usuários e permissões."}]},{type:"other",name:"Configurações",permissionsNames:[{slug:"panel_access",name:"Acesso ao painel permitido",needsObject:!1},{slug:"manage_config",name:"Gerenciar configurações do sistema",needsObject:!1}]},{type:"inventory",name:"Inventário",permissionsNames:[{slug:"inventories_full_access",name:"Gerenciar todas as categorias",needsObject:!1,tooltip:"Ativada esta opção, o grupo obtém todas as permissões de edição sobre todas as categorias de inventário existentes, sobre novas categorias adicionados no futuro, e sobre todos os formulários pertencentes a todas as categorias. Também permite a visualização e edição de dados dos itens de inventário, buscar, deletar e adicionar itens de inventário."},{slug:"inventories_formulas_full_access",name:"Gerenciar fórmulas",needsObject:!1,needsPermission:"inventories_full_access"},{slug:"inventories_categories_edit",name:"Editar a categoria",needsObject:!0,disableFields:["inventories_items_edit","inventories_items_create","inventories_items_delete","inventories_items_create","inventories_items_read_only"],tooltip:"Permite sobre as categorias selecionadas: a visualização e edição de dados dos itens de inventário, buscar, deletar e adicionar itens de inventário. Permite a edição dos campos de formulários das categorias selecionadas."},{slug:"inventories_items_create",name:"Criar novos itens",needsObject:!0,tooltip:"Ao selecionar quais categorias de inventário o grupo terá acesso, os usuários poderão apenas adicionar itens de inventário sobre as categorias selecionadas, além de poder visualizar os itens que o próprio usuário criou."},{slug:"inventories_items_edit",name:"Visualizar e editar itens",needsObject:!0,tooltip:'Ao selecionar quais categorias de inventário o grupo terá acesso, os usuários poderão visualizar e editar os itens de inventário das categorias selecionadas. Essa opção automaticamente ativará a permissão "Visualizar itens".'},{slug:"inventories_items_delete",name:"Remover itens",needsObject:!0,tooltip:'Ao selecionar quais categorias de inventário o grupo terá acesso, os usuários poderão visualizar e excluir os itens de inventário das categorias selecionadas. Essa opção automaticamente ativará a permissão "Visualizar itens".'},{slug:"inventories_items_read_only",name:"Visualizar itens",needsObject:!0,tooltip:"Essa opção permitirá que os usuários deste grupo possam visualizar os itens de inventário de categorias de inventário selecionadas."}]},{type:"report",name:"Relatos",permissionsNames:[{slug:"reports_full_access",name:"Gerenciar todas as categorias",needsObject:!1,tooltip:"Selecionada esta opção, o grupo obtém todas as permissões de edição sobre todas as categorias de relato existentes, sobre novas categorias adicionados no futuro, e sobre todos os relatos criados pertencentes a todas as categorias. Também permite a visualização e edição de dados dos relatos, buscar, deletar e adicionar relatos."},{slug:"reports_categories_edit",name:"Parametrizar as categorias",disableFields:["reports_items_create","reports_items_delete","reports_items_edit","reports_items_read_public","reports_items_read_private","reports_items_forward","reports_items_create_internal_comment","reports_items_alter_status","reports_items_create_comment"],needsObject:!0,tooltip:"Permite sobre as categorias selecionadas: a visualização e edição de dados dos relatos, buscar, deletar e adicionar relatos. Permite a edição dos parâmetros das categorias selecionadas."},{slug:"reports_items_edit",name:"Visualizar e editar relatos",needsObject:!0,tooltip:"Permite visualizar e editar os relatos das categorias selecionadas.",disableFields:["reports_items_forward","reports_items_create_internal_comment","reports_items_alter_status","reports_items_create_comment","reports_items_read_public","reports_items_read_private"]},{slug:"reports_items_create",name:"Criar novos relatos",needsObject:!0,tooltip:"Permite que os usuários do painel possam adicionar novos relatos às categorias selecionadas."},{slug:"reports_items_delete",name:"Remover relatos",needsObject:!0,needsPermission:"reports_items_read_public",tooltip:"Permite visualizar e deletar os relatos das categorias selecionadas."},{slug:"reports_items_read_private",name:"Visualizar relatos completo",needsObject:!0,tooltip:"Permite a visualização completa de todos os campos disponíveis nos relatos das categorias selecionadas."},{slug:"reports_items_read_public",name:"Visualizar relatos parcial",needsObject:!0,tooltip:"A visualização de relato parcial é uma permissão que restringe o acesso as informações do relato, isto é, os usuários do grupo não poderão visualizar as observações internas, as respostas enviadas ao munícipe no modo privado e o protocolo. Os usuário exergarão todas as demais informações da tela."},{slug:"reports_items_forward",name:"Encaminhar relatos",needsObject:!0,tooltip:"Grupo pode encaminhar item de relato da categoria atribuída."},{slug:"reports_items_create_internal_comment",name:"Inserir observações internas",needsObject:!0,tooltip:"Grupo pode inserir uma observação interna nos relatos da categoria atribuída."},{slug:"reports_items_alter_status",name:"Alterar o estado do relato",needsObject:!0,tooltip:"Grupo pode alterar o estado de releato da categoria atribuída."},{slug:"reports_items_create_comment",name:"Enviar comentários ao munícipe",needsObject:!0,tooltip:"Grupo pode adicionar comentário público ou privado nos relatos da categoria atribuída."}]},{type:"business_report",name:"Relatórios",permissionsNames:[{slug:"business_reports_edit",name:"Gerenciar relatórios",needsObject:!1},{slug:"business_reports_view",name:"Visualizar relatório específico",needsObject:!0}]}],b.flowsEnabled){var j={type:"flow",name:"Fluxos",permissionsNames:[{slug:"flow_can_delete_own_cases",name:"flow_can_delete_own_cases",needsObject:!0},{slug:"flow_can_execute_all_steps",name:"flow_can_execute_all_steps",needsObject:!0},{slug:"flow_can_view_all_steps",name:"flow_can_view_all_steps",needsObject:!0},{slug:"can_execute_step",name:"can_execute_step",needsObject:!0},{slug:"can_view_step",name:"can_view_step",needsObject:!0},{slug:"manage_flows",name:"manage_flows",needsObject:!1},{slug:"flow_can_delete_all_cases",name:"flow_can_delete_all_cases",needsObject:!1}]};a.availablePermissionTypes.push(j)}var k=a.getType=function(b){for(var c=a.availablePermissionTypes.length-1;c>=0;c--)if(a.availablePermissionTypes[c].type===b)return a.availablePermissionTypes[c];return null};a.getTypeName=function(a){if(a&&_.isArray(a.permission_names)&&"users_edit"==a.permission_names[0])return"Usuários";if(a)return k(a.permission_type)?k(a.permission_type).name:a.permission_type},a.getTypePermissions=function(a){return k(a)?k(a).permissionsNames:null};var l=function(a,b){if(a=k(a),!a)return null;for(var c=a.permissionsNames.length-1;c>=0;c--)if(a.permissionsNames[c].slug===b)return a.permissionsNames[c];return null};a.getPermissionsExcerpt=function(){switch(a.newPermission.slugs.length){case 0:return"Selecione a permissão";case 1:return a.getPermissionName(a.newPermission.type,a.newPermission.slugs[0]);default:return a.newPermission.slugs.length+" permissões selecionadas"}},a.isPermissionSelected=function(b){var c=a.newPermission.slugs.indexOf(b);return-1!==c};var m=[];a.togglePermission=function(b){var c=a.newPermission.slugs.indexOf(b.slug);-1===c?(a.newPermission.slugs.push(b.slug),b.type&&(a.newPermission.actual_type=b.type),_.isUndefined(b.needsPermission)||-1!==a.newPermission.slugs.indexOf(b.needsPermission)||a.togglePermission(l(a.newPermission.type,b.needsPermission)),_.isUndefined(b.disableFields)||m.push(b)):(a.newPermission.slugs.splice(c,1),_.isUndefined(b.disableFields)||m.splice(m.indexOf(b),1))},a.getObjectsExcerpt=function(){switch(a.newPermission.objects.length){case 0:return"Selecione uma categoria";case 1:return a.newPermission.objects[0].name||a.newPermission.objects[0].title;default:return a.newPermission.objects.length+" itens selecionados"}},a.isObjectSelected=function(b){for(var c=a.newPermission.objects.length-1;c>=0;c--)if(a.newPermission.objects[c].id===b)return!0;return!1},a.toggleObject=function(b){for(var c=!1,d=0;d<a.newPermission.objects.length;d++)a.newPermission.objects[d].id==b.id&&(c=d);c!==!1?a.newPermission.objects.splice(c,1):a.newPermission.objects.push(b)},a.selectAllObjects=function(b){for(var c=b.length-1;c>=0;c--){for(var d=!1,e=0;e<a.newPermission.objects.length;e++)a.newPermission.objects[e].id==b[c].id&&(d=!0);d||a.newPermission.objects.push(b[c]),_.isUndefined(b[c].subcategories)||a.selectAllObjects(b[c].subcategories)}},a.isObjectNeeded=function(){if(0===a.newPermission.slugs.length)return null;for(var b=a.newPermission.slugs.length-1;b>=0;b--)if(l(a.newPermission.type,a.newPermission.slugs[b]).needsObject)return!0;return!1},a.isPermissionDisabled=function(b){for(var c=a.newPermission.slugs.length-1;c>=0;c--)if(l(a.newPermission.type,a.newPermission.slugs[c]).needsPermission===b)return!0;for(var c=m.length-1;c>=0;c--)if(-1!==m[c].disableFields.indexOf(b))return!0;return!1},a.getPermissionName=function(a,b){return a&&b?"users_edit"==b?"Gerenciar usuários de um grupo específico":l(a,b)?l(a,b).name:b:!1},a.setNewPermissionType=function(b){f(function(){a.newPermission.objects=[],a.newPermission.slugs=[],m=[],a.showPermissionsMenu=!1,a.showObjectsMenu=!1,b&&(a.newPermission.type=b.type)})},a.createPermission=function(){a.creatingPermission=!0;var b=a.newPermission.actual_type||a.newPermission.type,d=a.newPermission.slugs;if(0!==a.newPermission.objects.length)for(var e=[],f=a.newPermission.objects.length-1;f>=0;f--)e.push(a.newPermission.objects[f].id);var g=c.one("groups",a.group.id).one("permissions",b).customPOST({permissions:d,objects_ids:e});g.then(function(c){if(a.creatingPermission=!1,0===a.newPermission.objects.length)a.permissions.push({permission_type:b,permission_names:d,object:null});else for(var e=a.newPermission.objects.length-1;e>=0;e--){for(var f=!1,g=a.permissions.length-1;g>=0;g--)_.isUndefined(a.permissions[g].object)||a.permissions[g].permission_type!=b||a.permissions[g].object.id!=a.newPermission.objects[e].id||(f=!0,a.permissions[g].permission_names=_.union(a.permissions[g].permission_names,angular.copy(d)));f||a.permissions.push({permission_type:b,permission_names:angular.copy(d),object:a.newPermission.objects[e]})}a.setNewPermissionType(null)})},a.removePermission=function(b,d){b.removingPermission=!0;var e=b.object?b.object.id:void 0,f=c.one("groups",a.group.id).one("permissions",b.permission_type).customDELETE(null,{permission:d,object_id:e});f.then(function(){"string"==typeof b.permission_names||"object"==typeof b.permission_names&&1===b.permission_names.length?a.permissions.splice(a.permissions.indexOf(b),1):b.permission_names.splice(b.permission_names.indexOf(d),1),b.removingPermission=!1})}}]),angular.module("ConfigModule",["ConfigControllerModule"]).config(["$stateProvider",function(a){a.state("config",{url:"/config",templateUrl:"routes/config/config.template.html",
controller:"ConfigController",resolve:{User:["User",function(a){return a({permissions:["isLogged"]})}],flagsResponse:["Restangular",function(a){return a.all("feature_flags").getList()}]}})}]),angular.module("ConfigControllerModule",["FeatureFlagComponentModule"]).controller("ConfigController",["$scope","flagsResponse",function(a,b){for(var c={explore:{name:"Explorar o mapa",desc:"Permite visualizar os relatos publicados por outros usuário em um mapa. As informações pessoais destes usuários não são exibidas nos relatos.",mobileConfig:!0},create_report_clients:{name:"Criar relatos",desc:"Permite que cidadãos possam criar os relatos.",mobileConfig:!0},create_report_panel:{name:"Criar relato pelo painel administrativo",desc:"Permite que usuários do painel administrativo possam criar relatos dos usuários. Ideal para atendimento ao munícipe (156) e prestadora de serviços.",mobileConfig:!1},stats:{name:"Estatísticas",desc:"Permite que os usuários visualizem estatísticas globais dos status dos relatos. As informações detalhadas não é exibida nesta interface, apenas a somatória de todos os relatos dentro daquele status específicos.",mobileConfig:!0},social_networks_facebook:{name:"Compartilhamento do relato no Facebook",desc:"Permite que o usuário, ao publicar um novo relato, compartilhe no Facebook. Se desativado o usuário não pode conectar sua conta do Facebook no aplicativo e também não é exibido o botão de compartilhamento.",mobileConfig:!0},social_networks_twitter:{name:"Compartilhamento do relato no Twitter",desc:"Permite que o usuário, ao publicar um novo relato, compartilhe no Twitter. Se desativado o usuário não pode conectar sua conta do Twitter no aplicativo e também não é exibido o botão de compartilhamento.",mobileConfig:!0},social_networks_gplus:{name:"Compartilhamento do relato no Google Plus",desc:"Permite que o usuário, ao publicar um novo relato, compartilhe no Google Plus. Se desativado o usuário não pode conectar sua conta do Google Plus no aplicativo e também não é exibido o botão de compartilhamento.",mobileConfig:!0},allow_photo_album_access:{name:"Permitir acesso ao album de fotos",desc:"Permite que o usuário, ao publicar um novo relato, selecione uma foto do próprio album para inserir no relato. Se desativado o usuário só poderá fazer uma fotografia ou continuar sem enviar nenhuma foto.",mobileConfig:!0},cases:{name:"Casos",desc:"Aenean eu leo quam. Pellentesque ornare sem lacinia quam venenatis vestibulum. Cras justo odio, dapibus ac facilisis in, egestas eget quam.",mobileConfig:!1},inventory:{name:"Inventário",desc:"O sistema ZUP permite que instituições e empresas criem qualquer tipo de inventário georeferenciado. O usuário com permissão de acesso às categorias de inventário tem a liberdade de criar campos diretamente pelo painel, para que outros usuários possam criar os itens de inventário relacionado a categoria e fazer a gestão deste itens de inventário utilizando diversas ferramentas disponíveis.",mobileConfig:!1},reports:{name:"Relatos",desc:"A categoria de relato permite que empresas e instituições criem um canal de comunicação com os seus clientes e usuários, permitindo que os usuários relatem problemas. É possível criar ilimitadas categorias de relatos, é permitido que estas categorias possam ser disponibilizadas aos usuários nos aplicativos ou privado, isto é, só será permitido que usuários com acesso ao Painel ZUP possa criar os relatos.",mobileConfig:!1},show_resolution_time_to_clients:{name:"Exibir o tempo de resolução do relato para os usuários",desc:"Quando o usuário cria um relato, é exibido uma mensagem de agradecimento e o tempo de resolução do relato. Se desativado, esta mensagem do tempo é ocultada.",mobileConfig:!0}},d=angular.copy(b.data),e=d.length-1;e>=0;e--){var f=d[e].name;"undefined"!=typeof c[f]&&(d[e].name=c[f].name,d[e].desc=c[f].desc,d[e].mobileConfig=c[f].mobileConfig,d[e].enabled="disabled"===d[e].status?!1:!0)}a.flags=d}]),angular.module("HelpModule",["HelpControllerModule"]).config(["$stateProvider",function(a){a.state("help",{url:"/help",templateUrl:"routes/help/help.template.html",controller:"HelpController",resolve:{User:["User",function(a){return a({permissions:["isLogged"]})}]}})}]),angular.module("HelpControllerModule",["yaru22.md"]).controller("HelpController",["$scope",function(a){}]),angular.module("FlowsModule",["FlowsIndexModule","FlowsShowModule","FlowsShowStepsEditModule"]).config(["$stateProvider",function(a){a.state("flows",{"abstract":!0,url:"/flows",templateUrl:"routes/flows/flows.template.html",resolve:{User:["User",function(a){return a({permissions:["isLogged"]})}]}})}]),angular.module("FlowsIndexModule",["FlowsIndexControllerModule"]).config(["$stateProvider",function(a){a.state("flows.list",{url:"",views:{"":{templateUrl:"routes/flows/index/flows-index.template.html",controller:"FlowsIndexController",controllerAs:"ctrl"}}})}]),angular.module("FlowsIndexControllerModule",["FlowsAddModalControllerModule","FlowsEditModalControllerModule","FlowsDestroyModalControllerModule"]).controller("FlowsIndexController",["$scope","Restangular","$modal",function(a,b,c){a.loading=!0;var d=b.all("flows").getList({display_type:"full",return_fields:["id","title","total_cases","created_by.id","created_by.name","updated_by.id","updated_by.name","steps.id"].join()});d.then(function(b){a.loading=!1,a.flows=b.data}),a.addFlow=function(){c.open({templateUrl:"modals/flows/add/flows-add.template.html",windowClass:"addFlowModal",resolve:{flows:function(){return a.flows}},controller:"FlowsAddModalController"})},a.editFlow=function(b){c.open({templateUrl:"modals/flows/edit/flows-edit.template.html",windowClass:"addFlowModal",resolve:{flows:function(){return a.flows},flow:function(){return b}},controller:"FlowsEditModalController"})},a.removeFlow=function(b){c.open({templateUrl:"modals/flows/destroy/flows-destroy.template.html",windowClass:"removeModal",resolve:{flows:function(){return a.flows},flow:function(){return b}},controller:"FlowsDestroyModalController"})}}]),angular.module("FlowsShowModule",["FlowsShowControllerModule"]).config(["$stateProvider",function(a){a.state("flows.show",{url:"/{id:[0-9]{1,4}}",views:{"":{templateUrl:"routes/flows/show/flows-show.template.html",controller:"FlowsShowController",controllerAs:"ctrl"}}})}]),angular.module("FlowsShowControllerModule",["FlowsStepsAddModalControllerModule","FlowsStepsDestroyModalControllerModule","FlowsStepsOrderComponentModule"]).controller("FlowsShowController",["$scope","Restangular","$stateParams","$modal","$q",function(a,b,c,d,e){var f=c.id;a.loading=!0,a.currentTab="steps";var g=b.one("flows",f).get({display_type:"full",return_fields:["id","title","my_steps_flows.id","my_steps_flows.title","my_steps_flows.step_type","my_steps_flows.my_child_flow.id","my_steps_flows.my_child_flow.title","my_steps_flows.my_child_flow.step_type"].join()});g.then(function(c){a.loading=!1,a.flow=c.data,console.log(b.stripRestangular(a.flow))}),a.getAncestor=function(b){for(var c=a.flow.steps.length-1;c>=0;c--)if(a.flow.steps[c].id===b)return a.flow.steps[c]},a.addStep=function(){d.open({templateUrl:"modals/flows/steps/add/flows-steps-add.template.html",windowClass:"editStepModal",resolve:{flow:function(){return a.flow}},controller:"FlowsStepsAddModalController"})},a.removeStep=function(b){d.open({templateUrl:"modals/flows/steps/destroy/flows-steps-destroy.template.html",windowClass:"removeModal",resolve:{flow:function(){return a.flow},step:function(){return b}},controller:"FlowsStepsDestroyModalController"})},a.editFlow=function(){d.open({templateUrl:"modals/flows/edit/flows-edit.template.html",windowClass:"addFlowModal",resolve:{flows:function(){return null},flow:function(){return a.flow}},controller:"FlowsEditModalController"})}}]),angular.module("FlowsShowStepsEditModule",["FlowsShowStepsEditControllerModule"]).config(["$stateProvider",function(a){a.state("flows.show.steps-edit",{url:"/steps/{stepId:[0-9]{1,4}}/edit",views:{"@":{templateUrl:"routes/flows/show/steps-edit/flows-show-steps-edit.template.html",controller:"FlowsShowStepsEditController",controllerAs:"ctrl"}}})}]),angular.module("FlowsShowStepsEditControllerModule",["FlowsStepsEditModalControllerModule","FlowsCreateValueComponentModule","FlowsDroppableInputsAreaComponentModule","FlowsSingleValueComponentModule","FlowsStepFieldComponentModule","FlowsTriggerComponentModule","InventoryPopoverComponentModule","InventoryPopoverLinkComponentModule","InputsSidebarComponentModule","FlowsDraggableInputComponentModule"]).controller("FlowsShowStepsEditController",["$scope","Restangular","$modal","$stateParams","$q",function(a,b,c,d,e){var f=d.id,g=d.stepId;a.loading=!0,a.currentTab="form";var h=b.one("flows",f).get({display_type:"full",return_fields:["id","title","draft","initial","status"].join()}),i=b.one("flows",f).one("steps",g).get(),j=b.one("flows",f).one("steps",g).all("fields").getList(),k=b.one("flows",f).one("steps",g).all("triggers").getList(),l=b.all("flows").getList({display_type:"full",return_fields:["id","title"].join()});e.all([h,i,j,k,l]).then(function(c){a.loading=!1,a.flow=c[0].data,a.step=c[1].data,a.fields=c[2].data,a.triggers=c[3].data,a.flows=c[4].data,console.log(b.stripRestangular(a.flow)),console.log(b.stripRestangular(a.step)),console.log(b.stripRestangular(a.fields)),console.log(b.stripRestangular(a.triggers))}),a.availableInputs={normal:[{kind:"text",name:"Campo de texto"},{kind:"integer",name:"Campo numérico"},{kind:"decimal",name:"Campo decimal"},{kind:"checkbox",name:"Campo de múltipla escolha",multipleOptions:!0},{kind:"select",name:"Campo de lista",multipleOptions:!0},{kind:"radio",name:"Campo de escolha única",multipleOptions:!0},{kind:"meter",name:"Campo em metros"},{kind:"centimeter",name:"Campo em centímetros"},{kind:"kilometer",name:"Campo em quilômetros"},{kind:"year",name:"Campo em anos"},{kind:"month",name:"Campo em meses"},{kind:"day",name:"Campo em dias"},{kind:"hour",name:"Campo em horas"},{kind:"minute",name:"Campo em minutos"},{kind:"second",name:"Campo em segundos"},{kind:"angle",name:"Campo de ângulo"},{kind:"date",name:"Campo de data"},{kind:"time",name:"Campo de tempo"},{kind:"cpf",name:"Campo de CPF"},{kind:"cnpj",name:"Campo de CNPJ"},{kind:"url",name:"Campo de URL"},{kind:"email",name:"Campo de e-mail"},{kind:"image",name:"Campo de imagem"},{kind:"attachment",name:"Campo de anexo"}],special:[{kind:"previous_field",name:"Etapa anterior"},{kind:"category_inventory",name:"Categoria de inventário"},{kind:"category_inventory_field",name:"Campo de inventário"},{kind:"category_report",name:"Categoria de relato"}]},a.kindHasMultipleOptions=function(b){for(var c=a.availableInputs.normal.length-1;c>=0;c--)if(a.availableInputs.normal[c].kind===b)return a.availableInputs.normal[c].multipleOptions===!0;return!1},a.action_types=[{action:"enable_steps",name:"Ativar etapa(s)"},{action:"disable_steps",name:"Desativar etapa(s)"},{action:"finish_flow",name:"Finalizar fluxo(s)"},{action:"transfer_flow",name:"Transferir fluxo(s)"}],a.newTrigger=function(){var b={title:"Novo gatilho",trigger_conditions:[],action_type:"disable_steps",action_values:[],description:"",isNew:!0};a.triggers.push(b)},a.$on("hidePopovers",function(b,c){a.$broadcast("hideOpenPopovers",c)}),a.editStep=function(){c.open({templateUrl:"modals/flows/steps/edit/flows-steps-edit.template.html",windowClass:"editStepModal",resolve:{flow:function(){return a.flow},step:function(){return a.step}},controller:"FlowsStepsEditModalController"})}}]),angular.module("CasesModule",["CasesIndexModule","CasesEditModule"]).config(["$stateProvider",function(a){a.state("cases",{"abstract":!0,url:"/cases",templateUrl:"routes/cases/cases.template.html",resolve:{User:["User",function(a){return a({permissions:["isLogged"]})}]}})}]),angular.module("CasesIndexModule",["CasesIndexControllerModule"]).config(["$stateProvider",function(a){a.state("cases.list",{url:"",views:{"":{templateUrl:"routes/cases/index/cases-index.template.html",controller:"CasesIndexController",controllerAs:"ctrl"}}})}]),angular.module("CasesIndexControllerModule",[]).controller("CasesIndexController",["$scope","Restangular","$modal","$q","$location",function(a,b,c,d,e){a.currentTab="progress";var f,g,h=1,i=30;a.selectedFlows=[],a.selectedSteps=[];var j=function(){var c=b.all("cases"),d={display_type:"full",page:h,per_page:i};return 0!==a.selectedFlows.length&&(d.initial_flow_id=a.selectedFlows.join()),0!==a.selectedSteps.length&&(d.step_id=a.selectedSteps.join()),"finished"===a.currentTab&&(d.completed=!0),c.getList(d)},k=function(){var c=b.all("flows").getList({display_type:"full",initial:"true"}),e=j(),k=d.all([e,c]);return k.then(function(b){a.flows=b[1].data,a.cases=b[0].data,f=parseInt(b[0].headers().total),g=Math.ceil(f/i),a.steps=[];for(var c=a.flows.length-1;c>=0;c--)for(var d=a.flows[c].steps.length-1;d>=0;d--)a.steps.push(a.flows[c].steps[d]);console.log(a.steps),h++}),k};a.paginate=function(){if(h!==g+1&&a.loadingPagination===!1){a.loadingPagination=!0;var b=j();return b.then(function(b){for(var c=0;c<b.data.length;c++)a.cases.push(b.data[c]);h++,a.loadingPagination=!1}),b}a.loadingPagination=null},a.reload=function(){a.cases=[],a.loadingPagination=!1,a.loadingContent=!0,h=1,a.paginate().then(function(){a.loadingContent=!1})},a.$watchCollection("[currentTab, selectedFlows, selectedSteps]",function(b,c){angular.equals(b,c)===!1&&a.reload()}),a.loading=!0,a.loadingPagination=!1,k().then(function(){a.loading=!1}),a.createCase=function(a){var c=b.all("cases").post({initial_flow_id:a.id,step_id:a.steps[0].id});c.then(function(a){e.path("/cases/"+a.data.id)})}}]),angular.module("CasesEditModule",["CasesEditControllerModule"]).config(["$stateProvider",function(a){a.state("cases.edit",{url:"/{id:[0-9]{1,4}}",views:{"@":{templateUrl:"routes/cases/edit/cases-edit.template.html",controller:"CasesEditController",controllerAs:"ctrl"}}})}]),angular.module("CasesEditControllerModule",[]).controller("CasesEditController",["$scope","Restangular","$modal","$stateParams",function(a,b,c,d){var e=d.id;a.loading=!0,a.currentTab="steps";var f=b.one("cases",e).get({display_type:"full"});f.then(function(c){a["case"]=c.data,a.loading=!1,console.log(b.stripRestangular(a["case"]))}),a.toggleTree=function(){a.viewTree===!0?a.viewTree=!1:a.viewTree=!0},a.selectConductor=function(){c.open({templateUrl:"views/cases/selectConductor.html",windowClass:"modalConductor"})},a.changeConductor=function(){c.open({templateUrl:"views/cases/changeConductor.html",windowClass:"modalConductor"})}}]),angular.module("BusinessReportsModule",["BusinessReportsIndexModule","BusinessReportsEditModule"]).config(["$stateProvider",function(a){a.state("business_reports",{url:"/business-reports",templateUrl:"routes/business-reports/business-reports.template.html","abstract":!0,resolve:{User:["User",function(a){return a({permissions:["isLogged"]})}]}})}]),angular.module("BusinessReportsIndexModule",["BusinessReportsIndexControllerModule"]).config(["$stateProvider",function(a){a.state("business_reports.list",{url:"",views:{"":{templateUrl:"routes/business-reports/index/business-reports-index.template.html",controller:"BusinessReportsIndexController",controllerAs:"ctrl"}}})}]),angular.module("BusinessReportsIndexControllerModule",["BusinessReportsIndexHeaderDirectiveModule","BusinessReportsIndexListDirectiveModule","BusinessReportsServiceModule"]).controller("BusinessReportsIndexController",["$scope","BusinessReportsService",function(a,b){a.loadContent=b.fetchAll}]),angular.module("BusinessReportsIndexHeaderDirectiveModule",[]).directive("businessReportsIndexHeader",function(){return{restrict:"E",scope:{showAddNewButton:"="},templateUrl:"routes/business-reports/index/components/header/business-reports-index-header.template.html"}}),angular.module("BusinessReportsIndexListDirectiveModule",["BusinessReportsDestroyModalModule","BusinessReportsServiceModule"]).directive("businessReportsIndexList",["$state","BusinessReportsService","$rootScope","BusinessReportDestroyModalService",function(a,b,c,d){return{restrict:"E",scope:{loadContent:"&",showEditButton:"=",showRemoveButton:"="},templateUrl:"routes/business-reports/index/components/list/business-reports-index-list.template.html",controller:["$scope","$window",function(e,f){e.loadContent().then(function(a){e.reports=a,e.contentLoaded=!0},function(){e.errorLoadingContent=!0});var g=function(a){e.reports.splice(e.reports.indexOf(a),1)};e.deleteReport=function(a){d.open(a).then(g)},e.daysBetween=function(a,b){return Math.ceil((b-a)/1e3/60/60/24)},e.reloadApplication=function(){f.location.reload(!0)},e.openBusinessReport=function(b,d){c.loading||"a"==d.target.parentNode.tagName.toLowerCase()||"a"==d.target.tagName.toLowerCase()||a.go("business_reports.show",{reportId:b})},e.duplicateReport=function(d){c.loading||(c.loading=!0,b.find(d.id).then(function(d){delete d.id,d.title+=" - cópia",_.each(d.charts,function(a){delete a.id}),b.save(d).then(function(){c.showMessage("ok","Relato duplicado com sucesso!","success",!0),c.loading=!1,a.transitionTo(a.current,{},{reload:!0,inherit:!1,notify:!0})})}))}}]}}]),angular.module("BusinessReportsEditModule",["BusinessReportsEditControllerModule","BusinessReportsServiceModule"]).config(["$stateProvider",function(a){a.state("business_reports.edit",{url:"/{reportId:[0-9]{1,9}}/edit",views:{"":{templateUrl:"routes/business-reports/edit/business-reports-edit.template.html",controller:"BusinessReportsEditController"}},resolve:{editable:["$q",function(a){var b=a.defer();return b.resolve(!0),b.promise}]}}),a.state("business_reports.show",{url:"/{reportId:[0-9]{1,9}}/show",views:{"":{templateUrl:"routes/business-reports/edit/business-reports-edit.template.html",controller:"BusinessReportsEditController"}},resolve:{editable:["$q",function(a){var b=a.defer();return b.resolve(!1),b.promise}]}}),a.state("business_reports.add",{url:"/add",views:{"":{templateUrl:"routes/business-reports/edit/business-reports-edit.template.html",controller:"BusinessReportsEditController"}},resolve:{editable:["$q",function(a){var b=a.defer();return b.resolve(!0),b.promise}]}})}]),angular.module("BusinessReportsEditControllerModule",["BusinessReportsEditHeaderDirectiveModule","BusinessReportsEditFormDirectiveModule","BusinessReportsEditChartsDirectiveModule","BusinessReportsServiceModule","GroupSelectorModule","AngularPrint"]).controller("BusinessReportsEditController",["ENV","Auth","$state","$scope","BusinessReportsService","$stateParams","$window","editable","GroupSelectorService",function(a,b,c,d,e,f,g,h,i){d.reportLoaded=!1,d.editable=h,f.reportId?e.find(f.reportId).then(function(a){d.report=a,d.reportLoaded=!0},function(){d.showMessage("exclamation-sign"," Não foi possível carregar o relatório requisitado. Por favor, tente novamente em alguns minutos.","error",!0),c.go("business_reports.list")}):(d.report={charts:[]},d.reportLoaded=!0);var j=function(){d.valid=d.reportLoaded&&e.isValid(d.report)};d.$watch("report.title",j),d.$watch("report.charts",j,!0),d.saveBusinessReport=function(){d.savePromise=e.save(d.report),d.savePromise.then(function(a){d.report=a,d.showMessage("ok","O Relatório "+d.report.title+" foi salvo com sucesso","success",!0),c.go("business_reports.show",{reportId:d.report.id})},function(){d.showMessage("exclamation-sign"," Não foi possível salvar o relatório "+d.report.title+". Por favor, tente novamente em alguns minutos.","error",!0)})},d.exportToXLS=function(){g.location=a.apiEndpoint+"/business_reports/"+d.report.id+"/export/xls?token="+b.getToken()}}]),angular.module("BusinessReportsEditHeaderDirectiveModule",[]).directive("businessReportsEditHeader",function(){return{restrict:"E",scope:{report:"=",savePromise:"=",showPrintButton:"=",showXlsButton:"=",showEditButton:"=",showSaveButton:"=",enableSaveButton:"=",saveButtonClicked:"&",xlsButtonClicked:"&"},templateUrl:"routes/business-reports/edit/components/header/business-reports-edit-header.template.html"}}),angular.module("BusinessReportsEditFormDirectiveModule",["angularInlineEdit","PeriodSelectorModule"]).directive("businessReportsEditForm",["PeriodSelectorService",function(a){return{restrict:"E",scope:{editable:"=",report:"=",valid:"="},templateUrl:"routes/business-reports/edit/components/form/business-reports-edit-form.template.html",controller:["$scope",function(b){b.openPeriodSelector=function(){a.open(!1).then(function(a){b.report.begin_date=a.beginDate,b.report.end_date=a.endDate})},b.hasDefaultPeriodSelected=function(){return b.report.begin_date&&b.report.end_date},b.clearDefaultPeriod=function(){b.report.begin_date=void 0,b.report.end_date=void 0}}]}}]),angular.module("BusinessReportsEditChartDirectiveModule",["googlechart","BusinessReportsEditChartModalModule","PeriodSelectorModule"]).directive("businessReportsChart",["BusinessReportsEditChartModalService","PeriodSelectorService",function(a,b){return{restrict:"E",scope:{chartData:"=",editable:"=",onChartDelete:"&",onChartUpdate:"&",defaultBeginDate:"=",defaultEndDate:"="},templateUrl:"routes/business-reports/edit/components/chart/business-reports-edit-chart.template.html",controllerAs:"chartCtrl",controller:["$scope",function(c){c.hasSelectedDate=!1;var d=["BarChart","AreaChart","PieChart","LineChart"],e={period:{},categories:[],type:d[Math.ceil(Math.random()*d.length)-1],data:{cols:[{type:"string",label:"Categoria"},{type:"number",label:"Relatos"}],rows:[{c:[{v:"Exemplo 1"},{v:250}]},{c:[{v:"Exemplo 2"},{v:150}]},{c:[{v:"Exemplo 3"},{v:450}]}]}},f=function(){c.onChartUpdate({chart:c.chart})};c.chartData&&c.chartData.id?c.chart=c.chartData:c.chart=_.extend(c.chartData,e),c.chart.period.begin_date&&c.chart.period.end_date||(c.chart.period.begin_date=c.defaultBeginDate,c.chart.period.end_date=c.defaultEndDate),c.openConfigureModal=function(){var b=angular.copy(c.chart);a.open(b).then(function(a){c.chart=_.extend(c.chart,a),f()})},c.selectPeriod=function(){b.open(!1).then(function(a){c.chart.period.begin_date=a.beginDate,c.chart.period.end_date=a.endDate,c.hasSelectedDate=!0,f()})};var g=function(a){!c.editable||!a||a.length<1||(c.chart.data.rows=_.map(a,function(a){return{c:[{v:a.title},{v:Math.ceil(1e3*Math.random())}]}}))};c.$watch("chart.categories",g),c.$watch("chart.title",f),c.$watch("defaultBeginDate",function(a){!c.hasSelectedDate&&c.editable&&a&&(c.chart.period.begin_date=a)}),c.$watch("defaultEndDate",function(a){!c.hasSelectedDate&&c.editable&&a&&(c.chart.period.end_date=a)}),f()}]}}]),angular.module("BusinessReportsEditChartsDirectiveModule",["BusinessReportsEditChartDirectiveModule"]).directive("businessReportsCharts",function(){return{restrict:"E",scope:{charts:"=",valid:"=",defaultBeginDate:"=",defaultEndDate:"=",editable:"="},templateUrl:"routes/business-reports/edit/components/charts/business-reports-edit-charts.template.html",controller:["$scope",function(a){a.addChart=function(){var b={};a.charts.push(b)},a.deleteChart=function(b){a.charts.splice(a.charts.indexOf(b),1)},a.updateChart=function(b){a.charts[a.charts.indexOf(b)]=b},a.charts.length<1&&a.addChart()}]}}),angular.module("EqualsComponentModule",[]).directive("equals",function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){a.$watch(c.ngModel,function(){e()}),c.$observe("equals",function(a){e()});var e=function(){var a=d.$viewValue,b=c.equals;"undefined"!=typeof a&&"undefined"!=typeof b&&d.$setValidity("equals",a===b)}}}}}),angular.module("NextFieldOnEnterComponentModule",[]).directive("nextFieldOnEnter",function(){return function(a,b,c){var d=b.find("input");if(c.nextFieldOnEnter)var e=a.$eval(c.nextFieldOnEnter);_.each(d,function(b){angular.element(b).bind("keydown keypress",function(c){13===c.which&&(a.$apply(function(){var a,c=d.index(b)+1;(a=d.get(c))?(a.focus(),e&&e(b,a)):e(b,null)}),c.preventDefault())})})}}),angular.module("NavItemComponentModule",[]).directive("navItem",["$location",function(a){return{restrict:"A",link:function(b,c){var d=c.find("a")[0].getAttribute("ng-href");b.location=a,b.$watch("location.absUrl()",function(a){-1!==a.indexOf(d)?c.addClass("active"):c.removeClass("active")})}}}]),angular.module("MapComponentModule",["GoogleMapServiceModule","ReportsItemsServiceModule","InventoriesItemsServiceModule"]).directive("map",["$rootScope","GoogleMapService","ReportsItemsService","InventoriesItemsService","ENV",function(a,b,c,d,e){return{restrict:"A",scope:{getCategory:"&",getData:"&",getFiltersOptions:"&",filterSelectedAreas:"="},link:function(f,g,h){var i="reports"===h.mapCategory?!0:!1,j=new b(i,parseFloat(e.mapLat),parseFloat(e.mapLng),parseInt(e.mapZoom,10),g[0]),k=i?c.fetchClustered:d.fetchClustered,l=null,m=function(){var b=j.getCenter(),e={zoom:j.getZoom(),clusterize:!0},g=f.getFiltersOptions()||{},h={latitude:b.lat(),longitude:b.lng(),distance:j.getDistance()};a.mapDebug=_.extend({zoom:e.zoom},h),_.isUndefined(g["position[0][latitude]"])&&(e["position[latitude]"]=h.latitude,e["position[longitude]"]=h.longitude,e["position[distance]"]=h.distance),e=_.extend(e,g),l=e,i?c.resetCache():d.resetCache(),k(e).then(function(a){if(l===e){var b=a.clusters,c=i?a.reports:a.items;j.processMarkers(b,c),j.processMarkersCanvas(b,c)}})},n=null,o=null,p=function(){n&&clearTimeout(n),n=setTimeout(function(){m()},300),o&&clearTimeout(o),o=setTimeout(function(){j.hideOutOfBoundsMarkers()},100)},q=j.getZoom();google.maps.event.addListener(j.getMap(),"bounds_changed",function(){q!==j.getZoom()&&(j.changeFilterOuterCircles(),q=j.getZoom()),p()}),google.maps.event.addListener(j.getMap(),"dragend",function(){j.overlay.draw()}),f.$on("mapRefreshRequested",function(){p(),f.$watch("filterSelectedAreas",function(){j.processAreaFilters(f.filterSelectedAreas)})})}}}]),angular.module("PeriodSelectorModule",[]).controller("PeriodSelectorController",["$scope","$modalInstance","promise","openEnded",function(a,b,c,d){a.openEnded=d,a.period={beginDate:new Date,endDate:new Date,tab:"between"},a.save=function(){var d=!1,e=!1;("between"===a.period.tab||"from"===a.period.tab)&&(d=!0,a.period.beginDate=moment(a.period.beginDate).startOf("day").toDate()),("between"===a.period.tab||"to"===a.period.tab)&&(e=!0,a.period.endDate=moment(a.period.endDate).startOf("day").toDate()),d&&e?c.resolve(a.period):d?c.resolve({beginDate:a.period.beginDate}):e&&c.resolve({endDate:a.period.endDate}),b.close()},a.validRange=function(){return d&&"between"!=a.period.tab?!0:a.period.beginDate<=a.period.endDate},a.close=function(){c.reject(),b.close()}}]).factory("PeriodSelectorService",["$modal","$q",function(a,b){return{open:function(c){var d=b.defer();return a.open({templateUrl:"components/period-selector/period-selector.template.html",windowClass:"periodSelectorModal",resolve:{promise:function(){return d},openEnded:function(){return c}},controller:"PeriodSelectorController"}),d.promise}}}]),angular.module("GroupSelectorModule",[]).controller("GroupSelectorController",["$scope","$modalInstance","selectedGroups","multiple","promise","Restangular",function(a,b,c,d,e,f){a.selectedGroups=angular.copy(c),a.multiple=d,a.loading=!0,f.all("groups").getList({return_fields:"id,name"}).then(function(b){a.loading=!1,a.groups=f.stripRestangular(b.data)}),a.isActive=function(b){return _.findWhere(a.selectedGroups,{id:b.id})},a.toggle=function(b){var c=_.findWhere(a.selectedGroups,{id:b.id});d?c?a.selectedGroups.splice(c,1):a.selectedGroups.push(b):a.selectedGroups=[c]},a.confirm=function(){e.resolve(a.selectedGroups),b.close()},a.close=function(){e.reject(),b.close()}}]).factory("GroupSelectorService",["$modal","$q",function(a,b){return{open:function(c,d){var e=b.defer();return a.open({templateUrl:"components/group-selector/group-selector.template.html",windowClass:"groupSelectorModal",resolve:{promise:function(){return e},selectedGroups:function(){return c},multiple:function(){return d}},controller:"GroupSelectorController"}),e.promise}}}]),function(a,b,c){b.module("angularInlineEdit.providers",[]).value("InlineEditConfig",{btnEdit:"Edit",btnSave:"",btnCancel:"",editOnClick:!1,onBlur:null}).constant("InlineEditConstants",{CANCEL:"cancel",SAVE:"save"})}(window,window.angular),function(a,b,c){b.module("angularInlineEdit.controllers",[]).controller("InlineEditController",["$scope","$document","$timeout",function(a,b,c){a.placeholder="",a.validationError=!1,a.validating=!1,a.isOnBlurBehaviorValid=!1,a.cancelOnBlur=!1,a.editMode=!1,a.inputValue="";var d;a.editText=function(e){a.editMode=!0,a.inputValue="string"==typeof e?e:a.model,d&&c.cancel(d),d=c(function(){a.editInput[0].focus(),a.isOnBlurBehaviorValid&&b.bind("click",a.onDocumentClick)},0)},a.applyText=function(d,e){function f(){a.model=i,a.callback({newValue:i}),a.editMode=!1}function g(){a.validationError=!0,j&&c.cancel(j),j=c(function(){a.editText(i)},0)}function h(b){a.validating=!1,b&&e&&a.$apply()}var i=a.inputValue;a.validationError=!1;var j;if(d||a.model===i)a.editMode=!1,e&&a.$apply();else{a.validating=!0,e&&a.$apply();var k=a.validate({newValue:a.inputValue});k&&k.then?k.then(f)["catch"](g)["finally"](h):k||"undefined"==typeof k?(f(),h(!0)):(g(),h(!0))}a.isOnBlurBehaviorValid&&b.unbind("click",a.onDocumentClick)},a.onInputKeyup=function(b){if(!a.validating)switch(b.keyCode){case 13:a.applyText(!1,!1);break;case 27:a.applyText(!0,!1)}},a.onDocumentClick=function(b){a.validating||b.target!==a.editInput[0]&&a.applyText(a.cancelOnBlur,!0)},a.$on("$destroy",function(){a.isOnBlurBehaviorValid&&b.unbind("click",a.onDocumentClick)})}])}(window,window.angular),function(a,b,c){b.module("angularInlineEdit.directives",["angularInlineEdit.providers","angularInlineEdit.controllers"]).directive("inlineEdit",["$compile","InlineEditConfig","InlineEditConstants",function(a,c,d){return{restrict:"A",controller:"InlineEditController",scope:{model:"=inlineEdit",callback:"&inlineEditCallback",validate:"&inlineEditValidation"},link:function(e,f,g){e.model=e.$parent.$eval(g.inlineEdit);var h=g.hasOwnProperty("inlineEditOnBlur")?g.inlineEditOnBlur:c.onBlur;(h===d.CANCEL||h===d.SAVE)&&(e.isOnBlurBehaviorValid=!0,e.cancelOnBlur=h===d.CANCEL);var i=b.element("<div class=\"ng-inline-edit\" ng-class=\"{'ng-inline-edit--validating': validating, 'ng-inline-edit--error': validationError}\">"),j=b.element('<input type="text" class="ng-inline-edit__input" ng-disabled="validating" ng-show="editMode" ng-keyup="onInputKeyup($event)" ng-model="inputValue" placeholder="{{placeholder}}" />'),k=b.element('<div class="ng-inline-edit__inner-container"></div>');k.append(b.element('<span class="ng-inline-edit__text" ng-class="{\'ng-inline-edit__text--placeholder\': !model}" '+(g.hasOwnProperty("inlineEditOnClick")||c.editOnClick?'ng-click="editText()" ':"")+'ng-if="!editMode">{{model || placeholder}}</span>'));var l=g.hasOwnProperty("inlineEditBtnEdit")?g.inlineEditBtnEdit:c.btnEdit;l&&k.append(b.element('<a class="ng-inline-edit__button ng-inline-edit__button--edit" ng-if="!editMode" ng-click="editText()">'+l+"</a>"));var m=g.hasOwnProperty("inlineEditBtnSave")?g.inlineEditBtnSave:c.btnSave;m&&k.append(b.element('<a class="ng-inline-edit__button ng-inline-edit__button--save" ng-if="editMode && !validating" ng-click="applyText(false, false)">'+m+"</a>"));var n=g.hasOwnProperty("inlineEditBtnCancel")?g.inlineEditBtnCancel:c.btnCancel;n&&k.append(b.element('<a class="ng-inline-edit__button ng-inline-edit__button--cancel" ng-if="editMode && !validating" ng-click="applyText(true, false)">'+n+"</a>")),i.append(j).append(k),f.append(i),e.editInput=j,g.$observe("inlineEdit",function(b){e.model=e.$parent.$eval(b),a(f.contents())(e)}),g.$observe("inlineEditPlaceholder",function(a){e.placeholder=a})}}}])}(window,window.angular),function(a,b,c){b.module("angularInlineEdit",["angularInlineEdit.providers","angularInlineEdit.controllers","angularInlineEdit.directives"])}(window,window.angular),angular.module("StyleMapComponentModule",[]).directive("styleMap",["$window",function(a){return{restrict:"A",link:function(b,c){var d=function(){c.find(".mapItems").css({"margin-top":c.find(".advancedSearch").height()})},e=function(){
var b=$(a).height()-60-71-56-c.find(".advancedSearch").height()-2;c.find(".mapItems").height(b)};d(),e(),$(a).resize(function(){e()}),b.$watch("activeAdvancedFilters",function(){d(),e()},!0)}}}]),angular.module("StyleResultsTableComponentModule",[]).directive("styleResultsTable",["$timeout",function(a){return{restrict:"A",link:function(b,c){var d=function(){c.find(".custom_table").css({"margin-top":c.find(".advancedSearch").height()})};d(),b.$watch("activeAdvancedFilters",function(){a(function(){d()})},!0)}}}]),angular.module("OnBlurComponentModule",[]).directive("onBlur",function(){return{restrict:"A",link:function(a,b,c){b.bind("blur",function(){"undefined"!=typeof c.onBlurDelay?setTimeout(function(){a.$apply(c.onBlur)},c.onBlurDelay):a.$apply(c.onBlur)})}}}),angular.module("OnFocusComponentModule",[]).directive("onFocus",function(){return{restrict:"A",link:function(a,b,c){b.bind("focus",function(){a.$apply(c.onFocus)})}}}),angular.module("FocusOnEventComponentModule",[]).directive("focusOnEvent",function(){return{restrict:"A",link:function(a,b,c){a.$on(c.focusOnEvent,function(){b.focus()})}}}),angular.module("FocusIfComponentModule",[]).directive("focusIf",["$timeout","$parse",function(a,b){var c;return{link:function(d,e,f){var g=b(f.focusIf);g.literal===!0&&(c&&a.cancel(c),c=a(function(){e[0].focus()},400))}}}]),angular.module("AddAreaCircleFormComponentModule",[]).directive("addAreaCircleForm",function(){return{restrict:"A",link:function(a,b){var c={types:["geocode"],componentRestrictions:{country:"br"}},d=new google.maps.places.Autocomplete(b.find(".address")[0],c);d.bindTo("bounds",a.map),google.maps.event.addListener(d,"place_changed",function(){var a=d.getPlace();a.geometry&&(b.find(".lat").val(a.geometry.location.lat()),b.find(".lng").val(a.geometry.location.lng()))}),a.addCircle=function(){var c=b.find(".lat"),d=b.find(".lng"),e=!1;c.removeClass("form-error"),d.removeClass("form-error"),""===c.val()&&(c.addClass("form-error"),e=!0),""===d.val()&&(d.addClass("form-error"),e=!0),e||a.addCircleByLatLng(c.val(),d.val())}}}}),angular.module("AreaMapComponentModule",[]).directive("areaMap",["ENV",function(a){return{restrict:"A",link:function(b,c){var d={options:{styles:[{},{featureType:"poi.business",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.government",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.medical",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.place_of_worship",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.school",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.sports_complex",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"labels",stylers:[{visibility:"off"},{saturation:-100},{lightness:42}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{saturation:-100},{lightness:47}]},{featureType:"landscape",stylers:[{lightness:82},{saturation:-100}]},{featureType:"water",stylers:[{hue:"#00b2ff"},{saturation:-21},{lightness:-4}]},{featureType:"poi",stylers:[{lightness:19},{weight:.1},{saturation:-22}]},{elementType:"geometry.fill",stylers:[{visibility:"on"},{lightness:18}]},{elementType:"labels.text",stylers:[{saturation:-100},{lightness:28}]},{featureType:"poi.attraction",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{saturation:12},{lightness:25}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels.text",stylers:[{lightness:30}]},{featureType:"landscape.man_made",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{saturation:-100},{lightness:56}]},{featureType:"road.local",elementType:"geometry.fill",stylers:[{lightness:62}]},{featureType:"landscape.man_made",elementType:"geometry",stylers:[{visibility:"off"}]}],homeLatlng:new google.maps.LatLng(a.mapLat,a.mapLng),map:{zoom:parseInt(a.mapZoom),mapTypeControl:!1,panControl:!0,panControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT},zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT},scaleControl:!0,scaleControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT},streetViewControl:!0,streetViewControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT}}},map:null,circles:[],lastListenerDistance:null,lastListenerPosition:null,DistanceWidget:function(a,b){this.set("map",a),this.set("position",b);var c=new google.maps.Marker({draggable:!0,title:"Me mova!",icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADYAAAA0CAYAAADBjcvWAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAG2YAABzjgAA+YsAAIR4AAB8wwAA95IAAC/yAAARoZE2jZ4AAAzVSURBVHjaxFprbGXXVf7WPq/7cG1fv+5NJ74eexIzGZgJaUd9qg+ESqREpa3oj6pIqOIPRVQgBD+CQEjwo6qEkChCQkgEqrbqQ6oaNVIpRWpaCKlSmsbDlITJTCYZxx3PMzPj6/s8Z++9+HH2vnd7+1zbk7jCoz3n+Fzfc86311rfWuvbm5gZh/RDY87dHx5zfug/4SGAIe/cv+YC8QcKjv9vwHwgwhnkHKnAWgxAO0ft/H6olgzfoIVcMIEZwjmKMcBcMMoM7Rz1YQEM7xIQOQBC5xg6vwcFVmMPmDRgpDOUM960e4Z3aSX74pEzYnN0AfpWY89SEkA2ZtAebnpowMhzudAAiQEk3jG6S2CpATIw5wPzDAtQFpDOoQBzySA0L544o2SGD8yNv6IY8y02MCMC0Dfn9tnWRe867sJ93M+1kgum7JzHAOKf3OzO/ufm1vKPbvZOXe7rpS2pZzPmEgDEgtKJQNxuJLTxtpnST3/lyPT5dy1UbxhgsTcxRTGq7hYYFSRo1/1sDFkQFTMssHgrlZUvv3TjxJObnV+90stWe4qnJFMpfy0a5QcGAuK0LMTWXCm89Gv10g8+9Qvza41KvG1csQ+gZ0bXHK0FpcOc/EaA+ZaybmcBVQ2oMoDkb89cfuhrr7U+ttFXp4gIRGJnkiMazrl9DAPQ5pd6TK98+J7KE396evGZgKjvgOsYcBagjUd10HjzgQknpmLHSlVnlC+3B1OfeWb9k89vpQ9LIApAyDEIkHADdASTifM3YvtmDMUAoPFLE9F//OUvN770jsbkFcdiHWf0HXB+vtsXmEvpNqYsmAl7vnajXf/dp9f/YH2gTwmRAwqIQIYriMwA5RYz5mIiAAztAMvPNZiBuRDrf/Fg428+ujL7sgOsbUbXAScP4pJiHze0RFEBUP7x1Vb9t//91ccu9fQpGlPpDqPKuCERQIJAzO6nsFNh73M946XH1q489q2LN4857j50exPvwZiqZiwwF1TgUXsZQOlOqqq//8z6710e8P1k3dwc9C43yK+TGw1EADOEM9HsTchtifqf//eVP3zuRqfusW/ipRPaD5woYEM3CQ/z1KefuvDxlzv8NuKCulbv06M432EGxrVKAsDVDEt/8uz6b3n50s2VB7JakcUiz2LxV168cv/TN/oftrxtYn7HlDDnFzTnrMdagzmPI22YkMHDrzHzkEj85uVsR73/s/916Z0F4A5sNVFAHIGTv2IA0eMv3Xikz6Ji32TIbMNih6E1Q0oJrTWYABYEBYZiCaU1JCtI1tCckxqxhiANwYAAIyAgICA0eeLJy9u/3k5lySGypCCRjwUnClqR0LFa+MT5q82X2uo0vBlmBljn15TWyKRGphiZVEiVRKYUpNKQzJBaQisNrRnaEhoxCDm40cMZBCAC42cp3f/4/2w+6AFzAe4JbpzFhpX6Uxt3HmhrngLrnJq1oW+Th6RkKMl53HDuikoCmdJQzNCKoRRDaoZmBoHAmqE0Q2lAaiDVjJQZmQYyDaQa6DHiH17bPlVQzvluWRhzodcRC7+vev713oOkOf+UCSANZmGT4Ij0LB2yzm+jCVrr3HWJQAFBMxkrk/mevS+GR4X8FgyN873wgY077YnF6QlpAMkx7YztBIbXw4L60KV9cW2glhgEZgZR/kLE9oV9tjPloSGSUb8hEJi/zysTHj1Vj47a4VMCcE3yPXeubEwuTj/Q9SqOIlqVLgWFBTrGDv1iS6LGFoSxhqZRYbuL4o01GdohOg2lRJ6seVQ/mmka/Z2wr567dY/FxFa7MwngltP2+AKQP7S91TjJjAAgU5S4RaxLIuxYyg6NnPmURk4W2nzXCXEe/sPO//VoQhgA6Yz+99zZRqfTiW/fvl1J07TiVEIVryrZkQb2lQaIcoZmkRODIBNKTv5xawm2MTWMO+N+1gVpVFox3PPcF5nsRGiQFrh67Xrp3LlzU0KIbHZ2Npifn0e5XGZPEJKeOLSj0SzU/WKobpdFInT+wpo4dx6dAx0Gv2NnskmczCwAyLMaGVfdrbaxbd/YiUtAS0n9zc3NMhGVer1eqLVGvV7X5XLZ7cStvLDLYkV+qgHo6RDXOinXmCl/YRNgbP3LuOYImDBEY+MyPxeGaWyFQu6E0M4H5/MWYEL2tpIwkp1OJ9ZaQylFRKSTJJFxHGdBEKRuznVpXxTIYzu0vuVqeCH/IC+PhjHGZHIXj4iEAWgFaA2tNFip/O8VQWlAmZjTnOcxV4qyOdAGK4cB5to3rk9PVAe9Xi9M0zTodDrx1tZW0mq1kjRNI0/221FmiSIruT773nrljHniKIZ4VN3n7uXTfm4CVoZIydAq046gzOvFHJHmUa2mAYi4gvprZ9YnJ6qDfr8fZlkWWHCdTidSSvki7Q4VushirogpP7J6z4VGjFe0ctiM2WMO9pjfxBWR00V7OZVNwudRzZmzKoNFiFLrens1URvb29txlmWUpqnIsixQSgkp5X7rBLss5gZkCiA7VZ+6/a650tOAtYALzi0bDDy3exaUG0nz0G2H5/aRxrW1nTQNUJTgnovPXTw2O3Wz1WrFWZYFUkqhlCIAiONYB0Ggxyxu7OrHfDHTipjp5z5w33cXguxSXvgaWh7+I2MLHtG3MF3zUKgiQOcxyaYUg7Z5C8MalBmAECi3Xu++J9t8vr29HaVpKtI0FVJKwcxcKpWyarWaBUHg6/7uggeLPcRMK2QOFicrrc88tPiFiPQgT6QaGFrPsJxp9i2RWAuxtZCtOkzBZNOy7ctsfFEQ8y++8K8/WiiFrV6vF0opAymlkFIiSRI5Ozvbq9VqgyAIZEH+GlpwXIxZa1lJrP/Hp5trH1msfs2KMZp13kzmJcbQRTUXD9Y6dzfTu2lDHKzNBAgCl9+Co2e+/cLbo+65brcbSSmDLMuElJKSJFFzc3Pder3enZyc7Buqd+XwHSKPGCNBZw4wK2L2vvjoySceqUdfz99HOCWVBrPatUjETmYc9W8jQKMyTADxBN76kyfPv7vz6o8Hg0FgmFBorZEkiZyfn+80m82tRqPRiePY1fsHjua4yxXHxVnf0fm6AHrf/I23f/UTRyv/mJDqWnAm7MCszDCWUgxWuYXYDFci0CCoKIEgoZd++JWfvufWi8+qNMVgMAiVUoKIuFKppEeOHGmtrq7eWlpa2p6YmOg679V3qg7pLkEVKcHCkQdc+a3qFJ+lzz936eTfn73ym5f6dAIiBDhv90fkK3be1X1MIIAoAUCoXruwdf/Z75y9j7rrIAIRcRRFqlqtDmZnZ7eXl5dvHz9+/NbKykqrVqt1giAo0hx7vqBapN3bJOeusLgV9VC7V8ylT3/v/MPf/1nrg1dRXpFaBxh0TRll2xExwkUAylUIOUB548Wt2UtrmyuvX7hYicKuEAJRFMlSqZROTk727r333q2VlZVbx48fv7O4uLg9OTlpFWEXmAU18CXwcYsSviocOxrf0Gp2XL52feKvvvj10/92C+9/pfnOh0AE6GxU3gOACIEoxNTad6/PXDqzOd+99Xo1DtoAKIoiWalU+lNTU92FhYXto0eP3lldXb29srLSmpmZ6ZbL5Z4Dquto+30H1A7yoDEaHxW4ZewtI5W95aTk+bW1mT96/Bsfe/bkRx/WDILOzDJLDBICc0/980bztbWXy6VSXwihoyjKKpVKr1ardRqNxnaz2byzsrKytby83FpYWOiVy+VBEAT9olj3QO1aw6Y99nkUrTm7QqovQ5fSNC13u93y7/z1Pzz8neUPfbzfHyQUhBAy44Xv/dP6W6+88Gq1Wu3UarXtWq3Wnpub69Tr9Vaz2dw+cuRIu9Fo9KanpwfVajU1dG5Zr+eNsWx4EGD+orqrXrlC5o7YU0qVgiCIP/XZz3/oG/X3fTLLVNL4l7+7uNJaP99cWrp64sSJa8eOHbszPz/fnZub609PT6eVSiU11YQMgiBzSjo3l/pWGgvqIMD22jHgLwhWHZIpAYg+8Wefe/TcxuZ970j6Z0+fPn355MmTt5rNZmdmZmYQBIEyQ3q7CDKnpOu7FZBzXe0F6qDA9nPNpCAllNI0LbXb7eTmzZslZha1Wi2dnp5Ox4CR3rp06tWrmZOrpAeID7pUe7euGRekhDKARCmVSClFGIZkqnHlWaboKD0gmbcXRB9kVfNud+bwjj6leF/UsCwLgmAQBEHgpOgi60gnXoosWeR2+1rjjW4SczU+WXDdlmSRV2hLpxaVBTtzirYisdelHsjF3szutyJw7Lx46rTt7mfKs4q/l2pXb/VGth+92W19Pjj2YkgUANNjNoftteXv7rfoHdJGTCrYnkRjth3xHmAObc9ieEj3YU+x0QXrVlyg6hwqmJ8HsCLGpD0m4Oe6bRYA/m8A8FVIJHb+8hMAAAAASUVORK5CYII="});c.bindTo("map",this),c.bindTo("position",this);var e=new d.RadiusWidget(a);e.bindTo("map",this),e.bindTo("center",this,"position"),this.bindTo("distance",e),this.bindTo("bounds",e)},RadiusWidget:function(a){var b=new google.maps.Circle({strokeWeight:1,strokeColor:"#37A6CF",fillColor:"#37A6CF"}),c=a.getBounds().getCenter(),d=a.getBounds().getNorthEast(),e=google.maps.geometry.spherical.computeDistanceBetween(c,d)/1e3;this.set("distance",e/3),this.bindTo("bounds",b),b.bindTo("center",this),b.bindTo("map",this),b.bindTo("radius",this),this.addSizer_()},setHelpers:function(){d.DistanceWidget.prototype=new google.maps.MVCObject,d.RadiusWidget.prototype=new google.maps.MVCObject,d.RadiusWidget.prototype.distance_changed=function(){this.set("radius",1e3*this.get("distance"))},d.RadiusWidget.prototype.addSizer_=function(){var a=new google.maps.Marker({draggable:!0,title:"Me mova!",icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAYAAACpSkzOAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAG2YAABzjgAA+YsAAIR4AAB8wwAA95IAAC/yAAARoZE2jZ4AAALBSURBVHjarJbvS5NRFMc/PtMpUQoDM6jMqBylRprhJoUQlEbRu4jo16LUBkXRC3vTfxAUhRX9gMrsdRBaVhBE0i9oy1qRsCkEWmQKkQpW27cXbXPN51mb+n04cLnPPfd7zzn3nHuyJGGF1bffxIZOoA4oBgqjc5+AfuARMGSm/3b3mvg425rEbwMOAieiRKnwBDgNdFotMMwmK9r9dRLvJS5LOCX4j9RJdEg8lVgem09JVNHu9wIP07DCDOuBl1E3WxOVt/uPCC4K7AKmKQ7BQ8HGxL2zYpeh/JavAegAbMwOhoDawN6qYNyislu+AsE1gW0GliRLoeD6P7dO4gSwMPE4OUYWPXsqpxzzauALZ32DacdsVZtv64d9VZ3GqjafDfAmr/gV0UxJYjgGkC3JnZCElhj/HeFOcJhUCW6BjStvvnYYEpus8iOGiXCEOdkG1zeXUpKfRxp5lSg2ifWGoMIqoAAXej6z614vP36GKZqTw436UkoK8jK9GE5DUqEkzOS8f5BzvgEC38bY3zVJdrN+BSX5uVjpmYjDSOXc1jeTgQ8MjyeQ2WlrKGVJfm78/05nyjDbDElD6Z7s3bcxPA8mydq3OCmeZ+dgeREt1YtS6Q4ZiA+ZOPvt1zE8CZbd2V7GyXWL/57bWq/XkNSVga+RRM/XUTz3PzIRjjDPPlmxLNaHJXVnIz0HRgBHJslROX8uubakEJvn2ONgY82IEWysCSNaM3Gfp2wBp9xLpm5pvr41Xr2XXXnhAD6mUyEyRHeoybUhXr1DTa4RxAFEmNkr36OIQ1MevlCzq1OoRczKFxbaHWp29Zq+sH3N7jOIozO07DtiG+Juyp6h77C7FbEFEZwGyStENaILpdEF9Xndj0BloOOg/jQYXoN2gGpAwX/LclLPYIall54lN5BrE36PAu+iDeSAmX6/tzY+/jMApcCWpTVr3IcAAAAASUVORK5CYII="});a.bindTo("map",this),a.bindTo("position",this,"sizer_position");var b=this;google.maps.event.addListener(a,"drag",function(){b.setDistance()})},d.RadiusWidget.prototype.center_changed=function(){var a=this.get("bounds");if(a){var b=a.getNorthEast().lng(),c=new google.maps.LatLng(this.get("center").lat(),b);this.set("sizer_position",c)}},d.RadiusWidget.prototype.distanceBetweenPoints_=function(a,b){if(!a||!b)return 0;var c=6371,d=(b.lat()-a.lat())*Math.PI/180,e=(b.lng()-a.lng())*Math.PI/180,f=Math.sin(d/2)*Math.sin(d/2)+Math.cos(a.lat()*Math.PI/180)*Math.cos(b.lat()*Math.PI/180)*Math.sin(e/2)*Math.sin(e/2),g=2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),h=c*g;return h},d.RadiusWidget.prototype.setDistance=function(){var a=this.get("sizer_position"),b=this.get("center"),c=this.distanceBetweenPoints_(b,a);this.set("distance",c)}},createMap:function(){var a=new google.maps.StyledMapType(this.options.styles,{name:"zup"});this.map=new google.maps.Map(c[0],this.options.map),this.map.mapTypes.set("zup",a),this.map.setMapTypeId("zup"),this.map.setCenter(this.options.homeLatlng),setTimeout(function(){google.maps.event.trigger(d.map,"resize"),google.maps.event.trigger(d.map,"bounds_changed"),d.map.setCenter(d.options.homeLatlng)},80),this.setHelpers(),google.maps.event.addListener(d.map,"click",function(a){d.addCircle(a.latLng)})},setLastCircleInfo:function(a){b.lastCirclePosition=a.get("position"),b.lastCircleDistance=a.get("distance"),b.lastCircleArea=a.get("distance")*a.get("distance")*Math.PI},addCircle:function(a){var b=new d.DistanceWidget(d.map,a);d.circles.push(b),d.setLastCircleInfo(b),google.maps.event.removeListener(d.lastListenerDistance),google.maps.event.removeListener(d.lastListenerPosition),d.lastListenerDistance=google.maps.event.addListener(b,"distance_changed",function(){d.setLastCircleInfo(b)}),d.lastListenerPosition=google.maps.event.addListener(b,"position_changed",function(){d.setLastCircleInfo(b)})}};d.createMap(),b.$parent.circles=d.circles,b.map=d.map,b.eraseAllCircles=function(){for(var a=d.circles.length-1;a>=0;a--)d.circles[a].set("map",null);d.circles=[]},b.eraseLastCircle=function(){d.circles[d.circles.length-1].set("map",null),d.circles.splice(d.circles.length-1,1)},b.fitCirclesBounds=function(){if(0!==d.circles.length){for(var a=new google.maps.LatLngBounds,b=d.circles.length-1;b>=0;b--)a.extend(d.circles[b].get("bounds").getNorthEast()),a.extend(d.circles[b].get("bounds").getSouthWest());d.map.fitBounds(a)}},b.addCircleByLatLng=function(a,c){d.addCircle(new google.maps.LatLng(a,c)),b.fitCirclesBounds()}}}}]),angular.module("FieldsFilterItemComponentModule",[]).directive("fieldsFilterItem",function(){return{restrict:"A",link:function(a){a.changeCondition=function(b){a.item.condition=b},a.$watch("item.fieldId",function(){if(null!==a.item.fieldId)for(var b=a.item.category.fields.length-1;b>=0;b--)a.item.category.fields[b].id==a.item.fieldId&&(a.item.field=a.item.category.fields[b])}),a.changeField=function(b){a.item.field=b},a["delete"]=function(){a.$parent.items.splice(a.$parent.items.indexOf(a.item),1)}}}}),angular.module("MapShowItemComponentModule",[]).directive("mapShowItem",["$timeout","$q","$rootScope","$compile",function(a,b,c,d){return{restrict:"A",link:function(a,b){var c={options:{styles:[{},{featureType:"poi.business",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.government",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.medical",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.place_of_worship",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.school",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.sports_complex",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"labels",stylers:[{visibility:"off"},{saturation:-100},{lightness:42}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{saturation:-100},{lightness:47}]},{featureType:"landscape",stylers:[{lightness:82},{saturation:-100}]},{featureType:"water",stylers:[{hue:"#00b2ff"},{saturation:-21},{lightness:-4}]},{featureType:"poi",stylers:[{lightness:19},{weight:.1},{saturation:-22}]},{elementType:"geometry.fill",stylers:[{visibility:"on"},{lightness:18}]},{elementType:"labels.text",stylers:[{saturation:-100},{lightness:28}]},{featureType:"poi.attraction",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{saturation:12},{lightness:25}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels.text",stylers:[{lightness:30}]},{featureType:"landscape.man_made",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{saturation:-100},{lightness:56}]},{featureType:"road.local",elementType:"geometry.fill",stylers:[{lightness:62}]},{featureType:"landscape.man_made",elementType:"geometry",stylers:[{visibility:"off"}]}],homeLatlng:new google.maps.LatLng(-23.549671,-46.6321713),map:{zoom:15,scrollwheel:!1,mapTypeControl:!1,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,"zup"]}}},map:null,start:function(){var d=new google.maps.StyledMapType(this.options.styles,{name:"zup"});this.map=new google.maps.Map(b[0],this.options.map),this.map.mapTypes.set("zup",d),this.map.setMapTypeId("zup"),a.$watch("loading",function(){"undefined"!=typeof a.item&&setTimeout(function(){google.maps.event.trigger(c.map,"resize"),google.maps.event.trigger(c.map,"bounds_changed"),c.map.setCenter(c.options.homeLatlng),c.addMarker(a.item,a.category)},80)})},addMarker:function(b,e){var f,g,h=new google.maps.LatLng(b.position.latitude,b.position.longitude),i=c.infoWindow;"marker"===e.plot_format?(f=new google.maps.Size(54,51),g=e.marker.retina.web):(f=new google.maps.Size(15,15),g=e.pin.retina.web);var j=new google.maps.MarkerImage(g,null,null,null,f),k={position:h,map:this.map,icon:j,category:e,item:b},l=new google.maps.Marker(k);this.map.setCenter(h),google.maps.event.addListener(l,"click",function(){var b="<div class=\"pinTooltip\"><h1>{{category.title}}</h1><p>Enviada {{ item.created_at | date: 'dd/MM/yy HH:mm'}}</p></div>",e=a.$new(!0);e.category=this.category,e.item=this.item;var f=d(b)(e);e.$apply(),i.setContent(f[0]),i.open(c.map,this)})}};c.start()}}}]),angular.module("MapShowReportComponentModule",[]).directive("mapShowReport",["$timeout","$q","$rootScope","$compile",function(a,b,c,d){return{restrict:"A",link:function(a,b){var c={options:{styles:[{},{featureType:"poi.business",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.government",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.medical",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.place_of_worship",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.school",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.sports_complex",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"labels",stylers:[{visibility:"off"},{saturation:-100},{lightness:42}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{saturation:-100},{lightness:47}]},{featureType:"landscape",stylers:[{lightness:82},{saturation:-100}]},{featureType:"water",stylers:[{hue:"#00b2ff"},{saturation:-21},{lightness:-4}]},{featureType:"poi",stylers:[{lightness:19},{weight:.1},{saturation:-22}]},{elementType:"geometry.fill",stylers:[{visibility:"on"},{lightness:18}]},{elementType:"labels.text",stylers:[{saturation:-100},{lightness:28}]},{featureType:"poi.attraction",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{saturation:12},{lightness:25}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels.text",stylers:[{lightness:30}]},{featureType:"landscape.man_made",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{saturation:-100},{lightness:56}]},{featureType:"road.local",elementType:"geometry.fill",stylers:[{lightness:62}]},{featureType:"landscape.man_made",elementType:"geometry",stylers:[{visibility:"off"}]}],homeLatlng:new google.maps.LatLng(-23.549671,-46.6321713),map:{zoom:15,scrollwheel:!1,mapTypeControl:!1,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,"zup"]}}},infoWindow:new google.maps.InfoWindow,map:null,marker:null,start:function(){var d=new google.maps.StyledMapType(this.options.styles,{name:"zup"});this.map=new google.maps.Map(b[0],this.options.map),this.map.mapTypes.set("zup",d),this.map.setMapTypeId("zup"),a.$watch("loading",function(){"undefined"!=typeof a.report&&setTimeout(function(){google.maps.event.trigger(c.map,"resize"),google.maps.event.trigger(c.map,"bounds_changed"),c.map.setCenter(c.options.homeLatlng),_.isNull(c.marker)||c.marker.setMap(null),c.marker=c.addMarker(a.report,a.report.category)},80)}),a.$watchCollection("[lat, lng]",function(){c.moveMarker(a.lat,a.lng)})},moveMarker:function(a,b){if(c.marker){var d=new google.maps.LatLng(a,b);c.map.setCenter(d),c.marker.setPosition(d)}},addMarker:function(b,e){var f=new google.maps.LatLng(b.position.latitude,b.position.longitude),g=c.infoWindow,h=new google.maps.Size(54,51),i=new google.maps.MarkerImage(e.marker.retina.web,null,null,null,h),j={position:f,map:this.map,icon:i,category:e,report:b},k=new google.maps.Marker(j);return this.map.setCenter(f),google.maps.event.addListener(k,"click",function(){var b="<div class=\"pinTooltip\"><h1>{{category.title}}</h1><p>Enviada {{ report.created_at | date: 'dd/MM/yy HH:mm'}}</p></div>",e=a.$new(!0);e.category=this.category,e.report=this.report;var f=d(b)(e);e.$apply(),g.setContent(f[0]),g.open(c.map,this)}),k}};c.start()}}}]),angular.module("MapViewStreetviewComponentModule",[]).directive("mapViewStreetview",function(){return{restrict:"A",scope:{latitude:"=",longitude:"="},link:function(a,b,c){function d(b,c){if(c!=google.maps.StreetViewStatus.OK)return a.$parent.hideStreetview=!0,void a.$apply();var d=e(h,b.location.latLng),f={position:h,addressControl:!0,linksControl:!0,panControl:!1,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL},pov:{heading:d,pitch:10,zoom:1},enableCloseButton:!1,visible:!0};g.setOptions(f)}function e(a,b){var c=57.2957795,d=.017453,e=a.lat()-b.lat(),g=a.lng()-b.lng(),h=Math.atan2(g*Math.cos(a.lat()*d),e)*c;return f(h)}function f(a){return a>=360?a-=360:0>a&&(a+=360),a}var g=new google.maps.StreetViewPanorama(b.find(".roundedMap").get(0)),h=new google.maps.LatLng(a.latitude,a.longitude),i=new google.maps.StreetViewService;i.getPanoramaByLocation(h,50,d);var j=function(a,b){var c,d,e=new google.maps.LatLng(a.position.latitude,a.position.longitude);"marker"===b.plot_format?(c=new google.maps.Size(54,51),d=b.marker.retina.web):(c=new google.maps.Size(15,15),d=b.pin.retina.web);var f=new google.maps.MarkerImage(d,null,null,null,c),h={position:e,map:g,icon:f,category:b,item:a};new google.maps.Marker(h)};j(a.$parent.item,a.$parent.category)}}}),angular.module("SelectLatLngMapComponent",[]).directive("selectLatLngMap",["$rootScope","ENV","FullResponseRestangular",function(a,b,c){return{restrict:"A",link:function(d,e){var f={options:{styles:[{},{featureType:"poi.business",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.government",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.medical",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.place_of_worship",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.school",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.sports_complex",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"labels",stylers:[{visibility:"off"},{saturation:-100},{lightness:42}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{saturation:-100},{lightness:47}]},{featureType:"landscape",stylers:[{lightness:82},{saturation:-100}]},{featureType:"water",stylers:[{hue:"#00b2ff"},{saturation:-21},{lightness:-4}]},{featureType:"poi",stylers:[{lightness:19},{weight:.1},{saturation:-22}]},{elementType:"geometry.fill",stylers:[{visibility:"on"},{lightness:18}]},{elementType:"labels.text",stylers:[{saturation:-100},{lightness:28}]},{featureType:"poi.attraction",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{saturation:12},{lightness:25}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels.text",stylers:[{lightness:30}]},{featureType:"landscape.man_made",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{saturation:-100},{lightness:56}]},{featureType:"road.local",elementType:"geometry.fill",stylers:[{lightness:62}]},{featureType:"landscape.man_made",elementType:"geometry",stylers:[{visibility:"off"}]}],homeLatlng:new google.maps.LatLng(b.mapLat,b.mapLng),map:{zoom:parseInt(b.mapZoom),scrollwheel:!0,panControlOptions:{position:google.maps.ControlPosition.RIGHT_BOTTOM},zoomControlOptions:{style:google.maps.ZoomControlStyle.MEDIUM,position:google.maps.ControlPosition.LEFT_BOTTOM},mapTypeControl:!1,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,"zup"]}}},map:null,mainMarker:null,start:function(){var a=new google.maps.StyledMapType(this.options.styles,{name:"zup"});this.map=new google.maps.Map(e[0],this.options.map),this.map.mapTypes.set("zup",a),this.map.setMapTypeId("zup");var b;null===d.$parent.latLng[0]&&null===d.$parent.latLng[1]?b=f.options.homeLatlng:(b=new google.maps.LatLng(d.$parent.latLng[0],d.$parent.latLng[1]),f.changedMarkerPosition(d.$parent.latLng[0],d.$parent.latLng[1]));var c=new google.maps.MarkerImage(d.$parent.category.marker.retina.web,null,null,null,new google.maps.Size(54,51)),g=new google.maps.Marker({map:f.map,draggable:!0,animation:google.maps.Animation.DROP,position:b,icon:c});f.mainMarker=g,f.map.setCenter(b),f.checkMarkerInsideAllowedBounds(f.mainMarker.getPosition().lat(),f.mainMarker.getPosition().lng()),google.maps.event.addListener(g,"dragend",function(){d.$parent.latLng[0]=f.mainMarker.getPosition().lat(),d.$parent.latLng[1]=f.mainMarker.getPosition().lng(),f.changedMarkerPosition(f.mainMarker.getPosition().lat(),f.mainMarker.getPosition().lng()),f.checkMarkerInsideAllowedBounds(f.mainMarker.getPosition().lat(),f.mainMarker.getPosition().lng())})},checkMarkerInsideAllowedBounds:function(a,b){var e=c.all("utils").all("city-boundary").customGET("validate",{longitude:b,latitude:a});e.then(function(a){d.$parent.markerOutOfBounds=a.data.inside_boundaries===!1})},changedMarkerPosition:function(a,b,c,e){var f=new google.maps.Geocoder;d.$parent.latLng=[a,b],d.$parent.addressComponents=null,d.$parent.formattedAddress=null,"undefined"!=typeof c&&(d.$parent.addressComponents=c),"undefined"!=typeof e&&(d.$parent.formattedAddress=e),f.geocode({latLng:new google.maps.LatLng(a,b)},function(a,b){b===google.maps.GeocoderStatus.OK&&("undefined"==typeof c&&(d.$parent&&(d.$parent.addressComponents=a[0].address_components,d.$parent.formattedAddress=a[0].formatted_address),d.formattedAddress=a[0].formatted_address),d.$apply())})}};f.start(),a.selectLatLngMap=f}}}]),angular.module("SearchLatLngMapComponent",[]).directive("searchLatLngMap",["$rootScope",function(a){return{restrict:"A",link:function(b,c){a.$watch("selectLatLngMap",function(){if("undefined"!=typeof a.selectLatLngMap){google.maps.event.clearListeners(a.selectLatLngMap.map);var b={types:["geocode"],componentRestrictions:{country:"br"}},d=new google.maps.places.Autocomplete(c[0],b);d.bindTo("bounds",a.selectLatLngMap.map),google.maps.event.addListener(d,"place_changed",function(){var b=d.getPlace();b.geometry&&(b.geometry.viewport?a.selectLatLngMap.map.fitBounds(b.geometry.viewport):(a.selectLatLngMap.map.setCenter(b.geometry.location),a.selectLatLngMap.map.setZoom(17)),a.selectLatLngMap.mainMarker.setPosition(b.geometry.location),a.selectLatLngMap.changedMarkerPosition(b.geometry.location.lat(),b.geometry.location.lng(),b.address_components,b.formatted_address))})}})}}}]),angular.module("NgThumbComponentModule",[]).directive("ngThumb",["$window",function(a){var b={support:!(!a.FileReader||!a.CanvasRenderingContext2D),isFile:function(b){return angular.isObject(b)&&b instanceof a.File},isImage:function(a){var b="|"+a.type.slice(a.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(b)}};return{restrict:"A",template:"<canvas/>",link:function(a,c,d){function e(a){var b=new Image;b.onload=f,b.src=a.target.result}function f(){var a=g.width||this.width/this.height*g.height,b=g.height||this.height/this.width*g.width;h.attr({width:a,height:b}),h[0].getContext("2d").drawImage(this,0,0,a,b)}if(b.support){var g=a.$eval(d.ngThumb);if(b.isFile(g.file)&&b.isImage(g.file)){var h=c.find("canvas"),i=new FileReader;i.onload=e,i.readAsDataURL(g.file)}}}}}]),angular.module("InputsSidebarComponentModule",[]).directive("inputsSidebar",function(){return{restrict:"A",link:function(a,b){b.affix({offset:{top:75}})}}}),angular.module("InventoryDraggableInputComponentModule",[]).directive("inventoryDraggableInput",function(){return{restrict:"A",link:function(a,b){b.draggable({connectToSortable:".droppableInputsArea",revert:"invalid",helper:function(){return $('<div class="customDraggableHelper">'+b.find("p").html()+"</div>")},start:function(a,b){$(b.helper).css("width","auto").css("height","auto")}})}}}),angular.module("InventoryDroppableInputsAreaComponentModule",[]).directive("inventoryDroppableInputsArea",function(){return{restrict:"A",link:function(a,b){var c=null,d=function(){b.find(".input").each(function(){$(this).scope().field.position=$(this).index()}),a.$apply()};b.sortable({revert:!0,handle:".handle",forcePlaceholderSize:!1,placeholder:{element:function(){return $('<div class="customSortablePlaceholder"><p>Solte para adicionar</p></div>')},update:function(){}},receive:function(a,b){var d=b.item.attr("name"),e=b.item.find("p").html(),f={toRemove:!1,kind:d,label:'Novo "'+e+'"',title:null,location:!1,maximum:null,minimum:null,required:!1,size:"M",inventory_fields_can_view:[],inventory_fields_can_edit:[],field_options:[],position:null};c=f},update:function(b,d){var e=$(d.item).index();if(null!==c){$(this).find(".item").remove(),c.position=e;for(var f=a.section.fields.length-1;f>=0;f--)a.section.fields[f].position===e&&(a.section.fields[f].position=a.section.fields[f].position+.5);a.section.fields.push(c),a.$apply(),c=null}},start:function(a,b){$(b.helper).addClass("helper"),d()},stop:function(a,b){$(b.item).removeClass("helper"),d()}})}}}),angular.module("InventoryEditLabelComponentModule",[]).directive("inventoryEditLabel",["$timeout","$rootScope",function(a,b){return{restrict:"A",link:function(c,d,e){c.editLabel=function(){"section"===e.inventoryEditLabel?(c.label=angular.copy(c.section.title),c.editingSectionLabel=!0):(c.label=angular.copy(c.field.label),c.editingLabel=!0),a(function(){d.find(".editLabelField").focus()})},c.saveLabel=function(){return 0===c.label.length?void b.showMessage("exclamation-sign","Você não pode deixar o título do campo em branco.","error"):void("section"===e.inventoryEditLabel?(c.section.title=c.label,c.editingSectionLabel=!1):(c.field.label=c.label,c.editingLabel=!1))},d.find(".editLabelField").keyup(function(a){13===a.keyCode&&(c.saveLabel(),c.$apply()),27===a.keyCode&&("section"===e.inventoryEditLabel?c.editingSectionLabel=!1:c.editingLabel=!1,c.$apply())})}}}]),angular.module("InventoryEditSectionComponentModule",[]).directive("inventoryEditSection",function(){return{restrict:"A",link:function(a){a.$watch("section.permissions",function(b,c){if(b!==c)for(var d=_.difference(c.groups_can_edit,b.groups_can_edit),e=_.difference(b.groups_can_edit,c.groups_can_edit),f=_.difference(c.groups_can_view,b.groups_can_view),g=_.difference(b.groups_can_view,c.groups_can_view),h=a.section.fields.length-1;h>=0;h--)e&&(a.section.fields[h].permissions.groups_can_edit=_.union(a.section.fields[h].permissions.groups_can_edit,e)),g&&(a.section.fields[h].permissions.groups_can_view=_.union(a.section.fields[h].permissions.groups_can_view,g)),d&&(a.section.fields[h].permissions.groups_can_edit=_.difference(a.section.fields[h].permissions.groups_can_edit,d)),f&&(a.section.fields[h].permissions.groups_can_view=_.difference(a.section.fields[h].permissions.groups_can_view,f))},!0)}}}),angular.module("InventoryCreateValueComponentModule",[]).directive("InventoryCreateValue",function(){return{restrict:"A",link:function(a){var b=1;a.newValue=function(){a.field.available_values.push("Nova opção "+b),
b++}}}}),angular.module("InventoryPopoverComponentModule",[]).directive("inventoryPopover",function(){return{restrict:"A",link:function(a){a.popover={permissions:!1,options:!1,remove:!1},a.$on("hideOpenPopovers",function(){for(var b in a.popover)a.popover[b]===!0&&(a.popover[b]=!1)})}}}),angular.module("InventoryPopoverLinkComponentModule",[]).directive("inventoryPopoverLink",function(){return{restrict:"A",link:function(a){a.openPopover=function(b){a.$emit("hidePopovers",!0),a.popover[b]=!0}}}}),angular.module("InventoryTriggerConditionComponentModule",[]).directive("inventoryTriggerCondition",["Restangular",function(a){return{restrict:"A",scope:{category:"="},link:function(a){a.$parent.$watch("condition.inventory_field_id",function(){_.each(a.category.sections,function(b){var c=_.findWhere(b.fields,{id:parseInt(a.$parent.condition.inventory_field_id,10)});return _.isUndefined(c)?void 0:void(a.$parent.condition.field=c)})})}}}]),angular.module("InventoryTriggerComponentModule",[]).directive("inventoryTrigger",["Restangular",function(a){return{restrict:"A",link:function(b){b.trigger.isNew===!0&&(b.editing=!0),b.types=[{id:"equal_to",name:"Igual"},{id:"different",name:"Diferente"},{id:"greater_than",name:"Maior"},{id:"lesser_than",name:"Menor"},{id:"includes",name:"Inclui"},{id:"between",name:"Entre"}],b.removeTrigger=function(){if(b.trigger.isNew!==!0){b.processingForm=!0;var c=a.one("inventory").one("categories",b.$parent.category.id).one("formulas",b.trigger.id).remove();c.then(function(){b.$parent.triggers.splice(b.$parent.triggers.indexOf(b.trigger),1),b.processingForm=!1})}else b.$parent.triggers.splice(b.$parent.triggers.indexOf(b.trigger),1)},b.newCondition=function(){b.trigger.conditions.push({inventory_field_id:null,operator:"equal_to",content:null})},b.removeCondition=function(a){a._destroy=!0},b.saveTrigger=function(){b.processingForm=!0;for(var c=[],d=b.trigger.conditions.length-1;d>=0;d--){var e=b.trigger.conditions[d],f={inventory_field_id:e.inventory_field_id,operator:e.operator,content:e.content};_.isUndefined(e.id)||(f.id=e.id),_.isUndefined(e._destroy)||1!=e._destroy||(f._destroy=!0),c.push(f)}var g,h={inventory_status_id:b.trigger.inventory_status_id,conditions:c,groups_to_alert:[],run_formula:b.trigger.run_formula},i=a.one("inventory").one("categories",b.$parent.category.id);g=b.trigger.isNew===!0?i.post("formulas",h):i.one("formulas",b.trigger.id).customPUT(h),g.then(function(){b.showMessage("ok","O gatilho foi atualizado com sucesso!","success"),b.processingForm=!1})}}}}]),angular.module("InventorySortableSectionsComponentModule",[]).directive("inventorySortableSections",function(){return{restrict:"A",link:function(a,b){var c=function(){b.find(".section").each(function(){$(this).scope().section.position=$(this).index()}),a.$apply()};b.sortable({revert:!0,handle:".handle",forcePlaceholderSize:!1,placeholder:{element:function(){return $('<div class="customSortablePlaceholder"><p>Solte para re-ordenar</p></div>')},update:function(){}},start:function(a,b){$(b.helper).addClass("helper"),c()},stop:function(a,b){$(b.item).removeClass("helper"),c()}})}}}),angular.module("InventorySingleValueComponentModule",[]).directive("inventorySingleValue",["Restangular",function(a){return{restrict:"A",link:function(b){b.newValue=angular.copy(b.option.value),b.saveOption=function(){if(b.editingValue=!1,b.isExistingField){b.updating=!0;var c=a.all("inventory").one("fields",b.field.id).one("options",b.option.id).customPUT({value:b.newValue});c.then(function(){b.updating=!1})}b.option.value=b.newValue},b.removeOption=function(){var c=b.$parent.field.field_options.indexOf(b.option);if(b.isExistingField){b.updating=!0;var d=a.all("inventory").one("fields",b.field.id).one("options",b.option.id).remove();d.then(function(){b.updating=!1})}-1!==c&&(b.option.disabled=!0)}}}}]),angular.module("GalleryComponentModule",["GalleryModalControllerModule"]).directive("gallery",function(){return{restrict:"E",templateUrl:"components/gallery/gallery.template.html",scope:{images:"="},replace:!0,controller:["$scope","$modal",function(a,b){a.show=function(a){b.open({templateUrl:"modals/gallery/gallery.template.html",windowClass:"gallery-modal",controller:"GalleryModalController",resolve:{image:function(){return a}}})}}]}}),angular.module("FeatureFlagComponentModule",[]).directive("featureFlag",["Restangular",function(a){return{restrict:"A",link:function(b,c){b.$watch("flag.enabled",function(c,d){if(c!==d){b.loading=!0;var e=a.one("feature_flags",b.flag.id).customPUT({status:b.flag.enabled===!0?1:0});e.then(function(){b.loading=!1})}})}}}]),angular.module("GenericInputComponentModule",[]).directive("genericInput",function(){return{restrict:"A",link:function(a,b){a.$watch("inputErrors",function(){var c=a.inputErrors,d=$(b).closest(".form-group");if(b.removeClass("has-error"),d.removeClass("has-error"),"undefined"!=typeof c)for(var e in c)e===b.attr("name")&&(b.addClass("has-error"),d.addClass("has-error"))}),a.$parent.$watch("processingForm",function(){a.$parent.processingForm===!0?b.attr("disabled",!0):b.attr("disabled",!1)})}}}),angular.module("KeyboardPosterComponentModule",[]).directive("keyboardPoster",["$parse","$timeout",function(a,b){var c=700;return function(d,e,f){var g=angular.element(e)[0],h=null;g.onkeydown=function(){var g=a(f.keyboardPoster),i=g(d);h&&b.cancel(h),h=b(function(){i(e.val())},c)}}}]),angular.module("DetectScrollTopComponentModule",[]).directive("detectScrollTop",function(){return{restrict:"A",link:function(a,b){a.$watch("scrollTop",function(){a.scrollTop===!0&&(b.animate({scrollTop:0},900),a.scrollTop=!1)})}}}),angular.module("MapNewReportComponentModule",[]).directive("mapNewReport",["$compile","$timeout","Restangular","FullResponseRestangular","ENV","$filter",function(a,b,c,d,e,f){var g=new google.maps.Geocoder;return{restrict:"A",link:function(a,h,i){var j=parseInt(e.mapZoom);""!=a.address.address&&(j=16);var k={options:{styles:[{},{featureType:"poi.business",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.government",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.medical",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.place_of_worship",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.school",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.sports_complex",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"labels",stylers:[{visibility:"off"},{saturation:-100},{lightness:42}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{saturation:-100},{lightness:47}]},{featureType:"landscape",stylers:[{lightness:82},{saturation:-100}]},{featureType:"water",stylers:[{hue:"#00b2ff"},{saturation:-21},{lightness:-4}]},{featureType:"poi",stylers:[{lightness:19},{weight:.1},{saturation:-22}]},{elementType:"geometry.fill",stylers:[{visibility:"on"},{lightness:18}]},{elementType:"labels.text",stylers:[{saturation:-100},{lightness:28}]},{featureType:"poi.attraction",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{saturation:12},{lightness:25}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels.text",stylers:[{lightness:30}]},{featureType:"landscape.man_made",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{saturation:-100},{lightness:56}]},{featureType:"road.local",elementType:"geometry.fill",stylers:[{lightness:62}]},{featureType:"landscape.man_made",elementType:"geometry",stylers:[{visibility:"off"}]}],homeLatlng:new google.maps.LatLng(e.mapLat,e.mapLng),map:{zoom:j,mapTypeControl:!1,panControl:!0,panControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER},zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER},scaleControl:!0,scaleControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER},streetViewControl:!0,streetViewControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER}}},zoomLevels:{},currentZoom:parseInt(e.mapZoom),map:null,getNewItemsTimeout:null,hideNotVisibleMarkersTimeout:null,doAnimation:!0,activeMethod:"reports",activeInventoryFilters:[],hiddenReportsCategories:[],hiddenInventoryCategories:[],mainMarker:null,allows_arbitrary_position:!0,bindsToInventoryCategories:!1,start:function(){this.createMap(),this.setListeners()},createMap:function(){this.zoomLevels={},this.currentZoom=11;var b=new google.maps.StyledMapType(this.options.styles,{name:"zup"});this.map=new google.maps.Map(h[0],this.options.map),this.map.mapTypes.set("zup",b),this.map.setMapTypeId("zup"),this.map.setCenter(this.options.homeLatlng),setTimeout(function(){google.maps.event.trigger(k.map,"resize"),google.maps.event.trigger(k.map,"bounds_changed"),k.map.setCenter(k.options.homeLatlng),a.lat||a.lng||k.checkMarkerInsideAllowedBounds(k.options.homeLatlng.lat(),k.options.homeLatlng.lng())},80)},setListeners:function(){a.$on("addressChanged",function(b,c){if(c){var d=new google.maps.LatLng(a.lat,a.lng);k.mainMarker.setPosition(d),k.map.setCenter(d)}else{var e=a.address.address+", "+a.address.number;a.address.district&&(e+=", "+a.address.district),a.address.city&&(e+=", "+a.address.city),g.geocode({address:e,region:"BR"},function(b,c){c===google.maps.GeocoderStatus.OK&&b.length>0&&(k.mainMarker.setPosition(b[0].geometry.location),k.map.setCenter(b[0].geometry.location),a.lat=a.$parent.lat=k.mainMarker.getPosition().lat(),a.lng=a.$parent.lng=k.mainMarker.getPosition().lng(),k.checkMarkerInsideAllowedBounds(a.$parent.lat,a.$parent.lng))})}}),a.$watch("categoryData",function(){a.categoryData&&(this.bindsToInventoryCategories="undefined"!=typeof a.categoryData.inventory_categories,k.createMap(),setTimeout(function(){var b;if(b=a.lat&&a.lng?new google.maps.LatLng(a.lat,a.lng):k.options.homeLatlng,google.maps.event.trigger(k.map,"resize"),google.maps.event.trigger(k.map,"bounds_changed"),k.map.setCenter(b),a.$emit("reportMap:position_changed",b),a.categoryData)if(this.bindsToInventoryCategories)google.maps.event.addListener(k.map,"bounds_changed",function(){k.boundsChanged()}),google.maps.event.trigger(k.map,"bounds_changed"),k.allows_arbitrary_position=!1,k.mainMarker=null,a.$apply();else{var c=new google.maps.MarkerImage(a.categoryData.marker.retina.web,null,null,null,new google.maps.Size(54,51)),d=new google.maps.Marker({map:k.map,draggable:!0,animation:google.maps.Animation.DROP,position:b,icon:c});k.mainMarker=d,k.allows_arbitrary_position=!0,a.$apply(),google.maps.event.addListener(d,"dragend",function(){a.markerPositionUpdated=!0,a.lat=a.$parent.lat=k.mainMarker.getPosition().lat(),a.lng=a.$parent.lng=k.mainMarker.getPosition().lng(),k.checkMarkerInsideAllowedBounds(a.$parent.lat,a.$parent.lng),a.$emit("reportMap:position_changed",new google.maps.LatLng(a.lat,a.lng)),a.$apply(),a.$parent.$apply()})}a.itemId=null,a.formattedAddress=null,a.$apply()},80))}),a.updateMarkerAddress=function(){k.changedMarkerPosition(k.mainMarker.getPosition().lat(),k.mainMarker.getPosition().lng()),a.markerPositionUpdated=!1}},changedMarkerPosition:function(b,c,d,e){"undefined"==typeof d?(a.lat=b,a.lng=c):a.itemId=d,(_.isUndefined(e)||!e)&&g.geocode({latLng:new google.maps.LatLng(b,c)},function(b,c){if(c===google.maps.GeocoderStatus.OK){var d=f("filterGoogleAddressComponents")(b[0].address_components);-1!==d.number.indexOf("-")&&(d.number=d.number.split("-")[0]),a.address.address=d.address,a.address.number=parseInt(d.number,10),a.address.district=d.neighborhood,a.address.city=d.city,a.address.state=d.state,a.address.country=d.country,a.address.postal_code=d.zipcode,a.$apply()}})},checkMarkerInsideAllowedBounds:function(b,c){var e=d.all("utils").all("city-boundary").customGET("validate",{longitude:c,latitude:b});e.then(function(b){b.data.inside_boundaries===!1?a.markerOutOfBounds=!0:a.markerOutOfBounds=!1})},boundsChanged:function(d){var e=!1;"undefined"==typeof this.zoomLevels[this.map.getZoom()]&&(this.zoomLevels[this.map.getZoom()]={}),this.currentZoom!==this.map.getZoom()&&(e=!0,this.currentZoom=this.map.getZoom()),this.hideNotVisibleMarkersTimeout&&b.cancel(this.hideNotVisibleMarkersTimeout),this.hideNotVisibleMarkersTimeout=b(function(){k.hideNotVisibleMarkers()},200),this.bindsToInventoryCategories&&(this.getNewItemsTimeout&&b.cancel(this.getNewItemsTimeout),a.isLoadingItems=!0,this.getNewItemsTimeout=b(function(){for(var b=[],f=a.categoryData.inventory_categories.length-1;f>=0;f--)b.push(a.categoryData.inventory_categories[f].id);var g=c.all("inventory").all("items").getList({"position[latitude]":k.map.getCenter().lat(),"position[longitude]":k.map.getCenter().lng(),"position[distance]":k.getDistance(),zoom:k.map.getZoom(),limit:100,inventory_category_id:b.join()});g.then(function(b){a.isLoadingItems=!1,d===!0&&k.removeAllMarkers(),e&&k.hideAllMarkersFromInactiveLevels();for(var c=b.data.length-1;c>=0;c--)k.addMarker(b.data[c],k.doAnimation);k.doAnimation===!0&&(k.doAnimation=!1)})},1e3))},hideNotVisibleMarkers:function(){angular.forEach(this.zoomLevels[this.map.getZoom()],function(a,b){if(k.isMarkerInsideBounds(a)){var c;"report"===a.type&&(c=k.hiddenReportsCategories.indexOf(a.item.category_id)),"item"===a.type&&(c=k.hiddenInventoryCategories.indexOf(a.item.inventory_category_id)),~c||a.setVisible(!0)}else a.setVisible(!1)})},hideAllMarkersFromInactiveLevels:function(){angular.forEach(this.zoomLevels,function(a,b){console.log(b,k.currentZoom),b!=k.currentZoom&&angular.forEach(a,function(a,b){a.setVisible(!1)})})},isMarkerInsideBounds:function(a){return this.map.getBounds().contains(a.getPosition())},addMarker:function(b,c,d){if("undefined"==typeof this.zoomLevels[this.map.getZoom()][d+"_"+b.id]){var e=new google.maps.LatLng(b.position.latitude,b.position.longitude),f=(new google.maps.InfoWindow,a.getInventoryCategory(b.inventory_category_id)),g=new google.maps.Size(15,15),h=(a.viewItem,"item"),i=(k.hiddenInventoryCategories.indexOf(b.inventory_category_id),new google.maps.MarkerImage(f.pin.retina.web,null,null,null,g)),j={position:e,map:this.map,icon:i,category:f,item:b,type:h};"undefined"!=typeof c&&c===!0&&(j.animation=google.maps.Animation.DROP);var l=new google.maps.Marker(j);this.zoomLevels[this.map.getZoom()][d+"_"+b.id]=l,google.maps.event.addListener(l,"click",function(){var b=new google.maps.LatLng(this.item.position.latitude,this.item.position.longitude);if(k.changedMarkerPosition(this.item.position.latitude,this.item.position.longitude,this.item.id),null===k.mainMarker){var c=new google.maps.MarkerImage(a.categoryData.marker.retina.web,null,null,null,new google.maps.Size(54,51)),d=new google.maps.Marker({map:k.map,animation:google.maps.Animation.DROP,position:b,icon:c});k.mainMarker=d}else k.mainMarker.setPosition(b)})}},getDistance:function(){var a=this.map.getBounds(),b=a.getCenter(),c=a.getNorthEast(),d=google.maps.geometry.spherical.computeDistanceBetween(b,c);return d}};k.start(),a.mapProvider=k}}}]),angular.module("ReportStatusComponentModule",[]).directive("reportStatus",function(){return{restrict:"A",link:function(a){a.$parent.$parent.updating===!0&&a.$watch("status",function(b,c){b!==c&&(a.$parent.$parent.updateStatuses[c.id]=a.status)},!0)}}}),angular.module("ReportSearchMapComponentModule",["FilterGoogleAddressComponentsHelperModule"]).directive("reportSearchMap",["$timeout","$filter","$rootScope",function(a,b,c){return{restrict:"A",link:function(d,e){d.$watch("mapProvider",function(){if("undefined"!=typeof d.mapProvider){google.maps.event.clearListeners(d.mapProvider.map);var f={types:["address"],componentRestrictions:{country:"br"}},g=new google.maps.places.Autocomplete(e[0],f);g.bindTo("bounds",d.mapProvider.map);var h,i=function(b,c){c!=google.maps.places.PlacesServiceStatus.OK&&a(function(){d.showLoadingForAutocompleteRequest=!1})},j=new google.maps.places.AutocompleteService;d.showLoading=function(){d.showLoadingForAutocompleteRequest=!0,h||(h=a(function(){j.getQueryPredictions({input:e[0]},i),h=void 0},400))},google.maps.event.addListener(g,"place_changed",function(){var a=g.getPlace();if(a.geometry){c.$broadcast("reports:position-updated",a.geometry.location);var e=b("filterGoogleAddressComponents")(a.address_components);d.$apply(function(){d.address.address=e.address,d.address.number=parseInt(e.number,10),d.address.reference="",d.address.district=e.neighborhood,e.city&&(d.address.city=e.city),e.state&&(d.address.state=e.state),e.country&&(d.address.country=e.country)});var f=new google.maps.Geocoder;if(f.geocode({latLng:a.geometry.location},function(a,c){if(c===google.maps.GeocoderStatus.OK){var e=b("filterGoogleAddressComponents")(a[0].address_components);d.$apply(function(){d.address.postal_code=e.zipcode})}}),a.geometry.viewport?d.mapProvider.map.fitBounds(a.geometry.viewport):(d.mapProvider.map.setCenter(a.geometry.location),d.mapProvider.map.setZoom(17)),1==d.mapProvider.allows_arbitrary_position)d.mapProvider.mainMarker.setPosition(a.geometry.location),d.mapProvider.changedMarkerPosition(a.geometry.location.lat(),a.geometry.location.lng(),void 0,!0),d.mapProvider.checkMarkerInsideAllowedBounds(d.mapProvider.mainMarker.getPosition().lat(),d.mapProvider.mainMarker.getPosition().lng());else{var h=new google.maps.Marker({map:d.mapProvider.map,position:a.geometry.location});h.setIcon({url:a.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(35,35)})}}})}})}}}]),angular.module("GalleryImageOnLoadComponentModule",[]).directive("galleryImageOnLoad",["$window",function(a){return{restrict:"A",link:function(a,b,c){b.bind("load",function(){a.$apply(function(){a.loading=!1,a.$parent.imageDimensions={width:b.width(),height:b.height()}})})}}}]),angular.module("CopyTextComponentModule",[]).directive("copyText",function(){return{link:function(a,b){b.find(".form-control").on("click",function(){this.select()});var c=new ZeroClipboard(b.find(".btn-custom"));c.on("ready",function(){c.on("aftercopy",function(){b.find(".form-control").select(),b.addClass("has-success"),a.copied=!0,a.$apply()})})}}}),angular.module("FlowsCreateValueComponentModule",[]).directive("flowsCreateValue",function(){return{restrict:"A",link:function(a){a.newValue=function(){a.field.values[0]="Nova opção"}}}}),angular.module("FlowsDroppableInputsAreaComponentModule",[]).directive("flowsDroppableInputsArea",["Restangular","$timeout",function(a,b){return{restrict:"A",link:function(b,c){var d=null;b.updateFieldsOrder=function(){for(var c=[],d=!1,e=b.fields.length-1;e>=0;e--)"undefined"!=typeof b.fields[e].id&&(c[b.fields[e].position]=b.fields[e].id);for(var e=c.length-1;e>=0;e--)"undefined"==typeof c[e]&&(d=!0);d||0!==c.length&&a.one("flows",b.flow.id).one("steps",b.step.id).all("fields").customPUT({ids:c})};var e=function(a){c.find(".input").each(function(){$(this).scope().field.position=$(this).index()}),b.$apply(),a===!0&&b.updateFieldsOrder()};c.sortable({revert:!0,handle:".handle",forcePlaceholderSize:!1,placeholder:{element:function(){return $('<div class="customSortablePlaceholder"><p>Solte para adicionar</p></div>')},update:function(){}},receive:function(a,c){var e=c.item.attr("name"),f={field_type:e,title:"Novo "+e,maximum:null,minimum:null,presence:!1,position:null};b.kindHasMultipleOptions(e)===!0&&(f.values={0:"Novo item"}),d=f},update:function(a,c){var e=$(c.item).index();if(null!==d){$(this).find(".item").remove(),d.position=e;for(var f=b.fields.length-1;f>=0;f--)b.fields[f].position===e&&(b.fields[f].position=b.fields[f].position+.5);b.fields.push(d),b.$apply(),d=null}},start:function(a,b){$(b.helper).addClass("helper"),e()},stop:function(a,b){$(b.item).removeClass("helper"),e(!0)}})}}}]),angular.module("FlowsResolutionStateComponentModule",[]).directive("flowsResolutionState",["Restangular",function(a){return{restrict:"A",link:function(b){b.saveTitle=function(){var c=a.one("flows",b.flow.id).one("resolution_states",b.state.id).customPUT({title:b.state.title});c.then(function(){b.editTitle=!1})},b.changeDefaultState=function(){var c=a.one("flows",b.flow.id).one("resolution_states",b.state.id).customPUT({title:b.state.title,"default":b.state["default"]});c.then(function(){})},b.removeState=function(){var c=a.one("flows",b.flow.id).one("resolution_states",b.state.id).remove();c.then(function(){b.$parent.$parent.flow.resolution_states.splice(b.$parent.$parent.flow.resolution_states.indexOf(b.state),1),b.showRemoveState=!1})}}}}]),angular.module("FlowsSingleValueComponentModule",[]).directive("flowsSingleValue",function(){return{restrict:"A",link:function(a){a.editValue=angular.copy(a.value),a.saveValue=function(){a.editingValue=!1;var b=a.$parent.field.available_values.indexOf(a.value);a.$parent.field.available_values[b]=a.editValue},a.removeValue=function(b){var c=a.$parent.field.available_values.indexOf(b);-1!==c&&a.$parent.field.available_values.splice(c,1)}}}}),angular.module("FlowsStepFieldComponentModule",[]).directive("flowsStepField",["Restangular",function(a){return{restrict:"A",link:function(b,c){if("undefined"!=typeof b.field.id)b.field.position=b.field.order_number-1;else{b.savingField=!0;var d=a.one("flows",b.flow.id).one("steps",b.step.id).post("fields",b.field);d.then(function(a){b.field.id=a.data.id,b.savingField=!1,b.updateFieldsOrder()})}var e=function(){return a.one("flows",b.flow.id).one("steps",b.step.id).one("fields",b.field.id).customPUT(b.field)};b.saveTitle=function(){e(),b.editingLabel=!1},b.saveField=function(){e(),b.popover.options=!1},b.removeField=function(){b.field.remove(),b.field.destroy=!0}}}}]),angular.module("FlowsStepsOrderComponentModule",[]).directive("flowsStepsOrder",["Restangular","$timeout",function(a,b){return{restrict:"A",link:function(b,c){b.updateFieldsOrder=function(){for(var c=[],d=!1,e=b.flow.steps.length-1;e>=0;e--)"undefined"!=typeof b.flow.steps[e].id&&(c[b.flow.steps[e].position]=b.flow.steps[e].id);for(var e=c.length-1;e>=0;e--)"undefined"==typeof c[e]&&(d=!0);d||a.one("flows",b.flow.id).all("steps").customPUT({ids:c})};var d=function(a){c.find("tbody").each(function(){"undefined"!=typeof $(this).scope().step&&($(this).scope().step.position=$(this).index())}),b.$apply(),a===!0&&b.updateFieldsOrder()};c.sortable({revert:!0,handle:".handle",forcePlaceholderSize:!1,placeholder:{element:function(){return $('<tbody><tr><td colspan="3">Solte para ordenar</td></tr></tbody>')},update:function(){}},start:function(a,b){$(b.helper).addClass("helper"),d()},stop:function(a,b){$(b.item).removeClass("helper"),d(!0)}})}}}]),angular.module("FlowsTriggerComponentModule",[]).directive("flowsTrigger",["Restangular",function(a){return{restrict:"A",link:function(b){b.trigger.isNew===!0&&(b.editing=!0),b.types=[{id:"==",name:"Igual"},{id:"!=",name:"Diferente"},{id:">",name:"Maior"},{id:"<",name:"Menor"},{id:"inc",name:"Entre valores"}],b.removeTrigger=function(){if(b.trigger.isNew!==!0){b.processingForm=!0;var c=a.one("flows",b.$parent.flow.id).one("steps",b.$parent.step.id).one("triggers",b.trigger.id).remove();c.then(function(){b.$parent.triggers.splice(b.$parent.triggers.indexOf(b.trigger),1),b.processingForm=!1})}else b.$parent.triggers.splice(b.$parent.triggers.indexOf(b.trigger),1)},b.newCondition=function(){b.trigger.trigger_conditions.push({field:{},condition_type:"==",values:[]})},b.removeCondition=function(c){if("number"==typeof c.id){b.processingForm=!0;var d=a.one("flows",b.$parent.flow.id).one("steps",b.$parent.step.id).one("triggers",b.trigger.id).one("trigger_conditions",c.id).remove();d.then(function(){b.trigger.trigger_conditions.splice(b.trigger.trigger_conditions.indexOf(c),1),b.processingForm=!1})}else b.trigger.trigger_conditions.splice(b.trigger.trigger_conditions.indexOf(c),1)},b.saveTrigger=function(){b.processingForm=!0;for(var c=[],d=b.trigger.trigger_conditions.length-1;d>=0;d--){var e={field_id:b.trigger.trigger_conditions[d].field.id,condition_type:b.trigger.trigger_conditions[d].condition_type,values:b.trigger.trigger_conditions[d].values};"undefined"!=typeof b.trigger.trigger_conditions[d].id&&(e.id=b.trigger.trigger_conditions[d].id),c.push(e)}var f,g={title:b.trigger.title,trigger_conditions_attributes:c,action_type:b.trigger.action_type,action_values:b.trigger.action_values,description:b.trigger.description},h=a.one("flows",b.$parent.flow.id).one("steps",b.$parent.step.id);f=b.trigger.isNew===!0?h.post("triggers",g):h.one("triggers",b.trigger.id).customPUT(g),f.then(function(){b.showMessage("ok","O gatilho foi atualizado com sucesso!","success"),b.processingForm=!1})}}}}]),angular.module("FlowsDraggableInputComponentModule",[]).directive("flowsDraggableInput",function(){return{restrict:"A",link:function(a,b){b.draggable({connectToSortable:".droppableInputsArea",revert:"invalid",helper:function(){return $('<div class="customDraggableHelper">'+b.find("p").html()+"</div>")},start:function(a,b){$(b.helper).css("width","auto").css("height","auto")}})}}}),angular.module("SlideComponent",[]).animation(".slide",function(){var a="ng-hide";return{beforeAddClass:function(b,c,d){c===a&&b.slideUp(d)},removeClass:function(b,c,d){c===a&&b.hide().slideDown(d)}}}),angular.module("ZupTranscludeComponentModule",[]).directive("zupTransclude",function(){return{compile:function(a,b,c){return function(a,b){c(a.$new(),function(a){b.append(a)})}}}}),angular.module("MultipleSelectListComponentModule",[]).directive("multipleSelectList",function(){return{restrict:"E",templateUrl:"components/multiple-select-list/multiple-select-list.template.html",transclude:!0,scope:{ngModel:"=",singularObjectName:"@",pluralObjectName:"@"},replace:!0,controller:["$scope",function(a){a.selectAll=function(b,c){for(var d=b.length-1;d>=0;d--){for(var e=!1,f=0;f<a.ngModel.length;f++)a.ngModel[f]==b[d][c]&&(e=!0);e||a.ngModel.push(b[d][c])}},_.isArray(a.ngModel)||(a.ngModel=[]),a.getExcerpt=function(){switch(a.ngModel.length){case 0:return"Selecione uma "+(_.isUndefined(a.singularObjectName)?"categoria":a.singularObjectName);case 1:return"1 "+(_.isUndefined(a.singularObjectName)?"categoria":a.singularObjectName)+" selecionado";default:return a.ngModel.length+" "+(_.isUndefined(a.pluralObjectName)?"categorias":a.pluralObjectName)+" selecionadas"}},a.toggle=function(b){var c=a.ngModel.indexOf(b);return~c?void a.ngModel.splice(c,1):void a.ngModel.push(b)},a.isSelected=function(b){var c=a.ngModel.indexOf(b);return~c?!0:!1}}]}}),angular.module("SelectListComponentModule",[]).directive("selectList",["$document",function(a){return{restrict:"E",templateUrl:"components/select-list/select-list.template.html",transclude:!0,scope:{ngModel:"=",optionName:"@"},replace:!0,controller:["$scope",function(a){a.getExcerpt=function(){return a.title?a.title:"Selecione uma categoria"},a.select=function(b,c){a.ngModel=b,a.title=c[a.optionName],a.show=!1,a.$emit("optionSelected",c)},a.isSelected=function(b){return b===a.ngModel?!0:!1}}],link:function(b,c,d){var e=function(d){$(d.target).closest(c).length||(b.show=!1,b.$apply(),angular.element(a).off("click",e))};b.toggleList=function(){b.show=!b.show,b.show?angular.element(a).on("click",e):angular.element(a).off("click",e)},b.$on("$destroy",function(){angular.element(a).off("click",e)})}}}]),angular.module("ReportCategorySelectorDirectiveModule",["DiacriticsInsensitiveFilterHelperModule","SelectListComponentModule","ReportsCategoriesServiceModule"]).directive("reportCategorySelector",["ReportsCategoriesService","$document","$timeout",function(a,b,c){return{restrict:"E",scope:{onCategorySelect:"&",title:"="},templateUrl:"components/report-category-selector/report-category-selector.template.html",controllerAs:"reportCategorySelectorCtrl",controller:["$scope",function(b){b.getExcerpt=function(){return b.title?b.title:"Selecione uma categoria"},b.select=function(a){b.onCategorySelect({category:a}),b.show=!1},b.loadingReportCategories=!0,b.errorLoadingReportCategories=!1,a.fetchTitlesAndIds().then(function(a){b.categories=a,b.loadingReportCategories=!1},function(){b.loadingReportCategories=!1,b.errorLoadingReportCategories=!0})}],link:function(a,c){var d=function(e){$(e.target).closest(c).length||(a.show=!1,a.$apply(),angular.element(b).off("click",d))};a.toggleList=function(){a.show=!a.show,a.show?angular.element(b).on("click",d):angular.element(b).off("click",d)},a.$on("$destroy",function(){angular.element(b).off("click",d)})}}}]),angular.module("BusinessReportsDestroyModalModule",["BusinessReportsServiceModule","FocusIfComponentModule"]).controller("BusinessReportsDestroyModalController",["$rootScope","$modal","$scope","Restangular","BusinessReportsService","$modalInstance","report","promise","$log",function(a,b,c,d,e,f,g,h,i){i.info("ReportsDestroyModalController created."),c.$on("$destroy",function(){i.info("ReportsDestroyModalController destroyed.")}),c.report=g,c.confirm=function(){var a=e.remove(c.report.id);c.deleting=!0,a.then(function(){f.close(),c.deleting=!1,c.showMessage("ok","O Relatório "+c.report.title+" foi removido com sucesso","success",!0),h.resolve(g)},function(){c.deleting=!1,c.showMessage("exclamation-sign"," Não foi possível remover o relatório "+c.report.title+". Por favor, tente novamente em alguns minutos.","error",!0),f.close(),h.reject(g)})},c.close=function(){f.close()}}]).factory("BusinessReportDestroyModalService",["$modal","$q",function(a,b){return{open:function(c){var d=b.defer();return a.open({templateUrl:"modals/business-reports/destroy/business-reports-destroy.template.html",windowClass:"businessReportDestroyModal",resolve:{report:function(){return c},promise:function(){return d}},controller:"BusinessReportsDestroyModalController"}),d.promise}}}]),angular.module("BusinessReportsEditChartModalModule",["ReportCategorySelectorDirectiveModule"]).controller("BusinessReportsEditChartModalController",["$modal","$scope","ReportsCategoriesService","$modalInstance","promise","chart",function(a,b,c,d,e,f){b.chartTypes=[{type:"BarChart",title:"Barra"},{type:"PieChart",title:"Pizza"},{type:"AreaChart",title:"Área"},{type:"LineChart",title:"Linha"}],b.metricTypes=[{metric:"total-reports-by-category",title:"Total de relatos criados por categoria"},{metric:"total-reports-by-status",title:"Total de relatos por estado"},{metric:"total-reports-overdue-by-category",title:"Total de relatos atrasados por categoria"},{metric:"total-reports-overdue-by-category-per-day",title:"Total de relatos atrasados por quantidade de dias em atraso"},{metric:"total-reports-assigned-by-category",title:"Total de relatos delegados por categoria"},{metric:"total-reports-assigned-by-group",title:"Total de relatos que foram associados, por grupo"},{metric:"total-reports-unassigned-to-user",title:"Total de relatos que não foram delegados à nenhum usuário"},{metric:"average-resolution-time-by-category",title:"Média de tempo de resolução por categoria"},{metric:"average-resolution-time-by-group",title:"Média de tempo de resolução por grupo associado"},{metric:"average-overdue-time-by-category",title:"Média de atraso por categoria"},{metric:"average-overdue-time-by-group",title:"Média de tempo de atraso por grupo"}],b.chart=f,b.select2Options={minimumResultsForSearch:1/0},b.valid=function(){return b.chart.categories.length>0&&b.chart.metric&&b.chart.type},b.close=function(){e.reject(),d.close()},b.confirm=function(){e.resolve(b.chart),d.close()},b.chart.categories=b.chart.categories||[],b.selectCategory=function(a){var c=_.findWhere(b.chart.categories,{id:a.id});c||b.chart.categories.push(a)},b.removeCategory=function(a){b.chart.categories.splice(b.chart.categories.indexOf(a),1)}}]).factory("BusinessReportsEditChartModalService",["$modal","$q",function(a,b){return{open:function(c){var d=b.defer();return a.open({templateUrl:"modals/business-reports/edit-chart/business-reports-edit-chart.template.html",windowClass:"businessReportEditChartModal",resolve:{promise:function(){return d},chart:function(){return c}},controller:"BusinessReportsEditChartModalController",
controllerAs:"businessReportEditCtrl"}),d.promise}}}]),angular.module("ReportsDestroyModalControllerModule",["ReportsItemsServiceModule"]).controller("ReportsDestroyModalController",["$rootScope","$scope","Restangular","ReportsItemsService","$modalInstance","report","$log",function(a,b,c,d,e,f,g){g.info("ReportsDestroyModalController created."),b.$on("$destroy",function(){g.info("ReportsDestroyModalController destroyed.")}),b.report=f,b.confirm=function(){var c=d.remove(b.report.id);b.deleting=!0,c.then(function(){e.close(),a.$broadcast("reports:itemRemoved",b.report.id),b.deleting=!1,b.showMessage("ok","O Relato "+b.report.protocol+" foi removido com sucesso","success",!0)},function(){b.deleting=!1,b.showMessage("exclamation-sign"," Não foi possível remover o relato "+b.report.protocol+". Por favor, tente novamente em alguns minutos.","error",!0)})},b.close=function(){e.close()}}]),angular.module("ReportsEditStatusModalControllerModule",[]).controller("ReportsEditStatusModalController",["Restangular","$scope","$rootScope","$state","$modalInstance","category","report","statusesResponse",function(a,b,c,d,e,f,g,h){c.resolvingRequest=!1,b.category=f,b.report=angular.copy(g),b.category.statuses=h.data,b.report.privateComment=!0,b.changeStatus=function(a){b.report.status_id=a},b.save=function(){b.processing=!0;var c=0;b.report.privateComment&&(c=1);var f=a.one("reports",b.category.id).one("items",b.report.id).one("update_status").customPUT({status_id:b.report.status_id,comment:b.report.comment,comment_visibility:c},"?return_fields=status_id");f.then(function(){g.status_id=b.report.status_id,b.processing=!1,e.close(),b.showMessage("ok","O estado do relato foi alterado com sucesso.","success",!0),d.go(d.current,{},{reload:!0})})},b.close=function(){e.close()}}]),angular.module("ReportsEditCategoryModalControllerModule",["SelectListComponentModule"]).controller("ReportsEditCategoryModalController",["Restangular","$scope","$modalInstance","category","report","categories","$rootScope","$state",function(a,b,c,d,e,f,g,h){b.categories=f.data,g.resolvingRequest=!1,b.report=angular.copy(e),b.category=d,b.transfer={toCategory:null,toStatus:null},b.subCategories=function(a){return null==a.parent_id?"Categorias principais":null!==a.parent_id?"Subcategorias":void 0},b.$on("optionSelected",function(c,d){c.stopPropagation(),b.categoryData=d;var e=a.one("reports").one("categories",d.id).all("statuses").getList({return_fields:"id,color,title"});e.then(function(a){b.categoryData.statuses=a.data})}),b.confirm=function(){c.close(),g.resolvingRequest=!0;var d=a.one("reports",b.category.id).one("items",b.report.id).customPUT({new_category_id:b.transfer.toCategory,new_status_id:b.transfer.toStatus,return_fields:""},"change_category");d.then(function(){b.showMessage("ok","A categoria do relato foi alterada com sucesso!","success",!0),h.go(h.current,{},{reload:!0})})},b.close=function(){c.close()}}]),angular.module("ReportsSelectAddressModalControllerModule",["SelectLatLngMapComponent","SearchLatLngMapComponent"]).controller("ReportsSelectAddressModalController",["$scope","$modalInstance","$state","$rootScope","Restangular","category","report",function(a,b,c,d,e,f,g){a.updating=!0,a.category=f,a.latLng=[g.position.latitude,g.position.longitude],a.close=function(){b.close()},a.save=function(){b.close(),d.resolvingRequest=!0;var f={latitude:a.latLng[0],longitude:a.latLng[1],address:a.formattedAddress,return_fields:""},h=e.one("reports",g.category.id).one("items",g.id).customPUT(f);h.then(function(b){a.showMessage("ok","O endereço do relato foi alterado com sucesso.","success",!0),c.go(c.current,{},{reload:!0})})}}]),angular.module("ReportsForwardModalControllerModule",[]).controller("ReportsForwardModalController",["Restangular","$rootScope","$scope","$state","$modalInstance","category","report","groupsResponse",function(a,b,c,d,e,f,g,h){b.resolvingRequest=!1,c.category=f,c.report=angular.copy(g),c.groups=h.data,c.filterByIds=function(a){return g.assigned_group&&g.assigned_group.id==a.id?!1:~f.solver_groups_ids.indexOf(a.id)?!0:!1},c.save=function(){c.processing=!0;var b=a.one("reports",c.category.id).one("items",c.report.id).one("forward").customPUT({group_id:c.report.group_id,comment:c.report.comment,return_fields:""});b.then(function(){c.processing=!1,e.close(),c.showMessage("ok","O grupo responsável foi alterado com sucesso.","success",!0),d.go(d.current,{},{reload:!0})})},c.close=function(){e.close()}}]),angular.module("ReportsEditReferenceModalControllerModule",[]).controller("ReportsEditReferenceModalController",["Restangular","$scope","$modalInstance","report",function(a,b,c,d){b.report=angular.copy(d),b.save=function(){b.processingForm=!0;var e=a.one("reports",d.category.id).one("items",d.id).customPUT({reference:b.report.reference,return_fields:"reference"});e.then(function(a){c.close(),b.processingForm=!1,d.reference=b.report.reference},function(a){b.processingForm=!1})},b.close=function(){c.close()}}]),angular.module("ReportsPrintModalControllerModule",[]).controller("ReportsPrintModalController",["$scope","$modalInstance","openModal",function(a,b,c){a.selectedSections=[],a.sections=[{name:"Dados do relato",key:"fields"},{name:"Fotos do relato",key:"images"},{name:"Mapa com localização do relato",key:"map"},{name:"Informações do munícipe",key:"user"},{name:"Respostas ao munícipe",key:"replies"},{name:"Observações internas",key:"comments"},{name:"Histórico do relato",key:"history"},{name:"Feedback do usuário",key:"feedback"}],a.toggleAll=function(){return a.allSelected()?void(a.selectedSections=[]):void _.each(a.sections,function(b){a.isActive(b)||a.selectedSections.push(b.key)})},a.allSelected=function(){return a.sections.length===a.selectedSections.length},a.isActive=function(b){return-1!==a.selectedSections.indexOf(b.key)},a.toggle=function(b){var c=a.selectedSections.indexOf(b.key);-1===c?a.selectedSections.push(b.key):a.selectedSections.splice(c,1)},a.confirm=function(){c(a.selectedSections),b.close()},a.close=function(){b.close()}}]),angular.module("AdvancedFiltersAreaModalControllerModule",["AreaMapComponentModule","AddAreaCircleFormComponentModule","ReplaceDotWithCommaHelperModule"]).controller("AdvancedFiltersAreaModalController",["$scope","$modalInstance","activeAdvancedFilters",function(a,b,c){a.activeAdvancedFilters=c,a.save=function(){for(var c=a.circles.length-1;c>=0;c--){var d={title:"Perímetro",type:"area",desc:a.circles[c].get("distance").toFixed(2).replace(".",",")+"km de "+a.circles[c].get("position").lat().toFixed(4)+", "+a.circles[c].get("position").lng().toFixed(4),value:{latitude:a.circles[c].get("position").lat(),longitude:a.circles[c].get("position").lng(),distance:1e3*a.circles[c].get("distance")}};a.activeAdvancedFilters.push(d)}b.close()},a.close=function(){b.close()}}]),angular.module("AdvancedFiltersAuthorModalControllerModule",["FocusOnEventComponentModule"]).controller("AdvancedFiltersAuthorModalController",["Restangular","$scope","$modalInstance","activeAdvancedFilters",function(a,b,c,d){b.activeAdvancedFilters=d,b.users=[],b.field={},b.usersAutocomplete={options:{onlySelect:!0,source:function(b,c){var d=a.one("search").all("users").getList({name:b.term,email:b.term,document:b.term.replace(/\.|-/g,""),per_page:10});d.then(function(a){c($.map(a.data,function(a){return{label:a.name,value:a.name,user:{id:a.id,name:a.name}}}))})},messages:{noResults:"",results:function(){}}}},b.usersAutocomplete.events={select:function(a,c){for(var d=!1,e=b.users.length-1;e>=0;e--)b.users[e].id===c.item.user.id&&(d=!0);d||b.users.push(c.item.user)},change:function(){b.field.text="",b.$broadcast("focusField",!0)}},b.removeUser=function(a){b.users.splice(b.users.indexOf(a),1)},b.save=function(){for(var a=b.users.length-1;a>=0;a--){var d={title:"Usuário",type:"authors",desc:b.users[a].name,value:b.users[a].id};b.activeAdvancedFilters.push(d)}c.close()},b.close=function(){c.close()}}]),angular.module("AdvancedFiltersReporterModalControllerModule",["FocusOnEventComponentModule"]).controller("AdvancedFiltersReporterModalController",["Restangular","$scope","$modalInstance","activeAdvancedFilters",function(a,b,c,d){b.activeAdvancedFilters=d,b.users=[],b.field={},b.usersAutocomplete={options:{onlySelect:!0,source:function(b,c){var d=a.one("search").all("users").getList({name:b.term,email:b.term,document:b.term.replace(/\.|-/g,""),per_page:10});d.then(function(a){c($.map(a.data,function(a){return{label:a.name,value:a.name,user:{id:a.id,name:a.name}}}))})},messages:{noResults:"",results:function(){}}}},b.usersAutocomplete.events={select:function(a,c){for(var d=!1,e=b.users.length-1;e>=0;e--)b.users[e].id===c.item.user.id&&(d=!0);d||b.users.push(c.item.user)},change:function(){b.field.text="",b.$broadcast("focusField",!0)}},b.removeUser=function(a){b.users.splice(b.users.indexOf(a),1)},b.save=function(){for(var a=b.users.length-1;a>=0;a--){var d={title:"Relatados por",type:"reporters",desc:b.users[a].name,value:b.users[a].id};b.activeAdvancedFilters.push(d)}c.close()},b.close=function(){c.close()}}]),angular.module("AdvancedFiltersCategoryModalControllerModule",[]).controller("AdvancedFiltersCategoryModalController",["$scope","$rootScope","$modalInstance","activeAdvancedFilters","categoriesResponse",function(a,b,c,d,e){b.resolvingRequest=!1,a.categories=[],a.activeAdvancedFilters=d;var f=[],g="undefined"!=typeof e.data?e.data:e,h=angular.copy(g);_.each(h,function(a){if(null!==a.parent_id){var b=h.indexOf(_.findWhere(h,{id:a.parent_id}));if(-1===b)return!1;var c=h.indexOf(a);_.isUndefined(h[b].subcategories)?h[b].subcategories=[a]:h[b].subcategories.push(a),h[c]=void 0}}),h=_.without(h,void 0),a.categories=h,_.each(a.activeAdvancedFilters,function(a){"categories"==a.type&&-1===f.indexOf(a.value)&&f.push(a.value)}),a.isActive=function(a){return-1!==f.indexOf(a.id)},a.updateCategory=function(a){var b=f.indexOf(a.id);-1===b?f.push(a.id):f.splice(b,1)},a.save=function(){_.each(f,function(b){var c=_.where(g,{id:b})[0];if(!_.any(a.activeAdvancedFilters,function(a){return"categories"==a.type&&a.value==c.id})){var d={title:"Categoria",type:"categories",desc:c.title,value:c.id};a.activeAdvancedFilters.push(d)}}),_.each(a.activeAdvancedFilters,function(b,c){b&&"categories"==b.type&&-1===f.indexOf(b.value)&&a.activeAdvancedFilters.splice(c,1)}),c.close()},a.close=function(){c.close()}}]),angular.module("AdvancedFiltersFieldsModalControllerModule",["FieldsFilterItemComponentModule","InventoriesCategoriesServiceModule"]).controller("AdvancedFiltersFieldsModalController",["$scope","$rootScope","$modalInstance","activeAdvancedFilters","categoriesResponse","InventoriesCategoriesService",function(a,b,c,d,e,f){b.resolvingRequest=!1,a.categories=e,a.activeAdvancedFilters=d,a.items=[],a.methods=[{condition:"greater_than",canSelectMultiple:!1,text:"Maior que",availableKinds:["text","integer","decimal","meters","centimeters","kilometers","years","months","days","hours","seconds","angle"]},{condition:"lesser_than",canSelectMultiple:!1,text:"Menor que",availableKinds:["text","integer","decimal","meters","centimeters","kilometers","years","months","days","hours","seconds","angle"]},{condition:"equal_to",canSelectMultiple:!1,text:"Igual a",availableKinds:["text","integer","decimal","checkbox","radio","select","meters","centimeters","kilometers","years","months","days","hours","seconds","angle","date","time","cpf","cnpj","url","email"]},{condition:"different",canSelectMultiple:!1,text:"Diferente de",availableKinds:["text","integer","decimal","checkbox","radio","select","meters","centimeters","kilometers","years","months","days","hours","seconds","angle","date","time","cpf","cnpj","url","email"]},{condition:"like",canSelectMultiple:!1,text:"Parecido com",availableKinds:["text","integer","decimal","meters","centimeters","kilometers","years","months","days","hours","seconds","angle","date","time","cpf","cnpj","url","email"]},{condition:"includes",canSelectMultiple:!0,text:"Inclui",availableKinds:["checkbox","radio","select"]},{condition:"excludes",canSelectMultiple:!0,text:"Não inclui",availableKinds:["checkbox","radio","select"]}],a.newField={category:null,condition:null,field:null,value:null},a.selectCategory=function(b){a.loading=!0,a.newField.category=!1;var c=f.getCategory(b.id);c.then(function(b){a.newField.category=b.data,a.newField.condition=null,a.newField.field=null,a.newField.value=null,a.newField.fieldId=null,a.loading=!1})},a.selectCondition=function(b){a.newField.condition=b},a.$watch("newField.fieldId",function(){if(null!==a.newField.category&&null!==a.newField.fieldId)for(var b=a.newField.category.sections.length-1;b>=0;b--)for(var c=a.newField.category.sections[b],d=c.fields.length-1;d>=0;d--)c.fields[d].id==a.newField.fieldId&&(a.newField.field=c.fields[d],a.selectCondition(null))}),a.selectField=function(b){a.newField.field=b},a.addItem=function(){a.items.push(angular.copy(a.newField)),a.newField.condition=null,a.newField.field=null,a.newField.value=null,a.newField.fieldId=null},a.save=function(){for(var b=a.items.length-1;b>=0;b--){var d={title:"Campo",type:"fields",desc:a.items[b].field.label+": "+a.items[b].condition.text+" "+a.items[b].value,value:{id:a.items[b].field.id,condition:a.items[b].condition.condition,value:a.items[b].value}};a.activeAdvancedFilters.push(d)}c.close()},a.close=function(){c.close()}}]),angular.module("AdvancedFiltersQueryModalControllerModule",[]).controller("AdvancedFiltersQueryModalController",["$scope","$modalInstance","activeAdvancedFilters",function(a,b,c){a.input={},a.save=function(){var d={title:"Título ou endereço",desc:a.input.query,type:"query",value:a.input.query};c.push(d),b.close()},a.close=function(){b.close()}}]),angular.module("AdvancedFiltersShareModalControllerModule",["CopyTextComponentModule"]).controller("AdvancedFiltersShareModalController",["$scope","$modalInstance","$q","url",function(a,b,c,d){a.url=d,a.close=function(){b.close()}}]),angular.module("AdvancedFiltersStatusModalControllerModule",["SlideComponent"]).controller("AdvancedFiltersStatusModalController",["$scope","$rootScope","$modalInstance","activeAdvancedFilters","categoriesResponse",function(a,b,c,d,e){b.resolvingRequest=!1;var f="undefined"!=typeof e.data?e.data:e;a.statuses=[];for(var g=function(b){for(var c=b.statuses.length-1;c>=0;c--){for(var d=!1,e=a.statuses.length-1;e>=0;e--)b.statuses[c].active&&a.statuses[e].id!==b.statuses[c].id||(d=!0);d||a.statuses.push(b.statuses[c])}},h=f.length-1;h>=0;h--)if(g(f[h]),"undefined"!=typeof f[h].subcategories&&0!==f[h].subcategories.length)for(var i=f[h].subcategories.length-1;i>=0;i--)g(f[h].subcategories[i]);a.categories=[],a.search={};for(var h=f.length-1;h>=0;h--)if(a.categories.push(f[h]),"undefined"!=typeof f[h].subcategories&&0!==f[h].subcategories.length)for(var i=f[h].subcategories.length-1;i>=0;i--)a.categories.push(f[h].subcategories[i]);a.categories=_.uniq(a.categories),a.updateStatus=function(a){"undefined"==typeof a.selected||a.selected===!1?a.selected=!0:a.selected=!1},a.save=function(){for(var b={},e=[],f=a.categories.length-1;f>=0;f--)for(var g=a.categories[f].statuses.length-1;g>=0;g--)a.categories[f].statuses[g].selected===!0&&(b[a.categories[f].statuses[g].id]=a.categories[f].statuses[g],-1===e.indexOf(a.categories[f])&&e.push(a.categories[f])),a.categories[f].statuses[g].selected=!1;for(var h in b){var i={title:"Estado",type:"statuses",desc:b[h].title,value:b[h].id};d.push(i)}c.close()},a.close=function(){c.close()}}]),angular.module("ReportsCategoriesManageStatusesModalControllerModule",["ReportStatusComponentModule"]).controller("ReportsCategoriesManageStatusesModalController",["$scope","$modalInstance","category","updating","categoryId","Restangular",function(a,b,c,d,e,f){a.category=c,a.newStatus={},a.updating=d,a.categoryId=e,a.updateStatuses={},a.availableColors=["#59B1DF","#7DDCE2","#64D2AF","#5CB466","#99C450","#EACD31","#F3AC2E","#F18058","#EF4D3E","#E984FC","#A37FE1","#7A7AF2"],a.createStatus=function(){if(""!==a.newStatus.title){var b={title:a.newStatus.title,color:"#FFFFFF",initial:"false","final":"false",active:"true","private":"false"};if(d){var c=f.one("reports").one("categories",e).post("statuses",b);c.then(function(b){a.category.statuses.push(f.stripRestangular(b.data)),a.newStatus.title=""})}else a.category.statuses.push(b),a.newStatus.title=""}},a.changeInitial=function(b){for(var c=a.category.statuses.length-1;c>=0;c--)b!==a.category.statuses[c]&&(a.category.statuses[c].initial=!1);b.initial=!0},a.removeStatus=function(b){if("undefined"!=typeof b.id){var c=f.one("reports").one("categories",e).one("statuses",b.id).remove();c.then(function(){a.category.statuses.splice(a.category.statuses.indexOf(b),1)})}else a.category.statuses.splice(a.category.statuses.indexOf(b),1)},a.close=function(){if(d)for(var c in a.updateStatuses){var g=angular.copy(a.updateStatuses[c]);g.initial=g.initial.toString(),g["final"]=g["final"].toString(),g.active=g.active.toString(),g["private"]=g["private"].toString();var h=f.one("reports").one("categories",e).one("statuses",g.id).customPUT(g);h.then(function(){})}b.close()}}]),angular.module("ReportsCategoriesDestroyModalControllerModule",["ReportsCategoriesServiceModule"]).controller("ReportsCategoriesDestroyModalController",["$scope","$modalInstance","Restangular","destroyCategory","category","ReportsCategoriesService",function(a,b,c,d,e,f){a.category=e,a.confirm=function(){var e=c.one("reports").one("categories",a.category.id).remove();e.then(function(){f.purgeCache(),b.close(),a.showMessage("ok","A categoria de relato foi removida com sucesso","success",!0),d(a.category)})},a.close=function(){b.close()}}]),angular.module("ItemsDestroyModalControllerModule",["InventoriesItemsServiceModule"]).controller("ItemsDestroyModalController",["$scope","Restangular","InventoriesItemsService","$modalInstance","item","category",function(a,b,c,d,e,f){a.item=e,a.confirm=function(){var b=c.remove(a.item.id,f.id);b.then(function(){d.close(),a.showMessage("ok","O item de inventário "+a.item.title+" foi removido com sucesso","success",!0)})},a.close=function(){d.close()}}]),angular.module("ItemsRestoreModalControllerModule",[]).controller("ItemsRestoreModalController",["$scope","$modalInstance","setItemData","clearData",function(a,b,c,d){a.restore=function(){c(),b.close()},a.close=function(){d(),b.close()}}]),angular.module("ItemsSelectAddressModalControllerModule",["SelectLatLngMapComponent","SearchLatLngMapComponent"]).controller("ItemsSelectAddressModalController",["$scope","$modalInstance","category","updating","itemData","locationFieldsIds",function(a,b,c,d,e,f){a.updating=d,a.category=c,a.latLng=[e[f[0]],e[f[1]]],a.close=function(){b.close()},a.save=function(){if(e[f[0]]=a.latLng[0],e[f[1]]=a.latLng[1],e[f[2]]=null,e[f[3]]=null,e[f[4]]=null,e[f[5]]=null,e[f[6]]=null,a.addressComponents)for(var c=a.addressComponents.length-1;c>=0;c--)"route"===a.addressComponents[c].types[0]&&(null!==e[f[2]]?e[f[2]]=a.addressComponents[c].long_name+", "+e[f[2]]:e[f[2]]=a.addressComponents[c].long_name),"street_number"===a.addressComponents[c].types[0]&&(null!==e[f[2]]?e[f[2]]=e[f[2]]+", "+a.addressComponents[c].long_name:e[f[2]]=a.addressComponents[c].long_name),"neighborhood"===a.addressComponents[c].types[0]&&(e[f[4]]=a.addressComponents[c].long_name),"locality"===a.addressComponents[c].types[0]&&(e[f[5]]=a.addressComponents[c].long_name),"administrative_area_level_1"===a.addressComponents[c].types[0]&&(e[f[6]]=a.addressComponents[c].long_name),("postal_code"===a.addressComponents[c].types[0]||"postal_code_prefix"===a.addressComponents[c].types[0])&&(e[f[3]]=a.addressComponents[c].long_name);b.close()}}]),angular.module("FieldHistoryModalControllerModule",[]).controller("FieldHistoryModalController",["$rootScope","$scope","$modalInstance","Restangular","itemHistoryResponse","itemId","field",function(a,b,c,d,e,f,g){var h=function(a){for(var b=[],c=0;c<a.length;c++){var d={},e=a[c];d.user=e.user,d.created_at=e.created_at,d.changes=_.filter(e.fields_changes,function(a){return a.field.id==g.id})[0],b.push(d)}return b};b.historyLogs=h(e.data),b.field=g,a.resolvingRequest=!1,b.isArray=_.isArray,b.refreshHistory=function(){var a={object_id:g.id};b.historyFilterBeginDate&&(a["created_at[begin]"]=b.historyFilterBeginDate),b.historyFilterEndDate&&(a["created_at[end]"]=b.historyFilterEndDate),b.loadingHistoryLogs=!0;var c=d.one("inventory").one("items",f).one("history").getList(null,a);c.then(function(a){b.historyLogs=h(a.data),b.loadingHistoryLogs=!1})},b.availableHistoryDateFilters=[{name:"Hoje",beginDate:moment().startOf("day").format(),endDate:moment().endOf("day").format(),selected:!1},{name:"Ontem",beginDate:moment().subtract(1,"days").startOf("day").format(),endDate:moment().subtract(1,"days").endOf("day").format(),selected:!1},{name:"Este mês",beginDate:moment().startOf("month").format(),endDate:moment().endOf("day").format(),selected:!1},{name:"Mês passado",beginDate:moment().subtract(1,"months").startOf("month").format(),endDate:moment().subtract(1,"months").subtract(1,"days").endOf("day").format(),selected:!1},{name:"Todos",beginDate:null,endDate:null,selected:!0}],b.showCustomDateFields=function(){_.each(b.availableHistoryDateFilters,function(a){a.selected=!1}),b.showCustomDateHelper=!0},b.selectDateFilter=function(a){_.each(b.availableHistoryDateFilters,function(a){a.selected=!1}),a.selected=!a.selected,b.historyFilterBeginDate=a.beginDate,b.historyFilterEndDate=a.endDate,b.showCustomDateHelper=!1,b.refreshHistory()},b.close=function(){c.close()}}]),angular.module("ItemsCategoriesDestroyModalControllerModule",["InventoriesCategoriesServiceModule"]).controller("ItemsCategoriesDestroyModalController",["Restangular","$scope","$modalInstance","inventoriesCategoriesList","category","$cookies","InventoriesCategoriesService",function(a,b,c,d,e,f,g){b.category=e,b.confirm=function(){b.deletePromise=a.one("inventory").one("categories",b.category.id).remove(),b.deletePromise.then(function(){delete f.inventoryFiltersHash,d.splice(d.indexOf(b.category),1),b.showMessage("ok","A categoria de inventário foi removida com sucesso.","success",!0),g.purgeCache(),c.close()})},b.close=function(){c.close()}}]),angular.module("ItemsCategoriesEditOptionsModalControllerModule",["NgThumbComponentModule"]).controller("ItemsCategoriesEditOptionsModalController",["$scope","$modalInstance","category","uploaderQueue","FileUploader","singleItemUploaderFilter","onlyImagesUploaderFilter","send",function(a,b,c,d,e,f,g,h){a.category=c,a.uploaderQueue=d,a.icon=c.original_icon;var i=a.uploader=new e;i.filters.push(g(i.isHTML5)),i.filters.push(f),i.onAfterAddingFile=function(){a.$apply(function(){a.uploaderQueue.items=i.queue})},a.save=function(){var a=h();a.then(function(){b.close()})},a.close=function(){b.close()}}]),angular.module("ItemsCategoriesEditFieldValuesModalControllerModule",["InventorySingleValueComponentModule"]).controller("ItemsCategoriesEditFieldValuesModalController",["$scope","$modalInstance","field","Restangular","setFieldOptions",function(a,b,c,d,e){a.field=angular.copy(c),a.value={importing:!1},a.isExistingField="undefined"!=typeof a.field.id&&a.field.id,null===a.field.field_options&&(a.field.field_options=[]),a.toggleImport=function(){a.value.importing===!0?a.value.importing=!1:a.value.importing=!0};var f=function(b){var c=_.findWhere(a.field.field_options,{value:b});return _.isUndefined(c)?!1:!0},g=function(a){return d.all("inventory").one("fields",c.id).post("options",a)};a.newValue=function(){if(!a.loadingValue){if(a.loadingValue=!0,a.showErrors=!1,a.errors=[],a.value.importing===!0&&(!a.value.multipleOptionsText||0===a.value.multipleOptionsText.length))return a.errors.push("Você precisa de pelo menos um item para importar valores;"),a.showErrors=!0,void(a.loadingValue=!1);if(a.value.importing===!1&&(!a.value.text||0===a.value.text.length))return a.errors.push("O nome da opção não pode ficar em branco;"),a.showErrors=!0,void(a.loadingValue=!1);if(a.value.importing===!0){for(var b=a.value.multipleOptionsText.split(/\n/),c=[],d=b.length-1;d>=0;d--)f(b[d])&&a.errors.push("A opção "+b[d]+" já existe;"),c.push(b[d]);if(0!==a.errors.length)return a.showErrors=!0,void(a.loadingValue=!1);if(a.isExistingField)g({value:c}).then(function(b){a.loadingValue=!1,a.field.field_options.concat(b.data),e(a.field.field_options)});else{for(var d=c.length-1;d>=0;d--)a.field.field_options.push({value:c[d],disabled:!1});a.loadingValue=!1,e(a.field.field_options)}}else{if(f(a.value.text))return a.errors.push("A opção "+a.value.text+" já existe;"),a.showErrors=!0,void(a.loadingValue=!1);var h={value:a.value.text,disabled:!1};a.isExistingField?g(h).then(function(b){a.loadingValue=!1,a.field.field_options.push(b.data),e(a.field.field_options)}):(a.field.field_options.push(h),a.loadingValue=!1,e(a.field.field_options))}a.value.multipleOptionsText=null,a.value.text=null}},a.clear=function(){a.field.field_options=[],e([])},a.close=function(){b.close()},a.save=function(){e(a.field.field_options),b.close()}}]),angular.module("ItemsCategoriesNewStatusModalControllerModule",[]).controller("ItemsCategoriesNewStatusModalController",["$scope","Restangular","$modalInstance","statuses","updating","categoryId",function(a,b,c,d,e,f){a.status={color:"#2FB4E6"},a.save=function(){if(e){var g=b.one("inventory").one("categories",f).post("statuses",{title:a.status.title,color:a.status.color});g.then(function(a){d.push(b.stripRestangular(a.data)),c.close()})}else d.push({title:a.status.title,color:a.status.color}),c.close()},a.close=function(){c.close()}}]),angular.module("ItemsCategoriesEditStatusModalControllerModule",[]).controller("ItemsCategoriesEditStatusModalController",["$scope","Restangular","$modalInstance","status","updating","categoryId",function(a,b,c,d,e,f){a.status=angular.copy(d),a.save=function(){if(e){var g=b.one("inventory").one("categories",f).one("statuses",d.id).customPUT(a.status);g.then(function(){d.title=a.status.title,d.color=a.status.color,c.close()})}else d.title=a.status.title,d.color=a.status.color,c.close()},a.close=function(){c.close()}}]),angular.module("UsersDisableModalControllerModule",[]).controller("UsersDisableModalController",["Restangular","$scope","$modalInstance","user",function(a,b,c,d){b.user=d,b.confirm=function(){var e=a.one("users",b.user.id).remove();e.then(function(){c.close(),b.showMessage("ok","O Usuário "+b.user.name+" foi desativado com sucesso.","success",!1),d.disabled=!0})},b.close=function(){c.close()}}]),angular.module("GalleryModalControllerModule",["panzoom","panzoomwidget","GalleryImageOnLoadComponentModule"]).controller("GalleryModalController",["$scope","$modalInstance","$window","image",function(a,b,c,d){a.loading=!0,a.image=d,"undefined"==typeof d.url&&(a.image.url=d.versions.original),a.$watch("imageDimensions",function(b,d){b!==d&&(a.panzoomConfig={zoomLevels:12,neutralZoomLevel:5,scalePerZoomLevel:1.5,initialPanX:$(c).width()/2-a.imageDimensions.width/2,initialPanY:$(c).height()/2-a.imageDimensions.height/2})}),a.panzoomModel={},a.close=function(){b.close()}}]),angular.module("ReportsSelectUserModalControllerModule",[]).controller("ReportsSelectUserModalController",["Restangular","$scope","$modalInstance","$q","setUser","filterByGroup",function(a,b,c,d,e,f){b.loadingPagination=!1,f&&(b.resultsFiltered=!0),b.sort={column:"",descending:!1},b.changeSorting=function(a){var c=b.sort;c.column===a?c.descending=!c.descending:(c.column=a,c.descending=!1)},b.selectedCls=function(a){return a===b.sort.column&&"sort-"+b.sort.descending},b.setUser=function(a){e(a),c.close()};var g,h=1,i=30,j="",k="id,name,email,phone,group.id",l=function(){if(b.groupId)return""!==j?a.one("search").one("groups",b.groupId).all("users").getList({document:j.replace(/\.|-/g,""),name:j,email:j,page:h,per_page:i,return_fields:k}):a.one("groups",b.groupId).all("users").getList({page:h,per_page:i,return_fields:k});if(b.groupId=null,""!==j){var c={document:j.replace(/\.|-/g,""),name:j,email:j,page:h,per_page:i};return f&&(c.groups=f),c.return_fields=k,a.one("search").all("users").getList(c)}var c={page:h,per_page:i};return f&&(c.groups=f),c.return_fields=k,a.all("users").getList(c)},m=a.all("groups").getList({return_fields:"id,name"});b.getGroupById=function(a){return b.groups?b.groups[a]:void 0};var n=b.getData=function(a){if(b.loadingPagination===!1){b.loadingPagination=!0;var c=l(),e=[c];return b.groups||e.push(m),d.all(e).then(function(c){if(b.groups||(b.groups=c[1].data),a!==!0)b.users=c[0].data;else{"undefined"==typeof b.users&&(b.users=[]);for(var d=0;d<c[0].data.length;d++)b.users.push(c[0].data[d]);h++}g=parseInt(c[0].headers().total);var e=Math.ceil(g/i);h===e+1?b.loadingPagination=null:b.loadingPagination=!1}),c}};b.search=function(a){j=a,h=1,b.loadingPagination=!1,b.loadingContent=!0,n().then(function(){b.loadingContent=!1,h++})},b.selectGroup=function(a){b.groupId=a,h=1,b.loadingPagination=!1,b.loadingContent=!0,n().then(function(){b.loadingContent=!1,h++})},b.close=function(){c.close()}}]),angular.module("ReportsCreateUserModalControllerModule",["ngCpfCnpj"]).controller("ReportsCreateUserModalController",["Restangular","$scope","$modalInstance","$q","setUser",function(a,b,c,d,e){b.user={},b.inputErrors=null,b.create=function(){b.inputErrors=null,b.processingForm=!0;var d=a.one("users").withHttpConfig({treatingErrors:!0}).post(null,b.user,{return_fields:"id,name",generate_password:!0});d.then(function(d){e(a.stripRestangular(d.data)),c.close(),b.processingForm=!1},function(a){b.inputErrors=a.data.error,b.processingForm=!1})},b.close=function(){c.close()}}]),angular.module("ReportsEditDescriptionModalControllerModule",[]).controller("ReportsEditDescriptionModalController",["Restangular","$scope","$modalInstance","report","refreshHistory",function(a,b,c,d,e){b.report=angular.copy(d),b.save=function(){b.processingForm=!0;var f=a.one("reports",d.category.id).one("items",d.id).customPUT({description:b.report.description});f.then(function(a){e(),c.close(),b.processingForm=!1,d.description=b.report.description},function(a){b.processingForm=!1})},b.close=function(){c.close()}}]),angular.module("ErrorModalControllerModule",[]).controller("ErrorModalController",["$scope","$rootScope","$modalInstance","$state","response","Raven","Auth",function(a,b,c,d,e,f,g){b.resolvingRoute=!1,b.resolvingRequest=!1,a.response=e,f.captureMessage(JSON.stringify(e)),a.ok=function(){c.close()},a.redoSession=function(){g.logout(),d.go("user.login"),c.close()}}]),angular.module("FlowsAddModalControllerModule",[]).controller("FlowsAddModalController",["$scope","$modalInstance","Restangular","flows",function(a,b,c,d){a.flow={},a.save=function(){var e=c.all("flows").post(a.flow);e.then(function(a){d.push(c.stripRestangular(a.data)),b.close()})},a.close=function(){b.close()}}]),angular.module("FlowsEditModalControllerModule",["FlowsResolutionStateComponentModule"]).controller("FlowsEditModalController",["$scope","$modalInstance","Restangular","flows","flow",function(a,b,c,d,e){a.flow=angular.copy(e),a.newResolutionState={"default":!1},a.createResolutionState=function(){var b=c.one("flows",e.id).post("resolution_states",a.newResolutionState);b.then(function(b){a.flow.resolution_states.push(c.stripRestangular(b.data))})},a.save=function(){var f=c.one("flows",e.id).customPUT(a.flow);f.then(function(){d&&(d[d.indexOf(e)]=a.flow),b.close()})},a.close=function(){b.close()}}]),angular.module("FlowsDestroyModalControllerModule",[]).controller("FlowsDestroyModalController",["$scope","$modalInstance","Restangular","flow","flows",function(a,b,c,d,e){a.flow=d,a.confirm=function(){var f=c.one("flows",d.id).remove();f.then(function(){b.close(),e.splice(e.indexOf(a.flow),1)})},a.close=function(){b.close()}}]),angular.module("FlowsStepsAddModalControllerModule",[]).controller("FlowsStepsAddModalController",["$scope","$modalInstance","$q","Restangular","flow",function(a,b,c,d,e){a.flow={stepType:"form"},a.selectedFlow=null,a.selectFlow=function(b){a.selectedFlow=b};var f=d.one("flows",e.id).all("ancestors").getList(),g=d.all("flows").getList({
display_type:"full"});c.all([g,f]).then(function(b){a.flows=b[0].data;for(var c=b[1].data,d=a.flows.length-1;d>=0;d--)-1!==c.indexOf(a.flows[d].id)&&(a.flows[d].hidden=!0)}),a.save=function(){var c;c="form"===a.flow.stepType?{title:a.flow.title,step_type:"form"}:{title:a.selectedFlow.title,step_type:"flow",child_flow_id:a.selectedFlow.id};var f=d.one("flows",e.id).post("steps",c);f.then(function(a){e.steps.push(d.stripRestangular(a.data)),b.close()})},a.close=function(){b.close()}}]),angular.module("FlowsStepsDestroyModalControllerModule",[]).controller("FlowsStepsDestroyModalController",["$scope","$modalInstance","Restangular","step","flow",function(a,b,c,d,e){a.step=d,a.confirm=function(){var f=c.one("flows",e.id).one("steps",d.id).remove();f.then(function(){b.close(),e.steps.splice(e.steps.indexOf(a.step),1)})},a.close=function(){b.close()}}]),angular.module("FlowsStepsEditModalControllerModule",[]).controller("FlowsStepsEditModalController",["$scope","$modalInstance","Restangular","step","flow",function(a,b,c,d,e){a.step=angular.copy(d),a.save=function(){var f=c.one("flows",e.id).one("steps",d.id).customPUT({title:a.step.title});f.then(function(){d.title=a.step.title,b.close()})},a.close=function(){b.close()}}]),angular.module("GroupsEditModalControllerModule",[]).controller("GroupsEditModalController",["Restangular","$scope","$modalInstance","$state","group",function(a,b,c,d,e){b.group=angular.copy(e)||{name:"",permissions:{}},b.save=function(){b.processingForm=!0;var f=null===e?a.one("groups").post(null,b.group):a.one("groups",e.id).customPUT({name:b.group.name});f.then(function(a){b.processingForm=!1,e?(b.showMessage("ok","O grupo foi editado.","success",!0),e.name=b.group.name):(b.showMessage("ok","O grupo foi criado com sucesso.","success",!0),d.go("groups.show",{id:a.data.id})),c.close()},function(a){b.processingForm=!1})},b.close=function(){c.close()}}]),angular.module("GroupsAddUsersModalControllerModule",[]).controller("GroupsAddUsersModalController",["Restangular","$scope","$modalInstance","$q","$state","group",function(a,b,c,d,e,f){b.loadingPagination=!1,b.sort={column:"",descending:!1},b.changeSorting=function(a){var c=b.sort;c.column===a?c.descending=!c.descending:(c.column=a,c.descending=!1)},b.selectedCls=function(a){return a===b.sort.column&&"sort-"+b.sort.descending};var g,h=1,i=30,j="",k=function(){var c={document:j.replace(/\.|-/g,""),name:j,email:j,page:h,per_page:i};return b.groupId?""!==j?a.one("search").one("groups",b.groupId).all("users").getList(c):a.one("groups",b.groupId).all("users").getList({page:h,per_page:i}):(b.groupId=null,""!==j?a.one("search").all("users").getList(c):a.all("users").getList({page:h,per_page:i}))},l=a.all("groups").getList({return_fields:"id,name"}),m=b.getData=function(a){if(b.loadingPagination===!1){b.loadingPagination=!0;var c=k(),e=[c];return b.groups||e.push(l),d.all(e).then(function(c){if(b.groups||(b.groups=c[1].data),a!==!0)b.users=c[0].data;else{"undefined"==typeof b.users&&(b.users=[]);for(var d=0;d<c[0].data.length;d++)b.users.push(c[0].data[d]);h++}g=parseInt(c[0].headers().total);var e=Math.ceil(g/i);h===e+1?b.loadingPagination=null:b.loadingPagination=!1}),c}};b.search=function(a){j=a,h=1,b.loadingPagination=!1,b.loadingContent=!0,m().then(function(){b.loadingContent=!1,h++})},b.selectGroup=function(a){b.groupId=a,h=1,b.loadingPagination=!1,b.loadingContent=!0,m().then(function(){b.loadingContent=!1,h++})},b.usersToAdd=[],b.isUserSelected=function(a){return-1!==b.usersToAdd.indexOf(a)},b.addUser=function(a){f.users.filter(function(b){return b.id==a}).length>0?b.addModalMessage("exclamation-sign","Usuário já relacionado ao grupo.","error"):b.usersToAdd.push(a)},b.removeUser=function(a){b.usersToAdd.splice(b.usersToAdd.indexOf(a),1)},b.addUsers=function(){var d=a.one("groups",f.id).customPUT({users:b.usersToAdd});d.then(function(){b.showMessage("ok","Os usuários foram adicionados.","success",!0),e.go(e.current,{},{reload:!0}),c.close()})},b.close=function(){c.close()}}]),angular.module("GroupsRemoveUserModalControllerModule",[]).controller("GroupsRemoveUserModalController",["$scope","$modalInstance","removeUserFromList","user","group","Restangular",function(a,b,c,d,e,f){a.user=d,a.group=e,a.confirm=function(){var g=f.one("groups",e.id).all("users").remove({user_id:d.id});g.then(function(){b.close(),a.showMessage("ok","O Usuário "+a.user.name+" foi removido do grupo com sucesso","success",!0),c(a.user)})},a.close=function(){b.close()}}]),angular.module("UserPasswordRecoverModalControllerModule",[]).controller("UserPasswordRecoveryModalController",["Restangular","$scope","$modalInstance",function(a,b,c){b.user={email:null},b.confirm=function(){b.processingForm=!0;var c=a.one("recover_password").customPUT({email:b.user.email});c.then(function(){b.success=!0})},b.close=function(){c.close()}}]),angular.module("FormatErrorsHelperModule",[]).filter("formatErrors",["$sce","$filter",function(a,b){return function(c){var d=[];for(var e in c)for(var f=0;f<c[e].length;f++){var g=b("translateErrors")(e),h=g.charAt(0).toUpperCase()+g.slice(1);d.push(h+" "+b("translateErrors")(c[e][f]))}return a.trustAsHtml(d.join("<br>"))}}]),angular.module("ReplaceDotWithCommaHelperModule",[]).filter("replaceDotWithComma",function(){return function(a){return"undefined"!=typeof a?a.replace(".",","):void 0}}),angular.module("TranslateErrorsHelperModule",[]).filter("translateErrors",function(){return function(a){var b={"is missing":"não pode estar em branco",statuses:"status de relatos",title:"título",icon:"ícone",marker:"marcador",color:"Cor"};return"undefined"!=typeof b[a]?b[a]:a}}),angular.module("DiacriticsInsensitiveFilterHelperModule",[]).filter("diacriticsInsensitiveFilter",["$filter",function(a){return function(a,b){function c(a){return _.isUndefined(a)?void 0:a.replace(/([àáâãäå])|([ç])|([èéêë])|([ìíîï])|([ñ])|([òóôõöø])|([ß])|([ùúûü])|([ÿ])|([æ])/g,function(a,b,c,d,e,f,g,h,i,j,k){return b?"a":c?"c":d?"e":e?"i":f?"n":g?"o":h?"s":i?"u":j?"y":k?"ae":void 0})}for(var d=0;d<a.length;d++)console.log(c(a[d]),b);return!1}}]),angular.module("FilterGoogleAddressComponentsHelperModule",[]).filter("filterGoogleAddressComponents",function(){return function(a){var b={};return _.each(a,function(a){_.each(a.types,function(c){"route"===c?b.address=a.long_name:"neighborhood"===c?b.neighborhood=a.long_name:"locality"===c?b.city=a.long_name:"administrative_area_level_1"===c?b.state=a.short_name:"country"===c?b.country=a.long_name:"street_number"===c?b.number=a.long_name:"postal_code_prefix"===c?b.zipcode=a.long_name:"postal_code"===c&&(b.zipcode=a.long_name)})}),b}});